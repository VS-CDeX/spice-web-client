function lockChangeAlert(){document.pointerLockElement||document.mozPointerLockElement||($("#eventLayer")[0].triedCapturingPointer=!1)}function dispatch(e,t){var i=new Uint8Array(e),n=i[3],s=null,o=i[0];if(o===wdi.WorkerOperations.quic)try{s=wdi.JSQuic.quic_decode(e)}catch(e){}else if(o===wdi.WorkerOperations.lz_rgb)try{s=wdi.LZSS.lz_rgb32_decompress_rgb(e)}catch(e){}else if(o===wdi.WorkerOperations.bytesToUriJpeg)try{return s=bytesToURI(i,"jpeg"),void self.postMessage(s)}catch(e){}else if(o===wdi.WorkerOperations.bytesToUriPng)try{return s=bytesToURI(i,"png"),void self.postMessage(s)}catch(e){}if(!t||!s)return s;n?self.postMessage(s,[s]):self.postMessage(s)}function bytesToURI(e,t){for(var i="data:image/"+t+",",n=e.length,s=4;s<n;s++)e[s]<16?i+="%0":i+="%",i+=e[s].toString(16);return i}function bytesToInt16(e){var t=e.shift();return e.shift()*Math.pow(16,2)+t}function bytesToInt32(e){var t=bytesToInt16(e);return bytesToInt16(e)*Math.pow(16,4)+t}function wdi_quic_QuicFamily(){this.notGRcwlen=[],this.nGRcodewords=[],this.notGRprefixmask=[],this.notGRsuffixlen=[],this.xlatU2L=[],this.xlatL2U=[]}function wdi_quic_s_bucket(){this.pcounters=null,this.bestcode=0}function wdi_quic_CommonState(){(this.wm_trigger=this).encoder=null,this.waitcnt=0,this.tabrand_seed=wdi.JSQuic.stabrand(),this.wmidx=wdi.JSQuic.DEFwmistart,this.wmileft=wdi.JSQuic.wminext,wdi.JSQuic.set_wm_trigger(this),this.melcstate=0,this.melclen=wdi.JSQuic.J[0],this.melcorder=1<<this.melclen>>>0}function wdi_quic_FamilyStat(){this.buckets_buf=null,this.buckets_ptrs=null,this.counters=0}function wdi_quic_Channel(){this.encoder=null,this.correlate_row_width=0,this.correlate_row=null,this._buckets_ptrs=null,this.family_stat_8bpc=new wdi_quic_FamilyStat,this.family_stat_5bpc=new wdi_quic_FamilyStat,this.state=new wdi_quic_CommonState,this.oldFirst=0}function wdi_quic_Encoder(e){this.computedWidth=0,this.result=[],this.cnt=0,this.pxCnt=0,this.usr=e,this.type=null,this.width=null,this.height=null,this.num_channels=null,this.n_buckets_8bpc=null,this.n_buckets_5bpc=null,this.io_available_bits=32,this.io_now=0,this.io_next_word=null,this.io_now=null,this.read_io_word(),this.io_word=this.io_next_word,this.read_io_word(),this.io_words_count=e.length,this.rows_completed=0,this.channels=[],this.alphaPos=3,this.rgb_state=new wdi_quic_CommonState;for(var t=0;t<4;t++)this.channels[t]=new wdi_quic_Channel,wdi.JSQuic.initChannel(this,this.channels[t])}function cnt_l_zeroes(e){return 8388607<e?wdi.JSQuic.lzeroes[e>>>24]:32767<e?8+wdi.JSQuic.lzeroes[e>>>16&255]:127<e?16+wdi.JSQuic.lzeroes[e>>>8&255]:24+wdi.JSQuic.lzeroes[255&e]}function golomb_code_len(e,t){return e<wdi.nGRcodewords[t]?1+(e>>>t)+t:wdi.notGRcwlen[t]}function golomb_decoding(e,t,i,n,s,o,a){var r,c;if(t>n[e]){var d=cnt_l_zeroes(t);c=d<<e|t>>>32-(r=d+1+e)&i[e]}else r=s[e],c=o[e]+(t>>>32-r&i[a[e]]);return[c,r]}function real_update_model(e,t,i,n,s){var o,a,r,c,d=t.pcounters;for(r=d[a=n-1]+=golomb_code_len(i,a),o=n-2;0<=o;o--)(c=d[o]+=golomb_code_len(i,o))<r&&(a=o,r=c);if(t.bestcode=a,r>e.wm_trigger)for(;0<n--;)d[n]>>>=1}function UPDATE_MODEL(e,t,i,n,s,o){real_update_model(t.rgb_state,find_bucket(t.channels[0],n[e-1]),n[e],i),real_update_model(t.rgb_state,find_bucket(t.channels[1],s[e-1]),s[e],i),real_update_model(t.rgb_state,find_bucket(t.channels[2],o[e-1]),o[e],i)}function find_bucket(e,t){return void 0===t&&(t=e.oldFirst),e._buckets_ptrs[t]}function QUIC_UNCOMPRESS_RGBA(e,t,i,n){quic_uncompress_row0(e,t,i,n),quic_four_uncompress_row0(e,e.channels[3],i,n),e.row_completed();for(var s=e.height,o=e.rgb_state,a=1;a<s;a++)quic_uncompress_row_a(e,t,i,n,o),quic_four_uncompress_row(e,e.channels[3],i,n),e.row_completed()}function quic_four_uncompress_row(e,t,i,n){for(var s=wdi.JSQuic.BPC_MASK[n],o=0,a=e.width;wdi.JSQuic.wmimax>t.state.wmidx&&t.state.wmileft<=a;)t.state.wmileft&&(uncompress_four_row_seg(e,t,o,o+t.state.wmileft,i,s,n),o+=t.state.wmileft,a-=t.state.wmileft),t.state.wmidx++,wdi.JSQuic.set_wm_trigger(t.state),t.state.wmileft=wdi.JSQuic.wminext;a&&(uncompress_four_row_seg(e,t,o,o+a,i,s,n),wdi.JSQuic.wmimax>t.state.wmidx&&(t.state.wmileft-=a))}function uncompress_four_row_seg(e,t,i,n,s,o,a){var r,c,d,l,u=t.correlate_row,h=0,p=wdi.JSQuic.bppmask[t.state.wmidx],w=0,_=0,m=!1,f=e.computedWidth,g=e.rows_completed,S=(e.rows_completed-1)*f,b=e.eatbits,C=e.appendAlpha,y=wdi.JSQuic.bppmask,E=wdi.notGRprefixmask,v=wdi.notGRcwlen,P=wdi.nGRcodewords,I=wdi.notGRsuffixlen;for(i?(h=i+t.state.waitcnt,c=e.result[e.alphaPos-4]):(c=UNCOMPRESS_ONE_0_A(t,e,o,S),t.state.waitcnt?--t.state.waitcnt:(t.state.waitcnt=wdi.JSQuic.tabrand(t.state)&p,real_update_model(t.state,find_bucket(t,u[-1]),u[0],s)),h=++i+t.state.waitcnt);;){for(;h<n;){for(;i<=h&&!(m=RLE_PRED_A(i,e,w,f,g));i++)r=(d=golomb_decoding(find_bucket(t,u[i-1]).bestcode,e.io_word,y,E,v,P,I))[0],l=d[1],u[i]=r,c=(wdi.xlatL2U[r]+(c+PIXEL_B(t,e,i,S)>>>1)&o)>>>0,C.call(e,c),b(l,e);if(m)break;real_update_model(t.state,find_bucket(t,u[h-1]),u[h],s),h=i+(wdi.JSQuic.tabrand(t.state)&p)}if(!m){for(;i<n&&!(m=RLE_PRED_A(i,e,w,f,g));i++)r=(d=golomb_decoding(find_bucket(t,u[i-1]).bestcode,e.io_word,y,E,v,P,I))[0],l=d[1],u[i]=r,c=(wdi.xlatL2U[r]+(c+PIXEL_B(t,e,i,S)>>>1)&o)>>>0,C.call(e,c),b(l,e);if(!m)return void(t.state.waitcnt=h-n)}t.state.waitcnt=h-i,_=(w=i)+wdi.JSQuic.decode_channel_run(e,t);for(var k=e.rows_completed*(4*e.width)+4*i,A=e.result[k-1];i<_;i++)C.call(e,A);if(i===n)return;h=i+t.state.waitcnt,m=!1}}function quic_four_uncompress_row0(e,t,i,n){for(var s=wdi.JSQuic.BPC_MASK[n],o=0,a=e.width;wdi.JSQuic.wmimax>t.state.wmidx&&t.state.wmileft<=a;)t.state.wmileft&&(uncompress_four_row0_seg(e,t,o,o+t.wmileft,wdi.JSQuic.bppmask[t.state.wmidx],i,s,n),o+=t.state.wmileft,a-=t.state.wmileft),t.state.wmidx++,wdi.JSQuic.set_wm_trigger(t.state),t.state.wmileft=wdi.JSQuic.wminext;a&&(uncompress_four_row0_seg(e,t,o,o+a,wdi.JSQuic.bppmask[t.state.wmidx],i,s,n),wdi.JSQuic.wmimax>t.state.wmidx&&(t.state.wmileft-=a))}function uncompress_four_row0_seg(e,t,i,n,s,o,a,r){var c=t.correlate_row,d=0;for(d=i?i+t.state.waitcnt:(UNCOMPRESS_ONE_ROW0_0_A(t),t.state.waitcnt?--t.state.waitcnt:(t.state.waitcnt=wdi.JSQuic.tabrand(t.state)&s,real_update_model(t.state,find_bucket(t,c[-1]),c[0],o)),++i+t.state.waitcnt);d<n;){for(;i<=d;i++)UNCOMPRESS_ONE_ROW0_A(t,i,a,e,c);real_update_model(t.state,find_bucket(t,c[d-1]),c[d],o),d=i+(wdi.JSQuic.tabrand(t.state)&s)}for(;i<n;i++)UNCOMPRESS_ONE_ROW0_A(t,i,a,e,c);t.state.waitcnt=d-n}function SAME_PIXEL_A(e,t){return t[e-1]===t[e+3]}function RLE_PRED_A(e,t,i,n,s){var o=(s-1)*n+4*e;return!!(i!==e&&2<e&&SAME_PIXEL_A(o,t.result)&&SAME_PIXEL_A(o=s*n+4*(e-1),t.result))}function UNCOMPRESS_ONE_0_A(e,t,i,n){var s,o;e.oldFirst=e.correlate_row[0],s=golomb_decoding(find_bucket(e,e.correlate_row[-1]).bestcode,t.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen),e.correlate_row[0]=s[0],o=s[1];var a=(wdi.xlatL2U[e.correlate_row[0]]+PIXEL_B(e,t,0,n)&i)>>>0;return t.appendAlpha(a),t.eatbits(o,t),a}function UNCOMPRESS_ONE_A(e,t,i,n,s,o){var a,r,c=(a=golomb_decoding(find_bucket(e,s[t-1]).bestcode,n.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen))[0];r=a[1],s[t]=c,n.appendAlpha((wdi.xlatL2U[c]+(PIXEL_A_A(n)+PIXEL_B(e,n,t,o)>>>1)&i)>>>0),n.eatbits(r,n)}function UNCOMPRESS_ONE_ROW0_0_A(e){var t,i,n=e.encoder;t=golomb_decoding(find_bucket(e,0).bestcode,n.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen),e.correlate_row[0]=t[0],i=t[1],n.appendAlpha(wdi.xlatL2U[e.correlate_row[0]]),n.eatbits(i,n)}function UNCOMPRESS_ONE_ROW0_A(e,t,i,n,s){var o,a,r=(o=golomb_decoding(find_bucket(e,s[t-1]).bestcode,n.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen))[0];a=o[1],s[t]=r,n.appendAlpha(CORELATE_0_A(n,e,t,i,s)),n.eatbits(a,n)}function CORELATE_0_A(e,t,i,n,s){return(wdi.xlatL2U[s[i]]+PIXEL_A_A(e)&n)>>>0}function PIXEL_A_A(e){return e.result[e.alphaPos-4]}function QUIC_UNCOMPRESS_RGB(e,t,i,n){quic_uncompress_row0(e,t,i,n),e.row_completed();for(var s=e.rgb_state,o=e.height,a=e.result,r=e.resultData,c=e.width,d=wdi.JSQuic.BPC_MASK[n],l=wdi.JSQuic,u=e.channels[0],h=e.channels[1],p=e.channels[2],w=u._buckets_ptrs,_=h._buckets_ptrs,m=p._buckets_ptrs,f=u.correlate_row,g=h.correlate_row,S=p.correlate_row,b=e.computedWidth,C=wdi.xlatL2U,y=wdi.JSQuic.lzeroes,E=wdi.JSQuic.lzeroes8,v=wdi.JSQuic.lzeroes16,P=wdi.JSQuic.lzeroes24,I=wdi.notGRprefixmask,k=wdi.notGRcwlen,A=wdi.nGRcodewords,M=wdi.notGRsuffixlen,T=e.eatbits,L=wdi.JSQuic.tabrand,R=wdi.JSQuic.decode_run,D=wdi.JSQuic.bppmask,N=(l=wdi.JSQuic,wdi.JSQuic.tabrand_chaos),x=l.TABRAND_SEEDMASK,G=e.usr,O=1;O<o;O++)quic_uncompress_row(e,t,i,n,s,255<<24,a,r,c,d,l,u,h,p,w,_,m,f,g,S,b,C,y,E,v,P,I,k,A,M,T,L,R,D,N,x,G),e.rows_completed++}function quic_uncompress_row(e,t,i,n,s,o,a,r,c,d,l,u,h,p,w,_,m,f,g,S,b,C,y,E,v,P,I,k,A,M,T,L,R,D,N,x,G){for(var O=0,B=e.rows_completed,U=B*b/4,V=(B-1)*b;l.wmimax>s.wmidx&&s.wmileft<=c;)s.wmileft&&(uncompress_row_seg(e,O,O+s.wmileft,i,d,n,s,o,a,r,u,h,p,w,_,m,f,g,S,b,C,y,E,v,P,I,k,A,M,T,L,R,D,l,N,B,x,V,U,G),O+=s.wmileft,c-=s.wmileft),s.wmidx++,l.set_wm_trigger(s),s.wmileft=l.wminext;c&&(uncompress_row_seg(e,O,O+c,i,d,n,s,o,a,r,u,h,p,w,_,m,f,g,S,b,C,y,E,v,P,I,k,A,M,T,L,R,D,l,N,B,x,V,U,G),l.wmimax>e.rgb_state.wmidx&&(s.wmileft-=c))}function quic_uncompress_row_a(e,t,i,n,s){for(var o=wdi.JSQuic.BPC_MASK[n],a=0,r=e.width;wdi.JSQuic.wmimax>s.wmidx&&s.wmileft<=r;)s.wmileft&&(uncompress_row_seg_a(e,a,a+s.wmileft,i,o,n,s),a+=s.wmileft,r-=s.wmileft),s.wmidx++,wdi.JSQuic.set_wm_trigger(s),s.wmileft=wdi.JSQuic.wminext;r&&(uncompress_row_seg_a(e,a,a+r,i,o,n,s),wdi.JSQuic.wmimax>e.rgb_state.wmidx&&(s.wmileft-=r))}function SAME_PIXEL_RGB_A(e,t){return t[e-4]===t[e]&&t[e-3]===t[e+1]&&t[e-2]===t[e+2]}function SAME_PIXEL(e,t){return t[e-1]===t[e]}function RLE_PRED_RGB_A(e,t,i,n,s){if(s!==e&&2<e&&(SAME_PIXEL_RGB_A(i,t.result)&&SAME_PIXEL_RGB_A(n+4*(e-1),t.result)))return!0;return!1}function RLE_PRED(e,t,i,n,s){if(s!==e&&2<e&&(SAME_PIXEL(4*i,t.result)&&SAME_PIXEL(4*(n+e-1),t.result)))return!0;return!1}function uncompress_row_seg(e,t,i,n,s,o,a,r,c,d,l,u,h,p,w,_,m,f,g,S,b,C,y,E,v,P,I,k,A,M,T,L,R,D,N,x,G,O,B,U){var V,K,Q,z,H,F,Y,W,J,$,q,j,X,Z,ee,te,ie,ne,se,oe=0,ae=R[a.wmidx],re=0,ce=!1,de=e.cnt,le=e.pxCnt;for(t?(oe=t+a.waitcnt,Q=c[de-4],z=c[de-3],H=c[de-2],F=m[t-1],Y=f[t-1],W=g[t-1]):(Q=UNCOMPRESS_ONE_0(l,e,s,O),z=UNCOMPRESS_ONE_0(u,e,s,O),H=UNCOMPRESS_ONE_0(h,e,s,O),F=m[0],Y=f[0],W=g[0],d[le++]=255<<24|H<<16|z<<8|Q,a.waitcnt?--a.waitcnt:(a.waitcnt=T.call(D,a)&ae,UPDATE_MODEL(0,e,n,m,f,g)),oe=++t+a.waitcnt);;){for(;oe<i;){for(K=O+4*t;t<=oe;t++){if(d[(Z=K/4)-1]===d[Z]&&d[(X=B+t-1)-1]===d[X]&&re!==t&&2<t){ce=!0;break}$=p[F].bestcode,F=(q=e.io_word)>P[$]?(j=8388607<q?C[q>>>24]:32767<q?y[q>>>16&255]:127<q?E[q>>>8&255]:v[255&q])<<$|q>>>32-(J=j+1+$)&R[$]:(J=I[$],k[$]+(q>>>32-J&R[A[$]])),Q=b[m[t]=F]+(Q+c[K++]>>>1)&s,te=e.io_available_bits,ie=e.io_word,ie<<=J,0<=(ne=te-J)?(ie=(ie|e.io_next_word>>>ne)>>>0,e.io_available_bits=ne,e.io_word=ie):(ie=((ie|=(se=e.io_next_word)<<(ne=-ne)>>>0)|(se=U[e.io_now++])>>>(te=32-ne))>>>0,e.io_available_bits=te,e.io_word=ie,e.io_next_word=se),$=w[Y].bestcode,Y=(q=e.io_word)>P[$]?(j=8388607<q?C[q>>>24]:32767<q?y[q>>>16&255]:127<q?E[q>>>8&255]:v[255&q])<<$|q>>>32-(J=j+1+$)&R[$]:(J=I[$],k[$]+(q>>>32-J&R[A[$]])),z=b[f[t]=Y]+(z+c[K++]>>>1)&s,te=e.io_available_bits,ie=e.io_word,ie<<=J,0<=(ne=te-J)?(ie=(ie|e.io_next_word>>>ne)>>>0,e.io_available_bits=ne,e.io_word=ie):(ie=((ie|=(se=e.io_next_word)<<(ne=-ne)>>>0)|(se=U[e.io_now++])>>>(te=32-ne))>>>0,e.io_available_bits=te,e.io_word=ie,e.io_next_word=se),$=_[W].bestcode,W=(q=e.io_word)>P[$]?(j=8388607<q?C[q>>>24]:32767<q?y[q>>>16&255]:127<q?E[q>>>8&255]:v[255&q])<<$|q>>>32-(J=j+1+$)&R[$]:(J=I[$],k[$]+(q>>>32-J&R[A[$]])),H=b[g[t]=W]+(H+c[K++]>>>1)&s,te=e.io_available_bits,ie=e.io_word,ie<<=J,0<=(ne=te-J)?(ie=(ie|e.io_next_word>>>ne)>>>0,e.io_available_bits=ne,e.io_word=ie):(ie=((ie|=(se=e.io_next_word)<<(ne=-ne)>>>0)|(se=U[e.io_now++])>>>(te=32-ne))>>>0,e.io_available_bits=te,e.io_word=ie,e.io_next_word=se),d[le++]=r|H<<16|z<<8|Q,K++}if(ce)break;real_update_model(a,p[m[ee=oe-1]],m[oe],n),real_update_model(a,w[f[ee]],f[oe],n),real_update_model(a,_[g[ee]],g[oe],n),a.tabrand_seed++,oe=t+(N[a.tabrand_seed&G]&ae)}if(!ce){for(K=O+4*t;t<i;t++){if(d[(Z=K/4)-1]===d[Z]&&d[(X=B+t-1)-1]===d[X]&&re!==t&&2<t){ce=!0;break}$=p[F].bestcode,F=(q=e.io_word)>P[$]?(j=8388607<q?C[q>>>24]:32767<q?y[q>>>16&255]:127<q?E[q>>>8&255]:v[255&q])<<$|q>>>32-(J=j+1+$)&R[$]:(J=I[$],k[$]+(q>>>32-J&R[A[$]])),Q=b[m[t]=F]+(Q+c[K++]>>>1)&s,te=e.io_available_bits,ie=e.io_word,ie<<=J,0<=(ne=te-J)?(ie=(ie|e.io_next_word>>>ne)>>>0,e.io_available_bits=ne,e.io_word=ie):(ie=((ie|=(se=e.io_next_word)<<(ne=-ne)>>>0)|(se=U[e.io_now++])>>>(te=32-ne))>>>0,e.io_available_bits=te,e.io_word=ie,e.io_next_word=se),$=w[Y].bestcode,Y=(q=e.io_word)>P[$]?(j=8388607<q?C[q>>>24]:32767<q?y[q>>>16&255]:127<q?E[q>>>8&255]:v[255&q])<<$|q>>>32-(J=j+1+$)&R[$]:(J=I[$],k[$]+(q>>>32-J&R[A[$]])),z=b[f[t]=Y]+(z+c[K++]>>>1)&s,te=e.io_available_bits,ie=e.io_word,ie<<=J,0<=(ne=te-J)?(ie=(ie|e.io_next_word>>>ne)>>>0,e.io_available_bits=ne,e.io_word=ie):(ie=((ie|=(se=e.io_next_word)<<(ne=-ne)>>>0)|(se=U[e.io_now++])>>>(te=32-ne))>>>0,e.io_available_bits=te,e.io_word=ie,e.io_next_word=se),$=_[W].bestcode,W=(q=e.io_word)>P[$]?(j=8388607<q?C[q>>>24]:32767<q?y[q>>>16&255]:127<q?E[q>>>8&255]:v[255&q])<<$|q>>>32-(J=j+1+$)&R[$]:(J=I[$],k[$]+(q>>>32-J&R[A[$]])),H=b[g[t]=W]+(H+c[K++]>>>1)&s,te=e.io_available_bits,ie=e.io_word,ie<<=J,0<=(ne=te-J)?(ie=(ie|e.io_next_word>>>ne)>>>0,e.io_available_bits=ne,e.io_word=ie):(ie=((ie|=(se=e.io_next_word)<<(ne=-ne)>>>0)|(se=U[e.io_now++])>>>(te=32-ne))>>>0,e.io_available_bits=te,e.io_word=ie,e.io_next_word=se),d[le++]=255<<24|H<<16|z<<8|Q,K++}if(!ce)return a.waitcnt=oe-i,e.cnt=4*le,void(e.pxCnt=le)}for(a.waitcnt=oe-t,re=t,run_end=L(e),t=run_end+t;0<run_end--;)d[le++]=r|H<<16|z<<8|Q;if(t===i)return e.cnt=4*le,void(e.pxCnt=le);F=m[V=t-1],Y=f[V],W=g[V],oe=t+a.waitcnt,ce=!1}}function uncompress_row_seg_a(e,t,i,n,s,o,a){var r,c,d,l,u,h,p,w,_,m,f,g,S=e.channels[0],b=e.channels[1],C=e.channels[2],y=S._buckets_ptrs,E=b._buckets_ptrs,v=C._buckets_ptrs,P=S.correlate_row,I=b.correlate_row,k=C.correlate_row,A=0,M=wdi.JSQuic.bppmask[a.wmidx],T=0,L=0,R=!1,D=e.computedWidth,N=(e.rows_completed-1)*D,x=e.rows_completed*D,G=(e.rows_completed,e.rows_completed,e.result),O=e.resultData,B=wdi.xlatL2U,U=e.eatbits,V=wdi.JSQuic.tabrand,K=wdi.JSQuic.decode_run,Q=(wdi.JSQuic.lzeroes,wdi.JSQuic.lzeroes8,wdi.JSQuic.lzeroes16,wdi.JSQuic.lzeroes24,e.cnt),z=e.pxCnt,H=wdi.JSQuic.bppmask,F=wdi.notGRprefixmask,Y=wdi.notGRcwlen,W=wdi.nGRcodewords,J=wdi.notGRsuffixlen;for(t?(A=t+a.waitcnt,d=G[Q-4],l=G[Q-3],u=G[Q-2],h=P[t-1],p=I[t-1],w=k[t-1]):(d=UNCOMPRESS_ONE_0(S,e,s,N),l=UNCOMPRESS_ONE_0(b,e,s,N),u=UNCOMPRESS_ONE_0(C,e,s,N),h=P[0],p=I[0],w=k[0],O[z++]=255<<24|u<<16|l<<8|d,a.waitcnt?--a.waitcnt:(a.waitcnt=V.call(wdi.JSQuic,a)&M,UPDATE_MODEL(0,e,n,P,I,k)),A=++t+a.waitcnt);;){for(;A<i;){for(c=N+4*t;t<=A&&!(R=RLE_PRED_RGB_A(t,e,c,x,T));t++)m=y[h].bestcode,h=(f=e.io_word)>F[m]?(g=cnt_l_zeroes(f))<<m|f>>>32-(_=g+1+m)&H[m]:(_=Y[m],W[m]+(f>>>32-_&H[J[m]])),d=B[P[t]=h]+(d+G[c++]>>>1)&s,U(_,e),m=E[p].bestcode,p=(f=e.io_word)>F[m]?(g=cnt_l_zeroes(f))<<m|f>>>32-(_=g+1+m)&H[m]:(_=Y[m],W[m]+(f>>>32-_&H[J[m]])),l=B[I[t]=p]+(l+G[c++]>>>1)&s,U(_,e),m=v[w].bestcode,w=(f=e.io_word)>F[m]?(g=cnt_l_zeroes(f))<<m|f>>>32-(_=g+1+m)&H[m]:(_=Y[m],W[m]+(f>>>32-_&H[J[m]])),u=B[k[t]=w]+(u+G[c++]>>>1)&s,U(_,e),O[z++]=255<<24|u<<16|l<<8|d,c++;if(R)break;UPDATE_MODEL(A,e,n,P,I,k),A=t+(V.call(wdi.JSQuic,a)&M)}if(!R){for(c=N+4*t;t<i&&!(R=RLE_PRED_RGB_A(t,e,c,x,T));t++)m=y[h].bestcode,h=(f=e.io_word)>F[m]?(g=cnt_l_zeroes(f))<<m|f>>>32-(_=g+1+m)&H[m]:(_=Y[m],W[m]+(f>>>32-_&H[J[m]])),d=B[P[t]=h]+(d+G[c++]>>>1)&s,U(_,e),m=E[p].bestcode,p=(f=e.io_word)>F[m]?(g=cnt_l_zeroes(f))<<m|f>>>32-(_=g+1+m)&H[m]:(_=Y[m],W[m]+(f>>>32-_&H[J[m]])),l=B[I[t]=p]+(l+G[c++]>>>1)&s,U(_,e),m=v[w].bestcode,w=(f=e.io_word)>F[m]?(g=cnt_l_zeroes(f))<<m|f>>>32-(_=g+1+m)&H[m]:(_=Y[m],W[m]+(f>>>32-_&H[J[m]])),u=B[k[t]=w]+(u+G[c++]>>>1)&s,U(_,e),O[z++]=255<<24|u<<16|l<<8|d,c++;if(!R)return a.waitcnt=A-i,e.cnt=4*z,void(e.pxCnt=z)}for(a.waitcnt=A-t,T=t,t=(L=K(e))+t;0<L--;)O[z++]=255<<24|u<<16|l<<8|d;if(t===i)return e.cnt=4*z,void(e.pxCnt=z);h=P[r=t-1],p=I[r],w=k[r],A=t+a.waitcnt,R=!1}}function quic_uncompress_row0(e,t,i,n){for(var s=wdi.JSQuic.BPC_MASK[n],o=0,a=e.width;wdi.JSQuic.wmimax>e.rgb_state.wmidx&&e.rgb_state.wmileft<=a;)e.rgb_state.wmileft&&(uncompress_row0_seg(e,o,o+e.rgb_state.wmileft,wdi.JSQuic.bppmask[e.rgb_state.wmidx],i,s,n),o+=e.rgb_state.wmileft,a-=e.rgb_state.wmileft),e.rgb_state.wmidx++,wdi.JSQuic.set_wm_trigger(e.rgb_state),e.rgb_state.wmileft=wdi.JSQuic.wminext;a&&(uncompress_row0_seg(e,o,o+a,wdi.JSQuic.bppmask[e.rgb_state.wmidx],i,s,n),wdi.JSQuic.wmimax>e.rgb_state.wmidx&&(e.rgb_state.wmileft-=a))}function uncompress_row0_seg(e,t,i,n,s,o,a){var r,c,d,l=e.channels[0],u=e.channels[1],h=e.channels[2],p=l.correlate_row,w=u.correlate_row,_=h.correlate_row,m=0;for(m=t?t+e.rgb_state.waitcnt:(r=UNCOMPRESS_ONE_ROW0_0(l),c=UNCOMPRESS_ONE_ROW0_0(u),d=UNCOMPRESS_ONE_ROW0_0(h),e.appendPixel(r,c,d),e.rgb_state.waitcnt?--e.rgb_state.waitcnt:(e.rgb_state.waitcnt=wdi.JSQuic.tabrand(e.rgb_state)&n,UPDATE_MODEL(0,e,s,p,w,_)),++t+e.rgb_state.waitcnt);m<i;){for(;t<=m;t++)r=UNCOMPRESS_ONE_ROW0(l,t,o,e,p,r),c=UNCOMPRESS_ONE_ROW0(u,t,o,e,w,c),d=UNCOMPRESS_ONE_ROW0(h,t,o,e,_,d),e.appendPixel(r,c,d);UPDATE_MODEL(m,e,s,p,w,_),m=t+(wdi.JSQuic.tabrand(e.rgb_state)&n)}for(;t<i;t++)r=UNCOMPRESS_ONE_ROW0(l,t,o,e,p,r),c=UNCOMPRESS_ONE_ROW0(u,t,o,e,w,c),d=UNCOMPRESS_ONE_ROW0(h,t,o,e,_,d),e.appendPixel(r,c,d);e.rgb_state.waitcnt=m-i}function UNCOMPRESS_ONE_0(e,t,i,n){var s,o;e.oldFirst=e.correlate_row[0],s=golomb_decoding(find_bucket(e,e.correlate_row[0]).bestcode,t.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen),e.correlate_row[0]=s[0],o=s[1];var a=wdi.xlatL2U[e.correlate_row[0]]+t.result[n+e.num_channel]&i;return t.eatbits(o,t),a}function UNCOMPRESS_ONE(e,t,i,n,s,o,a,r,c,d,l,u,h){var p,w=(_=golomb_decoding(u[a[i]].bestcode,o.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen))[0];p=_[1];var _=l[a[t]=w]+(h+c[r+n+d]>>>1)&s;return o.eatbits(p,o),_}function UNCOMPRESS_ONE_ROW0_0(e){var t,i=e.encoder;n=golomb_decoding(find_bucket(e,0).bestcode,i.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen),e.correlate_row[0]=n[0],t=n[1];var n=wdi.xlatL2U[e.correlate_row[0]];return i.eatbits(t,i),n}function UNCOMPRESS_ONE_ROW0(e,t,i,n,s,o){var a;r=golomb_decoding(find_bucket(e,s[t-1]).bestcode,n.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen),s[t]=r[0],a=r[1];var r=CORELATE_0(n,e,t,i,s,o);return n.eatbits(a,n),r}function CORELATE_0(e,t,i,n,s,o){return wdi.xlatL2U[s[i]]+o&n}function PIXEL_A(e){return e.result[e.cnt-4]}function PIXEL_B(e,t,i,n){return t.result[n+4*i+e.num_channel]}wdi.socketStatus={idle:0,prepared:1,connected:2,disconnected:3,failed:4},wdi.Socket=$.spcExtend(wdi.EventObject.prototype,{websocket:null,status:wdi.socketStatus.idle,binary:!1,connect:function(n){var s=this,e="base64";Modernizr.websocketsbinary&&(e="binary",this.binary=!0),this.websocket=new WebSocket(n,e),wdi.Debug.log("Socket: using protocol: "+e),this.binary&&(this.websocket.binaryType="arraybuffer"),this.status=wdi.socketStatus.prepared,this.websocket.onopen=function(){s.status=wdi.socketStatus.connected,s.fire("open")},this.websocket.onmessage=function(e){s.fire("message",e.data)},this.websocket.onclose=function(e){s.status=wdi.socketStatus.disconnected,s.disconnect(),s.fire("error",e)},this.websocket.onerror=function(e){if(e.isTrusted)t=n,(i=document.createElement("a")).href=t;var t,i;s.status=wdi.socketStatus.failed,s.fire("error",e)}},setOnMessageCallback:function(e){this.websocket.onmessage=e},send:function(e){try{this.websocket.send(this.encode_message(e))}catch(e){this.status=wdi.socketStatus.failed,this.fire("error",e)}},disconnect:function(){this.websocket&&(this.websocket.onopen=function(){},this.websocket.onmessage=function(){},this.websocket.onclose=function(){},this.websocket.onerror=function(){},this.websocket.close(),this.websocket=null)},setStatus:function(e){this.status=e,this.fire("status",e)},getStatus:function(){return this.status},encode_message:function(e){if(!this.binary)return Base64.encode(e);var t=e.length,i=new ArrayBuffer(t),n=new Uint8Array(i);return n.set(e),n}}),wdi.ClusterNodeChooser=$.spcExtend(wdi.EventObject.prototype,{init:function(e){},setNodeList:function(e){this._nodeList=this._shuffle(e),this._nodeListLength=this._nodeList.length,this._currentIndex=0},getAnother:function(){return this._nodeList[this._currentIndex++%this._nodeListLength]},_shuffle:function(e){for(var t,i,n=e.length;0<n;)i=Math.floor(Math.random()*n),t=e[--n],e[n]=e[i],e[i]=t;return e}}),wdi.SocketQueue=$.spcExtend(wdi.EventObject.prototype,{rQ:null,sQ:null,socket:null,init:function(e){this.superInit(),this.socket=e.socket||new wdi.Socket,this.rQ=e.rQ||new wdi.FixedQueue,this.sQ=e.sQ||new wdi.Queue,this.setup()},setup:function(){this.socket.addListener("open",function(){this.fire("open")},this),this.socket.addListener("message",function(e){this.rQ.push(new Uint8Array(e)),this.fire("message")},this),this.socket.addListener("close",function(e){this.fire("close",e)},this),this.socket.addListener("error",function(e){this.fire("error",e)},this)},getStatus:function(){return this.socket.getStatus()},connect:function(e){this.socket.connect(e)},disconnect:function(){this.socket.disconnect()},send:function(e,t){if(void 0===t)var i=!0;else i=t;0==this.sQ.getLength()&&i?this.socket.send(e):(this.sQ.push(e),i&&this.flush())},flush:function(){var e=this.sQ.shift();this.socket.send(e)}}),wdi.PacketController=$.spcExtend(wdi.EventObject.prototype,{sizeDefiner:null,packetExtractor:null,init:function(e){this.superInit(),this.sizeDefiner=e.sizeDefiner,this.packetExtractor=e.packetExtractor},getNextPacket:function(e){var i=this;wdi.logOperations&&wdi.DataLogger.setNetworkTimeStart();var t=this.sizeDefiner.getSize(e);this.packetExtractor.getBytes(t,function(e){var t=this.sizeDefiner.getStatus();this.execute(new wdi.RawMessage({status:t,data:e})),i.getNextPacket(e)},this)},execute:function(e){try{this.fire("chunkComplete",e)}catch(e){}}}),wdi.PacketExtractor=$.spcExtend(wdi.EventObject.prototype,{socketQ:null,numBytes:null,callback:null,scope:null,init:function(e){this.superInit(),this.socketQ=e.socketQ,this.setListener()},setListener:function(){this.socketQ.addListener("message",function(){wdi.logOperations&&wdi.DataLogger.setNetworkTimeStart(),this.getBytes(this.numBytes,this.callback,this.scope)},this)},getBytes:function(e,t,i){var n,s=this.socketQ.rQ.getLength();(this.numBytes=e,this.callback=t,this.scope=i,null!==e&&e<=s)?(n=e?this.socketQ.rQ.shift(e):new Uint8Array(0),this.numBytes=null,this.callback=null,this.scope=null,t.call(i,n)):wdi.logOperations&&wdi.DataLogger.logNetworkTime()}}),wdi.PacketReassembler=$.spcExtend(wdi.EventObject.prototype,{packetController:null,currentHeader:null,statusToString:null,sizeDefinerConstant:null,init:function(e){this.superInit(),this.packetController=e.packetController,this.sizeDefinerConstant=wdi.SizeDefiner.prototype,this.statusToString=[],this.statusToString[this.sizeDefinerConstant.STATUS_REPLY_BODY]="reply",this.statusToString[this.sizeDefinerConstant.STATUS_ERROR_CODE]="errorCode",this.statusToString[this.sizeDefinerConstant.STATUS_BODY]="spicePacket",this.setListeners()},start:function(){this.packetController.getNextPacket()},setListeners:function(){this.packetController.addListener("chunkComplete",function(e){var t=e,i=t.status;switch(i){case this.sizeDefinerConstant.STATUS_HEADER:case this.sizeDefinerConstant.STATUS_REPLY:this.currentHeader=t;break;case this.sizeDefinerConstant.STATUS_REPLY_BODY:case this.sizeDefinerConstant.STATUS_BODY:var n=new Uint8Array(t.data.length+this.currentHeader.data.length);n.set(this.currentHeader.data),n.set(t.data,this.currentHeader.data.length),t.data=n,t.status=this.statusToString[i],this.fire("packetComplete",t);break;default:t.status=this.statusToString[i],this.fire("packetComplete",t)}},this)}}),wdi.ReassemblerFactory={getPacketReassembler:function(e){var t=this.getPacketExtractor(e),i=this.getSizeDefiner(),n=this.getPacketController(t,i);return new wdi.PacketReassembler({packetController:n})},getPacketExtractor:function(e){return new wdi.PacketExtractor({socketQ:e})},getSizeDefiner:function(){return new wdi.SizeDefiner},getPacketController:function(e,t){return new wdi.PacketController({packetExtractor:e,sizeDefiner:t})}},wdi.SizeDefiner=$.spcExtend(wdi.DomainObject,{ERROR_CODE_SIZE:4,status:null,STATUS_READY:0,STATUS_REPLY:1,STATUS_REPLY_BODY:2,STATUS_ERROR_CODE:3,STATUS_MESSAGE:4,STATUS_HEADER:5,STATUS_BODY:6,isHeader:!1,init:function(e){this.status=this.STATUS_READY},getSize:function(e){return this.STATUS_READY===this.status?(this.status++,wdi.SpiceLinkHeader.prototype.objectSize):this.STATUS_REPLY===this.status?(this.status++,this.getReplyBodySize(e)):this.STATUS_REPLY_BODY===this.status?(this.status++,this.ERROR_CODE_SIZE):this.STATUS_ERROR_CODE===this.status?(this.status++,this.isHeader=!0,6):this.isHeader?(this.isHeader=!1,this.getBodySizeFromArrayHeader(e)):(this.isHeader=!0,6)},getReplyBodySize:function(e){var t=wdi.GlobalPool.create("ViewQueue");t.setData(e);var i=(new wdi.SpiceLinkHeader).demarshall(t);return wdi.GlobalPool.discard("ViewQueue",t),i.size},getBodySizeFromArrayHeader:function(e){var t=wdi.GlobalPool.create("ViewQueue");t.setData(e);var i=(new wdi.SpiceDataHeader).demarshall(t);return wdi.GlobalPool.discard("ViewQueue",t),i.size},getStatus:function(){return this.status===this.STATUS_MESSAGE&&this.isHeader?this.STATUS_HEADER:this.status!==this.STATUS_MESSAGE||this.isHeader?this.status:this.STATUS_BODY}}),wdi.PacketLinkFactory={extract:function(e,t){switch(e.type){case wdi.SpiceVars.SPICE_MSG_SET_ACK:return(new wdi.RedSetAck).demarshall(t);case wdi.SpiceVars.SPICE_MSG_PING:return(new wdi.RedPing).demarshall(t,e.size);case wdi.SpiceVars.SPICE_MSG_MIGRATE:return(new wdi.RedMigrate).demarshall(t);case wdi.SpiceVars.SPICE_MSG_MIGRATE_DATA:return(new wdi.RedMigrateData).demarshall(t,e.size);case wdi.SpiceVars.SPICE_MSG_WAIT_FOR_CHANNELS:return(new wdi.RedWaitForChannels).demarshall(t);case wdi.SpiceVars.SPICE_MSG_DISCONNECTING:return(new wdi.RedDisconnect).demarshall(t);case wdi.SpiceVars.SPICE_MSG_NOTIFY:return(new wdi.RedNotify).demarshall(t);case wdi.SpiceVars.SPICE_MSG_MAIN_MOUSE_MODE:return(new wdi.SpiceMouseMode).demarshall(t)}}},wdi.PacketLinkProcess={process:function(e,t,i){switch(e.type){case wdi.SpiceVars.SPICE_MSG_SET_ACK:var n=wdi.SpiceObject.numberTo32(t.generation);i.setAckWindow(t.window),i.sendObject(n,wdi.SpiceVars.SPICE_MSGC_ACK_SYNC);break;case wdi.SpiceVars.SPICE_MSG_PING:n=new wdi.RedPing({id:t.id,time:t.time}).marshall();i.sendObject(n,wdi.SpiceVars.SPICE_MSGC_PONG);break;case wdi.SpiceVars.SPICE_MSG_MAIN_MOUSE_MODE:i.fire("mouseMode",t.current_mode);break;case wdi.SpiceVars.SPICE_MSG_NOTIFY:i.fire("notify")}}},wdi.SpiceChannel=$.spcExtend(wdi.EventObject.prototype,{counter:0,ackWindow:0,connectionId:0,socketQ:null,packetReassembler:null,channel:1,proxy:null,token:null,init:function(e){this.superInit(),this.socketQ=e.socketQ||new wdi.SocketQueue,this.packetReassembler=e.packetReassembler||wdi.ReassemblerFactory.getPacketReassembler(this.socketQ),this.setListeners(),this.ackWindow=0},setListeners:function(){var s;this.packetReassembler.addListener("packetComplete",function(e){var t=e;if("spicePacket"===t.status){wdi.logOperations&&(wdi.DataLogger.logNetworkTime(),s=Date.now());var i=this.getRawSpiceMessage(t.data);i&&(wdi.logOperations&&i.channel===wdi.SpiceVars.SPICE_CHANNEL_DISPLAY&&wdi.DataLogger.setStartTime(s),this.fire("message",i))}else if("reply"===t.status){var n=this.getRedLinkReplyBytes(t.data);this.send(n)}else if("errorCode"===t.status){(n=this.getErrorCodeBytes(t.data))&&this.send(n),this.fire("channelConnected")}},this),this.socketQ.addListener("open",function(){var e=this.getRedLinkMessBytes();this.send(e),this.proxy&&this.proxy.end()},this),this.socketQ.addListener("close",function(e){1===this.channel&&this.fire("error",e),this.socketQ.disconnect()},this),this.socketQ.addListener("error",function(){this.fire("error",3),this.socketQ.disconnect()},this)},connect:function(e,t,i,n){var s=wdi.Utils.generateWebSocketUrl(e.protocol,e.host,e.port,e.vmHost,e.vmPort,"spice",e.vmInfoToken);this.channel=t,this.connectionId=i||0,this.socketQ.connect(s),this.proxy=n,this.token=e.token,this.packetReassembler.start()},disconnect:function(){this.socketQ.disconnect()},send:function(e,t){this.socketQ.send(e,t)},sendObject:function(e,t,i){var n=new wdi.SpiceDataHeader({type:t,size:e.length}).marshall();n=n.concat(e),this.send(n,i)},setAckWindow:function(e){this.ackWindow=e,this.counter=0},getRawSpiceMessage:function(e){var t=wdi.GlobalPool.create("ViewQueue"),i=wdi.GlobalPool.create("ViewQueue"),n=new Uint8Array(e,0,wdi.SpiceDataHeader.prototype.objectSize);t.setData(n);var s=(new wdi.SpiceDataHeader).demarshall(t);wdi.GlobalPool.discard("ViewQueue",t);var o=e.subarray(wdi.SpiceDataHeader.prototype.objectSize);if(i.setData(o),this.counter++,this.ackWindow&&this.counter===this.ackWindow){this.counter=0;var a=new wdi.SpiceDataHeader({type:wdi.SpiceVars.SPICE_MSGC_ACK,size:0}).marshall();this.send(a)}var r=wdi.PacketLinkFactory.extract(s,i)||!1;if(r)return wdi.PacketLinkProcess.process(s,r,this),wdi.GlobalPool.discard("ViewQueue",i),!1;var c=wdi.GlobalPool.create("RawSpiceMessage");return c.set(s,i,this.channel),c},getRedLinkReplyBytes:function(e){if(this.token){var t=new wdi.ViewQueue;t.setData(e),t.eatBytes(wdi.SpiceLinkHeader.prototype.objectSize);var i=(new wdi.SpiceLinkReply).demarshall(t);return wdi.SpiceObject.stringHexToBytes(RSA_public_encrypt(this.token,i.pub_key))}return wdi.SpiceObject.stringToBytesPadding("",128)},getRedLinkMessBytes:function(){var e=new wdi.SpiceLinkHeader({magic:1363428690,major_version:2,minor_version:2,size:22}).marshall(),t=new wdi.SpiceLinkMess({connection_id:this.connectionId,channel_type:this.channel,caps_offset:18,num_common_caps:1,common_caps:1<<wdi.SpiceVars.SPICE_COMMON_CAP_MINI_HEADER}).marshall();return e.concat(t)},getErrorCodeBytes:function(e){var t=wdi.GlobalPool.create("ViewQueue");t.setData(e);var i=wdi.SpiceObject.bytesToInt32NoAllocate(t);if(wdi.GlobalPool.discard("ViewQueue",t),0!==i)throw new wdi.Exception({message:"Server refused client",errorCode:2});if(this.channel===wdi.SpiceVars.SPICE_CHANNEL_DISPLAY){var n=new wdi.SpiceDataHeader({type:wdi.SpiceVars.SPICE_MSGC_DISPLAY_INIT,size:14}).marshall(),s=new wdi.SpiceCDisplayInit({pixmap_cache_id:1,pixmap_cache_size:0,glz_dictionary_id:0,glz_dictionary_window_size:1}).marshall();return n.concat(s)}if(this.channel==wdi.SpiceVars.SPICE_CHANNEL_MAIN)return new wdi.SpiceDataHeader({type:wdi.SpiceVars.SPICE_MSGC_MAIN_ATTACH_CHANNELS,size:0}).marshall()}}),wdi.BusConnection=$.spcExtend(wdi.EventObject.prototype,{ws:null,subscriptions:[],_busUser:null,_busPass:null,fileServerBaseUrl:null,queue:"",binary:!1,init:function(e){this.superInit(),this.ws=e.websocket||new wdi.WebSocketWrapper,this.clusterNodeChooser=e.clusterNodeChooser||new wdi.ClusterNodeChooser,this.binary=e.binary||!1},connect:function(e){e.useBus?(this._vdiBusToken=e.vdiBusToken,e.busHostList||(wdi.Debug.warn("Deprecated: using old busHost & busPort params"),e.busHostList=[{host:e.busHost,port:e.busPort}]),this.clusterNodeChooser.setNodeList(e.busHostList),Modernizr.websocketsbinary&&(this.binary=!0),this._busUser=e.busUser,this._busPass=e.busPass,this._websockifyProtocol=e.protocol,this._websockifyHost=e.host,this._websockifyPort=e.port,this.fileServerBaseUrl=e.busFileServerBaseUrl,this.subscriptions=e.busSubscriptions,this._connectToNextHost()):wdi.Debug.warn("Not using the bus")},_connectToNextHost:function(){var e=this.clusterNodeChooser.getAnother(),t=wdi.Utils.generateWebSocketUrl(this._websockifyProtocol,this._websockifyHost,this._websockifyPort,e.host,e.port,"raw",this._vdiBusToken),i="base64";this.binary&&(i="binary"),this.ws.connect(t,i),wdi.Debug.log("BusConnection: using protocol: "+i),this.binary&&this.ws.setBinaryType("arraybuffer"),this.setListeners()},disconnect:function(){this.ws.close()},setListeners:function(){var o=this;this.ws.onOpen(function(e){o._send("CONNECT\nlogin:"+o._busUser+"\npasscode:"+o._busPass+"\n\n\0")}),this.ws.onMessage(function(e){var t,i,n=(t=o.binary?(t=String.fromCharCode.apply(null,new Uint8Array(e.data)),decodeURIComponent(escape(t))):Base64.decodeStr(e.data)).split("\0");if(1==n.length)o.queue+=n[0];else{for(var s=0;s<n.length-1;s++)t=o.queue+n[s],i=o.parseMessage(t),o.fire("busMessage",i),o.queue="";o.queue=n[n.length-1]}}),this.ws.onClose(function(e){wdi.Debug.log("BusConnection CLOSED! connecting again in 1 second"),o.fire("error",e)}),this.ws.onError(function(e){wdi.Debug.error("BusConnection ERROR:",e)})},parseMessage:function(e){try{var t=e.split("\n\n"),i=t[0].trim(),n=t[1].replace(/\x00/,"").trim();n=0!=n.length?JSON.parse(n):null;var s=(t=i.split("\n")).shift();i="{";for(var o=t.length,a=0;a<o;a++){var r=t[a].split(":")[0];i+='"'+r+'":"'+t[a].replace(r+":","")+'"',a!=o-1&&(i+=",")}return i+="}",{verb:s,header:JSON.parse(i),body:n}}catch(e){return wdi.Debug.error("Error parsing Bus Info: ",e),{verb:"ERROR"}}},setSubscriptions:function(){for(var e=this.subscriptions.length,t=0;t<e;t++)this.subscribe(this.subscriptions[t])},send:function(e){var t=this.subscriptions[0];this._send("SEND\ndestination:"+t+"\ncontent-type:text/plain\n\n"+JSON.stringify(e)+"\0")},subscribe:function(e){this._send("SUBSCRIBE\ndestination:"+e+"\n\n\0")},_send:function(e){this.binary?this.ws.send(e):this.ws.send(Base64.encodeStr(e))}}),wdi.WebSocketWrapper=$.spcExtend({},{ws:{},onopen:null,onmessage:null,onclose:null,onerror:null,init:function(){},connect:function(e,t){this.ws=new WebSocket(e,t)},onOpen:function(e){this.ws.onopen=e},onMessage:function(e){this.ws.onmessage=e},onClose:function(e){this.ws.onclose=e},onError:function(e){this.ws.onerror=e},setBinaryType:function(e){this.ws.binaryType=e},close:function(){this.ws&&this.ws.close&&(this.ws.close(),this.ws.onopen=function(){},this.ws.onmessage=function(){},this.ws.onclose=function(){},this.ws.onerror=function(){},this.onopen=function(){},this.onmessage=function(){},this.onclose=function(){},this.onerror=function(){})},send:function(e){this.ws.send(e)}}),wdi.ConnectionControl=$.spcExtend(wdi.EventObject.prototype,{socket:null,pendingTimeToConnectionLost:null,previousTimeOut:null,init:function(e){this.superInit(),this.socket=e.socket||new wdi.Socket},connect:function(e){var t=wdi.Utils.generateWebSocketUrl(e.protocol,e.host,e.port,null,null,"raw",e.heartbeatToken);this.socket.connect(t),this.pendingTimeToConnectionLost=e.heartbeatTimeout,wdi.Debug.log("ConnectionControl: connected"),this.setListeners()},disconnect:function(){this.previousTimeOut&&clearTimeout(this.previousTimeOut),this.socket.disconnect()},setListeners:function(){var t=this;this.socket.setOnMessageCallback(function(e){wdi.Debug.log("ConectionControl: beat"),clearTimeout(t.previousTimeOut),t.previousTimeOut=setTimeout(function(){wdi.Debug.log("ConnectionControl: firing connectionLost event"),t.fire("connectionLost",e)},t.pendingTimeToConnectionLost)})}}),wdi.Agent=$.spcExtend(wdi.EventObject.prototype,{clientTokens:null,serverTokens:10,app:null,clipboardContent:null,clipboardGrabbed:!1,clipboardRequestReceived:!1,clipboardPending:!1,clipboardEnabled:!0,windows:null,init:function(e){this.superInit(),this.app=e.app},sendInitMessage:function(){var e=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_START,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.SpiceMsgMainAgentTokens({num_tokens:this.serverTokens})});this.app.spiceConnection.send(e);var t=1<<wdi.AgentCaps.VD_AGENT_CAP_MONITORS_CONFIG;this.clipboardEnabled&&(t|=1<<wdi.AgentCaps.VD_AGENT_CAP_CLIPBOARD_BY_DEMAND),e=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_ANNOUNCE_CAPABILITIES,opaque:0,data:new wdi.VDAgentAnnounceCapabilities({request:0,caps:t})})}),this.sendAgentPacket(e)},setResolution:function(e,t){e<800&&(e=800),t<600&&(t=600);var i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_MONITORS_CONFIG,opaque:0,data:new wdi.VDAgentMonitorsConfig({num_of_monitors:1,flags:0,data:new wdi.VDAgentMonConfig({width:e,height:t,depth:32,x:0,y:0})})})});this.sendAgentPacket(i)},setClientTokens:function(e){this.clientTokens=e},sendAgentPacket:function(e){this.clientTokens--,this.app.spiceConnection.send(e)},onAgentData:function(e){if(this.serverTokens--,0==this.serverTokens&&(e=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_TOKEN,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.SpiceMsgMainAgentTokens({num_tokens:10})}),this.app.spiceConnection.send(e),this.serverTokens=10),e.type==wdi.AgentMessageTypes.VD_AGENT_ANNOUNCE_CAPABILITIES);else if(e.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_GRAB){if(e.clipboardType==wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_UTF8_TEXT){e=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_REQUEST,opaque:0,data:new wdi.VDAgentClipboardRequest({type:wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_UTF8_TEXT})})});this.sendAgentPacket(e)}}else e.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD?this.fire("clipBoardData",e.clipboardData):e.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_REQUEST?(this.clipboardRequestReceived=!0,this.clipboardPending&&(this.clipboardPending=!1,this.sendPaste())):e.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_RELEASE?(this.clipboardGrabbed=!1,this.clipboardRequestReceived=!1):(e.type,wdi.AgentMessageTypes.VD_AGENT_REPLY)},setClipboard:function(e){e!=this.clipboardContent&&(this.clipboardContent=e,this.sendGrab(),this.sendPaste()),this.app.sendShortcut(wdi.keyShortcutsHandled.CTRLV)},sendGrab:function(){if(!this.clipboardGrabbed){var e=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_GRAB,opaque:0,data:new wdi.VDAgentClipboardGrab({types:[wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_UTF8_TEXT]})})});this.sendAgentPacket(e)}},sendPaste:function(){if(this.clipboardRequestReceived){var e=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD,opaque:0,data:new wdi.VDAgentClipboard({type:wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_UTF8_TEXT,data:this.clipboardContent})})});this.clipboardRequestReceived=!1,this.sendAgentPacket(e)}else this.clipboardPending=!0},disableClipboard:function(){this.clipboardEnabled=!1}}),wdi.SpiceConnection=$.spcExtend(wdi.EventObject.prototype,{channels:null,connectionId:null,connectionInfo:null,runQ:null,token:null,connectionControl:null,init:function(e){this.superInit(),this.channels={},this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN]=e.mainChannel||new wdi.SpiceChannel,this.channels[wdi.SpiceVars.SPICE_CHANNEL_DISPLAY]=e.displayChannel||new wdi.SpiceChannel,this.channels[wdi.SpiceVars.SPICE_CHANNEL_INPUTS]=e.inputsChannel||new wdi.SpiceChannel,this.channels[wdi.SpiceVars.SPICE_CHANNEL_CURSOR]=e.cursorChannel||new wdi.SpiceChannel,this.channels[wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK]=e.playbackChannel||new wdi.SpiceChannel,this.runQ=e.runQ||new wdi.RunQueue,this.connectionControl=e.connectionControl||new wdi.ConnectionControl,this.setup()},connect:function(e){(this.connectionInfo=e).connectionControl&&this.connectionControl.connect(e),this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].connect(this.connectionInfo,wdi.SpiceVars.SPICE_CHANNEL_MAIN)},disconnect:function(){for(var e in this.channels)this.channels[e].disconnect(),this.channels[e]=null,delete this.channels[e];this.connectionControl.disconnect()},send:function(e){var t=e.args.marshall();this.channels[e.channel]&&this.channels[e.channel].sendObject(t,e.messageType)},setup:function(){this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("connectionId",this.onConnectionId,this),this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("channelListAvailable",this.onChannelList,this),this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("mouseMode",this.onMouseMode,this),this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("initAgent",this.onInitAgent,this),this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("notify",this.onNotify,this),this.connectionControl.addListener("connectionLost",this.onDisconnect,this),this._setConnectedListeners();var e=null;for(var t in e=wdi.exceptionHandling?this.onChannelMessageExceptionHandled:this.processChannelMessage,this.channels)this.channels.hasOwnProperty(t)&&(this.channels[t].addListener("message",e,this),this.channels[t].addListener("status",this.onStatus,this),this.channels[t].addListener("error",this.onDisconnect,this))},_setConnectedListeners:function(){this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_MAIN),this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_DISPLAY),this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_INPUTS),this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_CURSOR),this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK)},_setConnectedListener:function(e){this.channels[e].addListener("channelConnected",function(){this.fire("channelConnected",e)},this)},onDisconnect:function(e){this.fire("error",e)},onConnectionId:function(e){this.connectionId=e},onChannelList:function(e){this.connectChannels(e)},connectChannels:function(e){for(var t in this.channels)(t=parseInt(t,10))!=wdi.SpiceVars.SPICE_CHANNEL_MAIN&&-1!=e.indexOf(t)&&this.runQ.add(function(e,t){this.channels[t].connect(this.connectionInfo,t,this.connectionId,e)},this,!1,t);this.runQ.process()},onInitAgent:function(e){var t=e;this.fire("initAgent",t)},onMouseMode:function(e){var t=e;this.fire("mouseMode",t)},onNotify:function(e){this.fire("notify")},onStatus:function(e){},onChannelMessageExceptionHandled:function(e){try{return this.processChannelMessage(e)}catch(e){wdi.Debug.error("SpiceConnection: Packet decodification error",e)}},processChannelMessage:function(e){var t=wdi.PacketFactory.extract(e);wdi.GlobalPool.discard("ViewQueue",e.body),wdi.GlobalPool.discard("RawSpiceMessage",e),t?this.fire("message",t):(wdi.Debug.log("Unknown packet "+e.channel+" "+e.header.type),wdi.Debug.log(e))}}),wdi.SPICE_INPUT_MOTION_ACK_BUNCH=8,wdi.ClientGui=$.spcExtend(wdi.EventObject.prototype,{width:null,height:null,canvas:null,ack_wait:0,mouse_mode:wdi.SpiceMouseModeTypes.SPICE_MOUSE_MODE_SERVER,triedCapturingPointer:!1,mouse_status:0,eventLayer:null,counter:0,mainCanvas:0,firstTime:!0,magnifier:null,magnifierBackground:null,firstMove:!0,isMagnified:!0,isMouseDown:!1,soundStarted:!1,canvasMarginY:0,canvasMarginX:0,stuckKeysHandler:null,subCanvas:{},inputManager:null,clipboardEnabled:!0,layer:null,init:function(e){this.canvas={},this.contexts={},this.superInit(),this.magnifier=window.$("<canvas/>").attr({width:150,height:150}).css({position:"absolute",left:"0px",top:"0px"}),this.stuckKeysHandler=e.stuckKeysHandler||new wdi.StuckKeysHandler,this.stuckKeysHandler.addListener("inputStuck",this._sendInput.bind(this),this),this.magnifierBackground=window.$("<img/>"),this.magnifierBackground.attr("src","resources/magnifier.png"),this.initSound(),this.inputManager=e.inputManager||new wdi.InputManager({stuckKeysHandler:this.stuckKeysHandler,window:$(window)}),this.inputManager.setCurrentWindow(window)},setLayer:function(e){this.layer=e},disableClipboard:function(){this.clipboardEnabled=!1},_sendInput:function(e){var t=e,i=t[0],n=t[1];this.fire("input",[i,n])},releaseAllKeys:function(){this.stuckKeysHandler.releaseAllKeys()},getContext:function(e){return this.contexts[e]},getCanvas:function(e){return this.canvas[e]},checkFeatures:function(){return!(!Modernizr.canvas||!Modernizr.websockets)},deleteSubCanvas:function(e){var t=this.subCanvas[e.hwnd];return this.subCanvas[e.hwnd]=null,t},moveSubCanvas:function(e){var t=this.subCanvas[e.hwnd];return t.info=e,this._fillSubCanvasFromWindow(e),t},resizeSubCanvas:function(e){var t=this.subCanvas[e.hwnd];return $([t.canvas,t.eventLayer]).attr({width:e.width,height:e.height}),t.info=e,this._fillSubCanvasFromWindow(e),t},_fillSubCanvasFromWindow:function(e){var t=parseInt(e.top,10),i=parseInt(e.left,10),n=parseInt(e.width,10),s=parseInt(e.height,10);this.fillSubCanvas({top:t,left:i,right:i+n,bottom:t+s})},createNewSubCanvas:function(e){var t=this.createEventLayer(e.hwnd+"_event",e.width,e.height);return this.subCanvas[e.hwnd]={canvas:$("<canvas/>").attr({width:e.width,height:e.height}).css({display:e.iconic?"none":"block"})[0],eventLayer:t,info:e,position:0},this.canvas[this.mainCanvas]&&this._fillSubCanvasFromWindow(e),[this.subCanvas[e.hwnd]]},fillSubCanvas:function(e){var t=this.canvas[this.mainCanvas],i=null;for(var n in this.subCanvas)if(null!=this.subCanvas[n]&&void 0!==this.subCanvas[n]&&this.subCanvas.hasOwnProperty(n))if(i=this.subCanvas[n].info,null!=e||null!=e){var s=parseInt(i.top,10),o=parseInt(i.left,10),a={top:s,left:o,right:o+parseInt(i.width,10),bottom:s+parseInt(i.height,10)};wdi.CollisionDetector.thereIsBoxCollision(a,e)&&this._doDrawSubCanvas(t,this.subCanvas[n],i)}else this._doDrawSubCanvas(t,this.subCanvas[n],i)},_doDrawSubCanvas:function(e,t,i){if(null!=this.canvas[this.mainCanvas]&&null!=this.canvas[this.mainCanvas]){var n=null;if(0===i.iconic){n=t.canvas.getContext("2d");var s=0,o=0,a=+i.width,r=+i.height,c=+i.left,d=+i.top;c<0&&(a+=c,s=-c,c=0),d<0&&(r+=d,o=-d,d=0);try{a=Math.max(1,Math.floor(a)),r=Math.max(1,Math.floor(r)),a>e.width&&(a=e.width),r>e.height&&(r=e.height),n.drawImage(e,c,d,a,r,s,o,a,r)}catch(e){}}}},removeCanvas:function(e){var t=e.args;t.surface_id===this.mainCanvas&&($(this.eventLayer).remove(),this.eventLayer=null),this.canvas[t.surface_id].keepAlive=!1,delete this.canvas[t.surface_id],delete this.contexts[t.surface_id]},drawCanvas:function(e){var t=e.args,i=wdi.GlobalPool.create("Canvas");if(i.keepAlive=!0,i.id="canvas_"+t.surface_id,i.width=t.width,i.height=t.height,i.style.display="block",i.style.margin="auto",i.style["margin-top"]=this.canvasMarginY+"px",i.style.zIndex="0",this.canvas[t.surface_id]=i,this.contexts[t.surface_id]=i.getContext("2d"),t.flags&&!wdi.SeamlessIntegration){this.mainCanvas=t.surface_id,this.eventLayer=this.createEventLayer("eventLayer",t.width,t.height),this.updateMousePointer();var n=$(this.eventLayer).css({display:"block",margin:"auto","margin-top":this.canvasMarginY+"px"})[0],s=$('<div id="eventLayerWrapper"></div>').css({position:"absolute",top:"0",width:"100%",height:"100%",zIndex:"0"})[0];s.appendChild(n),this.layer?(this.layer.appendChild(i),this.layer.appendChild(s)):(document.body.appendChild(i),document.body.appendChild(s))}if(this.firstTime&&this.clipboardEnabled){var o=this;$(document).bind("paste",function(e){o.fire("paste",e.originalEvent.clipboardData.getData("text/plain"))}),this.firstTime=!1}t.flags&&this.fire("resolution",[this.canvas[t.surface_id].width,this.canvas[t.surface_id].height])},disableKeyboard:function(){var e=window.$(window.document);e.unbind("keydown",this.handleKey),e.unbind("keyup",this.handleKey),e.unbind("keypress",this.handleKey),this.inputManager.disable()},enableKeyboard:function(){var e=window.$(window.document);e.keydown([this],this.handleKey),e.keypress([this],this.handleKey),e.keyup([this],this.handleKey),this.inputManager.enable()},setCanvasMargin:function(e){this.canvasMarginX=e.x,this.canvasMarginY=e.y,$("#screen canvas").css({"margin-top":this.canvasMarginY+"px"})},createEventLayer:function(e,t,i){var h=this,n=$("<canvas/>").css({cursor:"default"}).attr({id:e,width:t,height:i});window.bowser.firefox&&n.attr("contentEditable",!0),n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,"onpointerlockchange"in document?document.addEventListener("pointerlockchange",lockChangeAlert,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",lockChangeAlert,!1),n.bind("touchstart",function(e){e.preventDefault();var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],i=t.pageX,n=t.pageY,s=$(this).offset();h.mouse_mode==wdi.SpiceMouseModeTypes.SPICE_MOUSE_MODE_CLIENT?h.generateEvent.call(h,"mousemove",[i-s.left,n-s.top,h.mouse_status,h.mouse_mode]):h.generateEvent.call(h,"mousemove",[i-s.left-wdi.VirtualMouse.lastMousePosition.x,n-s.top-wdi.VirtualMouse.lastMousePosition.y,h.mouse_status,h.mouse_mode]),1===e.originalEvent.touches.length?(h.enabledTouchMove=!0,h.launchRightClick.call(h,i,n)):2===e.originalEvent.touches.length?(h.touchX=i,h.touchY=n,h.enabledTouchMove=!1):3===e.originalEvent.touches.length&&(h.touchY3=n,h.enabledTouchMove=!1)}),n.bind("touchmove",function(e){var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],i=t.pageX,n=t.pageY;if(1===e.originalEvent.touches.length&&h.enabledTouchMove){h.isMagnified=!0,clearInterval(h.rightClickTimer),h.isMouseDown||(clearInterval(h.mouseDownTimer),h.launchMouseDown());var s=$(this).offset();h.mouse_mode==wdi.SpiceMouseModeTypes.SPICE_MOUSE_MODE_CLIENT?h.generateEvent.call(h,"mousemove",[i-s.left,n-s.top-80,h.mouse_status,h.mouse_mode]):h.generateEvent.call(h,"mousemove",[i-s.left-wdi.VirtualMouse.lastMousePosition.x,n-s.top-80-wdi.VirtualMouse.lastMousePosition.y,h.mouse_status,h.mouse_mode]);var o=i-s.left,a=n-s.top;h.firstMove&&($("body").append(h.magnifier),h.firstMove=!1);var r=o-75,c=a-160;h.magnifier.css({left:r,top:c});var d=h.magnifier[0].getContext("2d");d.clearRect(0,0,150,150),d.save(),d.beginPath(),d.arc(75,75,75,0,2*Math.PI,!1),d.clip(),d.drawImage(h.getCanvas(0),o-50,a-50-80,100,100,0,0,150,150),d.drawImage(h.magnifierBackground[0],0,0),d.restore()}else if(2===e.originalEvent.touches.length){var l=h.touchY-n;if(10<Math.abs(l)){var u=0<l?4:3;h.touchX=i,h.touchY=n,h.generateEvent.call(h,"mousedown",u),h.generateEvent.call(h,"mouseup",u)}}else if(3===e.originalEvent.touches.length){100<(l=h.touchY3-n)&&document.getElementById("hiddeninput").select()}e.preventDefault()}),n.bind("touchend",function(e){if(h.enabledTouchMove){var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t.pageX,t.pageY;h.isMouseDown||h.generateEvent.call(h,"mousedown",0),h.isMouseDown=!1,h.generateEvent.call(h,"mouseup",0),h.enabledTouchMove=!1,h.firstMove=!0,h.isMagnified&&h.magnifier.remove(),h.isMagnified=!1}clearInterval(h.rightClickTimer),clearInterval(h.mouseDownTimer)}),n.mouseup(function(e){var t=e.button;h.generateEvent.call(h,"mouseup",t),h.mouse_status=0,e.preventDefault()}),n.mousedown(function(e){var t=e.button;h.generateEvent.call(h,"mousedown",t),h.mouse_status=1,h.mouse_mode==wdi.SpiceMouseModeTypes.SPICE_MOUSE_MODE_SERVER&&(this.triedCapturingPointer=!0,app.clientGui.capturePointer()),e.preventDefault()}),n.mousemove(function(e){var t=e.pageX,i=e.pageY,n=$(this).offset();if(h.mouse_mode==wdi.SpiceMouseModeTypes.SPICE_MOUSE_MODE_CLIENT)h.generateEvent.call(h,"mousemove",[t-n.left,i-n.top,h.mouse_status,h.mouse_mode]);else if(this.triedCapturingPointer){var s=e.originalEvent,o=s.movementX||s.mozMovementX||s.webkitMovementX||0,a=s.movementY||s.mozMovementY||s.webkitMovementY||0;o||a||void 0!==s.movementX||void 0!==s.mozMovementX||void 0!==s.webkitMovementY||(o=t-n.left-wdi.VirtualMouse.lastMousePosition.x,a=i-n.top-wdi.VirtualMouse.lastMousePosition.y),h.generateEvent.call(h,"mousemove",[o,a,h.mouse_status,h.mouse_mode])}e.preventDefault()}),n.bind("contextmenu",function(e){return e.preventDefault(),!1});return n.bind("mousewheel",function(e,t){var i=0<t?3:4;return h.generateEvent.call(h,"mousedown",i),h.generateEvent.call(h,"mouseup",i),!1}),wdi.VirtualMouse.setEventLayer(n[0],0,0,t,i,1),n[0]},launchRightClick:function(e,t){var i=this;this.rightClickTimer=setTimeout(function(){i.generateEvent.call(i,"mousedown",2),i.generateEvent.call(i,"mouseup",2),i.enabledTouchMove=!1},400)},launchMouseDown:function(e,t){var i=this;this.mouseDownTimer=setTimeout(function(){i.isMouseDown=!0,i.generateEvent.call(i,"mousedown",0)},1500)},showError:function(e){wdi.Debug.warn(e),document.getElementById("overlay").style.visibility="visible",document.getElementById("error").style.visibility="visible"},generateEvent:function(e,t){if("mousemove"===e||"joystick"===e)this.ack_wait<wdi.SPICE_INPUT_MOTION_ACK_BUNCH&&(this.ack_wait++,this.fire("input",[e,t]));else{if(-1<e.indexOf("key")){this.stuckKeysHandler.checkSpecialKey(e,t[0].keyCode);var i=this.inputManager.getValue();i&&(t=this.inputManager.manageChar(i,t))}this.fire("input",[e,t])}},motion_ack:function(){this.ack_wait=0},setMouseMode:function(e){(this.mouse_mode=e)==wdi.SpiceMouseModeTypes.SPICE_MOUSE_MODE_SERVER&&(this.triedCapturingPointer=!1,$.nok({message:tr.msg_click_to_capture})),this.updateMousePointer()},updateMousePointer:function(){null!=this.eventLayer&&(this.mouse_mode==wdi.SpiceMouseModeTypes.SPICE_MOUSE_MODE_CLIENT?($(this.eventLayer).css("cursor","default"),this.releasePointer()):$(this.eventLayer).css("cursor","none"))},handleKey:function(e){document.getElementById("inputmanager").focus(),e.data[0].generateEvent.call(e.data[0],e.type,[e]),(e.ctrlKey&&!e.altKey||wdi.Keymap.isInKeymap(e.keyCode)&&"keypress"!==e.type)&&e.preventDefault()},setClipBoardData:function(e){prompt("New clipboard data available, press ctrl+c to copy it",e)},initSound:function(){var e=this;this.soundStarted=!0,window.setTimeout(function(){e.fire("startAudio")},100)},releasePointer:function(){"function"==typeof document.exitPointerLock&&document.exitPointerLock()},capturePointer:function(){document.pointerLockElement||document.mozPointerLockElement||"function"!=typeof this.eventLayer.requestPointerLock||this.eventLayer.requestPointerLock()}}),wdi.PacketProcess=$.spcExtend(wdi.DomainObject,{processors:{},init:function(e){this.processors[wdi.SpiceVars.SPICE_CHANNEL_MAIN]=e.mainProcess||new wdi.MainProcess({app:e.app}),this.processors[wdi.SpiceVars.SPICE_CHANNEL_DISPLAY]=e.displayProcess||new wdi.DisplayPreProcess({clientGui:e.clientGui}),this.processors[wdi.SpiceVars.SPICE_CHANNEL_INPUTS]=e.inputsProcess||new wdi.InputProcess({clientGui:e.clientGui,spiceConnection:e.spiceConnection}),this.processors[wdi.SpiceVars.SPICE_CHANNEL_CURSOR]=e.cursorProcess||new wdi.CursorProcess,this.processors[wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK]=e.playbackProcess||new wdi.PlaybackProcess({app:e.app})},process:function(e){return wdi.exceptionHandling?this.processExceptionHandled(e):this.processPacket(e)},processExceptionHandled:function(e){try{return this.processPacket(e)}catch(e){wdi.Debug.error("PacketProcess: Error processing packet",e)}},processPacket:function(e){if(!e||!this.processors[e.channel])throw"Invalid channel or null message";this.processors[e.channel].process(e)},dispose:function(){this.processors[wdi.SpiceVars.SPICE_CHANNEL_DISPLAY].dispose()}}),wdi.PacketFilter={restoreContext:!1,start:null,filter:function(e,t,i,n){if(wdi.logOperations&&(this.start=Date.now()),wdi.graphicDebug&&wdi.graphicDebug.debugMode&&wdi.graphicDebug.printDebugMessageOnFilter(e,n),wdi.IntegrationBenchmark&&wdi.IntegrationBenchmark.benchmarking){var s=new Date;wdi.IntegrationBenchmark.setStartTime(s.getTime())}if(e.args.base&&e.args.base.clip.type===wdi.SpiceClipType.SPICE_CLIP_TYPE_RECTS){var o=n.getContext(e.args.base.surface_id);o.save(),o.beginPath();for(var a=e.args.base.clip.rects.rects,r=a.length;r--;){var c=wdi.graphics.getBoxFromSrcArea(a[r]);o.rect(c.x,c.y,c.width,c.height)}o.clip(),this.restoreContext=e.args.base.surface_id}t.call(i,e)},notifyEnd:function(e,t){!1!==this.restoreContext&&(t.getContext(this.restoreContext).restore(),this.restoreContext=!1);if(wdi.SeamlessIntegration){var i=null;e.args.base&&e.args.base.box&&(i=e.args.base.box),t.fillSubCanvas(i)}if(wdi.graphicDebug&&wdi.graphicDebug.debugMode&&wdi.graphicDebug.printDebugMessageOnNotifyEnd(e,t),wdi.IntegrationBenchmark&&wdi.IntegrationBenchmark.benchmarking){var n=new Date;wdi.IntegrationBenchmark.setEndTime(n.getTime())}wdi.GlobalPool.cleanPool("Canvas"),wdi.GlobalPool.cleanPool("Image"),wdi.logOperations&&wdi.DataLogger.log(e,this.start)}},wdi.PacketFactory={extract:function(e){var t=null;switch(e.channel){case wdi.SpiceVars.SPICE_CHANNEL_DISPLAY:if(wdi.graphicDebug&&wdi.graphicDebug.debugMode)var i=JSON.stringify(e);switch(e.header.type){case wdi.SpiceVars.SPICE_MSG_DISPLAY_MODE:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_MARK:t=(new wdi.SpiceDisplayMark).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_RESET:t=(new wdi.SpiceDisplayReset).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_COPY_BITS:t=(new wdi.SpiceCopyBits).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_LIST:t=(new wdi.SpiceResourceList).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_ALL_PIXMAPS:case wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_PALETTE:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_ALL_PALETTES:t=(new wdi.SpiceDisplayInvalidAllPalettes).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_CREATE:t=(new wdi.SpiceStreamCreate).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DATA:t=(new wdi.SpiceStreamData).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_CLIP:t=(new wdi.SpiceStreamClip).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DESTROY:t=(new wdi.SpiceStreamDestroy).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DESTROY_ALL:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_FILL:t=(new wdi.SpiceDrawFill).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_OPAQUE:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_COPY:t=(new wdi.SpiceDrawCopy).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLEND:t=(new wdi.drawBlend).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLACKNESS:t=(new wdi.SpiceDrawBlackness).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_WHITENESS:t=(new wdi.SpiceDrawWhiteness).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_INVERS:t=(new wdi.SpiceDrawInvers).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ROP3:t=(new wdi.SpiceDrawRop3).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_STROKE:t=(new wdi.SpiceStroke).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TEXT:t=(new wdi.SpiceDrawText).demarshall(e.body,e.header.size);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TRANSPARENT:t=(new wdi.drawTransparent).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ALPHA_BLEND:t=(new wdi.drawAlphaBlend).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_SURFACE_CREATE:t=(new wdi.SpiceSurface).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_SURFACE_DESTROY:t=(new wdi.SpiceSurfaceDestroy).demarshall(e.body)}break;case wdi.SpiceVars.SPICE_CHANNEL_INPUTS:switch(e.header.type){case wdi.SpiceVars.SPICE_MSG_INPUTS_MOUSE_MOTION_ACK:t=new Object}break;case wdi.SpiceVars.SPICE_CHANNEL_MAIN:switch(e.header.type){case wdi.SpiceVars.SPICE_MSG_MAIN_INIT:t=(new wdi.RedMainInit).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_DATA:t=(new wdi.VDAgentMessage).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_DISCONNECTED:t=(new wdi.SpiceMsgMainAgentDisconnected).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_CONNECTED:t=(new wdi.SpiceMsgMainAgentConnected).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_MULTI_MEDIA_TIME:t=(new wdi.MainMultiMediaTime).demarshall(e.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_CHANNELS_LIST:t=(new wdi.MainMChannelsList).demarshall(e.body)}break;case wdi.SpiceVars.SPICE_CHANNEL_CURSOR:switch(e.header.type){case wdi.SpiceVars.SPICE_MSG_CURSOR_INIT:t=(new wdi.RedCursorInit).demarshall(e.body,e.header.size);break;case wdi.SpiceVars.SPICE_MSG_CURSOR_SET:t=(new wdi.RedCursorSet).demarshall(e.body,e.header.size)}break;case wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK:switch(e.header.type){case wdi.SpiceVars.SPICE_MSG_PLAYBACK_MODE:t=(new wdi.PlaybackMode).demarshall(e.body,e.header.size);break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_START:t=(new wdi.PlaybackStart).demarshall(e.body,e.header.size);break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_STOP:t=(new wdi.PlaybackStop).demarshall(e.body,e.header.size);break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_DATA:t=(new wdi.PlaybackData).demarshall(e.body,e.header.size)}}return t?(wdi.graphicDebug&&wdi.graphicDebug.debugMode&&i&&(t.originalData=i),new wdi.SpiceMessage({messageType:e.header.type,channel:e.channel,args:t})):(wdi.Debug.log(e.header.type,e.header.channel),!1)}},Application=$.spcExtend(wdi.DomainObject,{spiceConnection:null,clientGui:null,agent:null,externalCallback:null,keyboardEnabled:!0,packetProcess:null,inputProcess:null,multimediaTime:null,lastMultimediaTime:null,busConnection:null,busProcess:null,timeLapseDetector:null,init:function(e){wdi.GlobalPool.init(),this.spiceConnection=e.spiceConnection||new wdi.SpiceConnection,this.clientGui=e.clientGui||new wdi.ClientGui,this.agent=e.agent||new wdi.Agent({app:this}),this.inputProcess=e.inputProcess||new wdi.InputProcess({clientGui:this.clientGui,spiceConnection:this.spiceConnection}),this.packetProcess=e.packetProcess,this.busConnection=e.busConnection||new wdi.BusConnection,this.busProcess=e.busProcess||new wdi.BusProcess({clientGui:this.clientGui,busConnection:this.busConnection}),this.timeLapseDetector=e.timeLapseDetector||new wdi.TimeLapseDetector,this.setup()},run:function(e){if(e.hasOwnProperty("seamlessDesktopIntegration")&&(wdi.SeamlessIntegration=e.seamlessDesktopIntegration),!this.packetProcess){var t=!1;!1===e.useWorkers&&(t=new wdi.DisplayProcess({clientGui:this.clientGui})),this.packetProcess=new wdi.PacketProcess({app:this,clientGui:this.clientGui,agent:this.agent,spiceConnection:this.spiceConnection,inputsProcess:this.inputProcess,displayProcess:t})}if(window.vdiLoadTest?this.spiceConnection.addListener("message",this.onMessage,this):this.spiceConnection.addListener("message",this.packetProcess.process,this.packetProcess),this.busConnection.connect(e),this.timeLapseDetector.startTimer(),e.canvasMargin&&this.clientGui.setCanvasMargin(e.canvasMargin),e.disableClipboard&&(this.agent.disableClipboard(),this.clientGui.disableClipboard(),this.enableCtrlV()),e.layer&&this.clientGui.setLayer(e.layer),this.clientGui.checkFeatures()){wdi.SeamlessIntegration&&this.disableKeyboard(),wdi.Keymap.loadKeyMap(e.layout),this.setExternalCallback(e.callback,e.context);try{this.connect({host:e.host,port:e.port,protocol:e.protocol,vmHost:e.vmHost,vmPort:e.vmPort,vmInfoToken:e.vmInfoToken,busHost:e.busHost,token:e.token,connectionControl:e.connectionControl,heartbeatToken:e.heartbeatToken,heartbeatTimeout:e.heartbeatTimeout})}catch(e){this.executeExternalCallback("error",1)}}e.hasOwnProperty("externalClipboardHandling")&&(this.externalClipoardHandling=e.externalClipboardHandling)},end:function(){},setup:function(){this.spiceConnection.addListener("mouseMode",this.onMouseMode,this),this.spiceConnection.addListener("initAgent",this.onInitAgent,this),this.spiceConnection.addListener("error",this.onDisconnect,this),this.spiceConnection.addListener("channelConnected",this.onChannelConnected,this),this.clientGui.addListener("input",this.onClientInput,this),this.clientGui.addListener("resolution",this.onResolution,this),this.clientGui.addListener("paste",this.onPaste,this),this.clientGui.addListener("startAudio",this.onStartAudio,this),this.busProcess.addListener("windowCreated",this.onWindowCreated,this),this.busProcess.addListener("windowClosed",this.onWindowClosed,this),this.busProcess.addListener("windowMoved",this.onWindowMoved,this),this.busProcess.addListener("windowResized",this.onWindowResized,this),this.busProcess.addListener("windowFocused",this.onWindowFocused,this),this.busProcess.addListener("windowMinimized",this.onWindowMinimized,this),this.busProcess.addListener("windowRestored",this.onWindowRestored,this),this.busProcess.addListener("windowMaximized",this.onWindowMaximized,this),this.busProcess.addListener("busConnected",this.onBusConnected,this),this.busProcess.addListener("menuResponse",this.onMenuResponse,this),this.busProcess.addListener("networkDriveResponse",this.onNetworkDriveResponse,this),this.busProcess.addListener("wrongPathError",this.onWrongPathError,this),this.busProcess.addListener("applicationLaunchedSuccessfully",this.onApplicationLaunchedSuccessfully,this),this.agent.addListener("clipBoardData",this.onClipBoardData,this),this.busConnection.addListener("busMessage",this.onBusMessage,this),this.busConnection.addListener("error",this.onDisconnect,this),this.timeLapseDetector.addListener("timeLapseDetected",this.onTimeLapseDetected,this),this.enableKeyboard()},onChannelConnected:function(e){e===wdi.SpiceVars.SPICE_CHANNEL_INPUTS&&this.clientGui.releaseAllKeys()},onNetworkDriveResponse:function(e){this.executeExternalCallback("networkDriveResponse",e)},onDisconnect:function(e){var t=e;this.executeExternalCallback("error",t)},onResolution:function(e){this.executeExternalCallback("resolution",e)},onClipBoardData:function(e){this.externalClipoardHandling?this.executeExternalCallback("clipboardEvent",e):this.clientGui.setClipBoardData(e)},onWindowMinimized:function(e){var t=e;e=this.clientGui.resizeSubCanvas(t);this.executeExternalCallback("windowMinimized",e)},onWindowFocused:function(e){this.executeExternalCallback("windowFocused",e)},onWindowRestored:function(e){var t=e;e=this.clientGui.resizeSubCanvas(t);this.executeExternalCallback("windowRestored",e)},onWindowMaximized:function(e){var t=e;e=this.clientGui.resizeSubCanvas(t);this.executeExternalCallback("windowMaximized",e)},onWindowResized:function(e){var t=e;e=this.clientGui.resizeSubCanvas(t);this.executeExternalCallback("windowResized",e)},onWindowMoved:function(e){var t=e;e=this.clientGui.moveSubCanvas(t);this.executeExternalCallback("windowMoved",e)},onWindowClosed:function(e){var t=e;e=this.clientGui.deleteSubCanvas(t);this.executeExternalCallback("windowClosed",e)},onWindowCreated:function(e){var t=e;e=this.clientGui.createNewSubCanvas(t);this.executeExternalCallback("windowCreated",e)},onMenuResponse:function(e){var t=e;this.executeExternalCallback("menuResponse",t)},onClientInput:function(e){var t=e,i=t[0];this.inputProcess.send(t,i)},onMessage:function(e){var t=e;this.packetProcess.process(t);var i=this;window.checkResultsTimer&&clearTimeout(window.checkResultsTimer),window.checkResultsTimer=window.setTimeout(function(){i.executeExternalCallback("checkResults"),window.vdiLoadTest=!1},5e3)},onBusConnected:function(e){wdi.SeamlessIntegration&&this.busProcess.requestWindowList()},onBusMessage:function(e){var t=e;this.busProcess.process(t)},onInitAgent:function(e){this.agent.setClientTokens(e),this.agent.sendInitMessage(this),this.executeExternalCallback("ready",e)},onMouseMode:function(e){this.clientGui.setMouseMode(e)},onPaste:function(e){this.agent.setClipboard(e)},onStartAudio:function(){this.packetProcess.processors[wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK].startAudio()},onTimeLapseDetected:function(e){var t=e;this.executeExternalCallback("timeLapseDetected",t)},connect:function(e){try{this.spiceConnection.connect(e)}catch(e){this.clientGui.showError(e.message)}},setExternalCallback:function(e,t){this.externalCallback=[e,t]},executeExternalCallback:function(e,t){this.externalCallback[0].call(this.externalCallback[1],e,t)},sendCommand:function(e,t){switch(e){case"close":this.busProcess.closeWindow(t.hwnd);break;case"move":this.busProcess.moveWindow(t.hwnd,t.x,t.y);break;case"minimize":this.busProcess.minimizeWindow(t.hwnd);break;case"maximize":this.busProcess.maximizeWindow(t.hwnd);break;case"restore":this.busProcess.restoreWindow(t.hwnd);break;case"focus":this.busProcess.focusWindow(t.hwnd);break;case"resize":this.busProcess.resizeWindow(t.hwnd,t.width,t.height);break;case"run":this.busProcess.executeCommand(t.cmd);break;case"setResolution":this.agent.setResolution(t.width,t.height);break;case"getMenu":this.busProcess.getMenu();break;case"reMountNetworkDrive":this.busProcess.reMountNetworkDrive(t.host,t.username,t.password)}},enableKeyboard:function(){this.clientGui.enableKeyboard()},disableKeyboard:function(){this.clientGui.disableKeyboard()},enableCtrlV:function(){wdi.KeymapES.setCtrlKey(86,47),wdi.KeymapUS.setCtrlKey(86,47)},disconnect:function(){this.busConnection.disconnect(),this.spiceConnection.disconnect()},setMultimediaTime:function(e){this.multimediaTime=e,this.lastMultimediaTime=Date.now()},sendKeyList:function(e){for(i=0;i<e.length;i++)this.inputProcess.send(["keydown",[{generated:!0,type:"keydown",keyCode:e[i],charCode:0}]],"keydown");for(e.reverse(),i=0;i<e.length;i++)this.inputProcess.send(["keyup",[{generated:!0,type:"keyup",keyCode:e[i],charCode:0}]],"keyup")},sendShortcut:function(e){e==wdi.keyShortcutsHandled.CTRLV&&this.sendKeyList([17,86])},sendKeystroke:function(e){"Ctrl+Alt+Del"==e?this.sendKeyList([17,18,46]):"Win+L"==e?this.sendKeyList([91,76]):"Ctrl+Win+Right"==e?this.sendKeyList([17,91,39]):"Ctrl+Win+Left"==e?this.sendKeyList([17,91,37]):"Ctrl+Alt+F1"==e?this.sendKeyList([17,18,112]):"Ctrl+Alt+F2"==e?this.sendKeyList([17,18,113]):"Ctrl+Alt+F3"==e?this.sendKeyList([17,18,114]):"Ctrl+Alt+F4"==e?this.sendKeyList([17,18,115]):"Ctrl+Alt+F5"==e?this.sendKeyList([17,18,116]):"Ctrl+Alt+F6"==e?this.sendKeyList([17,18,117]):"Ctrl+Alt+F7"==e?this.sendKeyList([17,18,118]):"Ctrl+Alt+F8"==e?this.sendKeyList([17,18,119]):"Ctrl+Alt+F9"==e?this.sendKeyList([17,18,120]):"Ctrl+Alt+F10"==e?this.sendKeyList([17,18,121]):"Ctrl+Alt+F11"==e?this.sendKeyList([17,18,122]):"Ctrl+Alt+F12"==e&&this.sendKeyList([17,18,123])},dispose:function(){this.disableKeyboard(),this.disconnect(),this.packetProcess.dispose()},onWrongPathError:function(e){this.executeExternalCallback("wrongPathError",e)},onApplicationLaunchedSuccessfully:function(e){this.executeExternalCallback("applicationLaunchedSuccessfully",e)},getKeyboardHandler:function(){return this.clientGui.handleKey},getClientGui:function(){return this.clientGui},setCurrentWindow:function(e){this.clientGui.inputManager.setCurrentWindow(e)}}),window.Application=Application,Application.prototype.run=Application.prototype.run,Application.prototype.sendCommand=Application.prototype.sendCommand,Application.prototype.enableKeyboard=Application.prototype.enableKeyboard,Application.prototype.disableKeyboard=Application.prototype.disableKeyboard,Application.prototype.dispose=Application.prototype.dispose,Application.prototype.getKeyboardHandler=Application.prototype.getKeyboardHandler,Application.prototype.getClientGui=Application.prototype.getClientGui,Application.prototype.setCurrentWindow=Application.prototype.setCurrentWindow,wdi.VirtualMouse={eventLayers:[],mouseData:null,visible:null,lastLayer:null,hotspot:{x:0,y:0},lastMousePosition:{x:0,y:0,width:0,height:0},setHotspot:function(e,t){this.hotspot.x=e,this.hotspot.y=t},setEventLayer:function(e,t,i,n,s,o){this.eventLayers.push({layer:e,left:t,top:i,right:t+n,bottom:i+s,position:o})},removeEventLayer:function(e){for(var t=this.eventLayers.length,i=0;i<t;i++)this.eventLayers[i].layer.id===e.id&&(this.eventLayers[e.id]=void 0)},getEventLayer:function(e,t){for(var i=this.eventLayers.length,n=null,s=0;s<i;s++)if(e>=(n=this.eventLayers[s]).left&&e<=n.right&&t>=n.top&&t<=n.bottom)return n.layer},setMouse:function(e,t,i){for(var n=this.eventLayers.length,s=0;s<n;s++)this.eventLayers[s].layer.style.cursor="url("+e+") "+t+" "+i+", default"}},wdi.ImageCache={images:{},cursor:{},palettes:{},getImageFrom:function(e,t){var i=wdi.GlobalPool.create("Canvas"),n=this.images[e.id.toString()];i.width=n.width,i.height=n.height,i.getContext("2d").putImageData(n,0,0),t(i)},isImageInCache:function(e){return e.id.toString()in this.images},delImage:function(e){delete this.images[e.toString()]},addImage:function(e,t){t.getContext?this.images[e.id.toString()]=t.getContext("2d").getImageData(0,0,t.width,t.height):this.images[e.id.toString()]=t},getCursorFrom:function(e){return this.cursor[e.header.unique.toString()]},addCursor:function(e,t){this.cursor[e.header.unique.toString()]=t},getPalette:function(e){return this.palettes[e.toString()]},addPalette:function(e,t){this.palettes[e.toString()]=t},clearPalettes:function(){this.palettes={}}},wdi.RasterOperation={process:function(e,t,i){var n=null;return e&wdi.SpiceRopd.SPICE_ROPD_INVERS_SRC?t=this.invert(t):e&wdi.SpiceRopd.SPICE_ROPD_INVERS_BRUSH?t=this.invert(t):e&wdi.SpiceRopd.SPICE_ROPD_INVERS_DEST&&(i=this.invert(i)),e&wdi.SpiceRopd.SPICE_ROPD_OP_PUT?t:(e&wdi.SpiceRopd.SPICE_ROPD_OP_OR?n=this.boolOp(t,i,"or"):e&wdi.SpiceRopd.SPICE_ROPD_OP_AND?n=this.boolOp(t,i,"and"):e&wdi.SpiceRopd.SPICE_ROPD_OP_XOR?n=this.boolOp(t,i,"xor"):e&wdi.SpiceRopd.SPICE_ROPD_OP_BLACKNESS?n=this.lightness(i,"b"):e&wdi.SpiceRopd.SPICE_ROPD_OP_WHITENESS?n=this.lightness(i):e&wdi.SpiceRopd.SPICE_ROPD_OP_INVERS&&(n=this.invert(i)),e&wdi.SpiceRopd.SPICE_ROPD_INVERS_RES?this.invert(n):n)},flip:function(e){return e=wdi.Flipper.flip(e)},invert:function(e){return e=$(e).pixastic("invert")[0]},lightness:function(e,t){t="b"===t?-100:100;return e=$(e).pixastic("hsl",{hue:30,saturation:20,lightness:t})[0]},boolOp:function(e,t,i){var n=wdi.graphics.getDataFromImage(e).data,s=wdi.graphics.getDataFromImage(t).data,o=n.length-1,a=wdi.graphics.getNewTmpCanvas(e.width,e.height),r=a.getContext("2d"),c=r.createImageData(e.width,e.height),d=c.data;if("or"===i)for(;0<o;)c.data[o]=255,d[o-1]=n[o-1]|s[o-1],d[o-2]=n[o-2]|s[o-2],d[o-3]=n[o-3]|s[o-3],o-=4;else if("and"===i)for(;0<o;)c.data[o]=255,d[o-1]=n[o-1]&s[o-1],d[o-2]=n[o-2]&s[o-2],d[o-3]=n[o-3]&s[o-3],o-=4;else if("xor"===i)for(;0<o;)c.data[o]=255,d[o-1]=n[o-1]^s[o-1],d[o-2]=n[o-2]^s[o-2],d[o-3]=n[o-3]^s[o-3],o-=4;return r.putImageData(c,0,0),a}},wdi.Stream={streams:{},addStream:function(e,t){this.streams[e]=t},deleteStream:function(e){this.streams[e]=void 0},getStream:function(e){return this.streams[e]},clip:function(e,t){this.streams[e].clip=t}},wdi.InputManager=$.spcExtend(wdi.EventObject.prototype,{checkFocus:!1,input:null,window:null,stuckKeysHandler:null,init:function(e){this.superInit(),this.input=e.input,this.window=e.window,this.stuckKeysHandler=e.stuckKeysHandler,this.$=e.jQuery||$,e.disableInput||(this.inputElement=this.$('<div style="position:absolute"><input type="text" id="inputmanager" style="opacity:0;color:transparent"/></div>')),this.currentWindow=null},setCurrentWindow:function(e){e=this.$(e),this.currentWindow&&(this.inputElement.remove(),this.currentWindow.unbind("blur")),this.$(e[0].document.body).prepend(this.inputElement),this.input=this.$(e[0].document.getElementById("inputmanager")),this.addListeners(e),this.currentWindow=e},addListeners:function(e){this._onBlur(e),this._onInput()},_onBlur:function(e){var t=this;e.on("blur",function(e){t.checkFocus&&t.input.focus(),t.stuckKeysHandler.releaseSpecialKeysPressed()})},_onInput:function(){var t=this;this.input.on("input",function(e){1<t.input.val().length&&t.reset()})},enable:function(){this.checkFocus=!0,this.input.select()},disable:function(){this.checkFocus=!1,this.input.blur()},reset:function(){this.input.val("")},getValue:function(){var e=this.input.val();return e&&this.reset(),e},manageChar:function(e,t){var i=[Object.create(t[0])];return i[0].type="inputmanager",i[0].charCode=e.charCodeAt(0),i}}),wdi.BUS_TYPES={file:0,print:1,launchApplication:2,windowManagement:3,menu:5,networkDriveManagement:6,killApplicationDoNotUseInProductionEver:34423423},wdi.BusProcess=$.spcExtend(wdi.EventObject.prototype,{busConnection:null,clientGui:null,init:function(e){this.superInit(),this.clientGui=e.clientGui,this.busConnection=e.busConnection},process:function(e){switch(e.verb){case"CONNECTED":this.busConnection.setSubscriptions(),this.fire("busConnected");break;case"MESSAGE":this.parseMessage(e.body);break;case"ERROR":break;default:wdi.Debug.warn("Not implemented Stomp Verb: "+e.verb)}},parseMessage:function(e){switch(parseInt(e.type)){case wdi.BUS_TYPES.launchApplication:this.parseLaunchApplicationMessage(e);break;case wdi.BUS_TYPES.killApplicationDoNotUseInProductionEver:break;case wdi.BUS_TYPES.windowManagement:this.parseWindowManagementMessage(e);break;case wdi.BUS_TYPES.menu:this.handleMenuMessage(e);break;case wdi.BUS_TYPES.networkDriveManagement:this._handleNetworkDriveMessage(e);break;default:wdi.Debug.info("Bus type '"+e.type+"' not implemented.")}},_handleNetworkDriveMessage:function(e){"reMountNetworkDrive"!=e.event&&this.fire("networkDriveResponse",e)},getMenu:function(){this.busConnection.send({type:wdi.BUS_TYPES.menu,value:!1,event:"request"})},handleMenuMessage:function(e){"response"==e.event&&this.fire("menuResponse",e)},parseWindowManagementMessage:function(e){switch(e.event){case"windowList":case"windowCreated":case"windowClosed":case"windowMoved":case"windowResized":case"windowFocused":case"windowMinimized":case"windowRestored":case"windowMaximized":this.fire(e.event,e.value);break;default:wdi.Debug.info("Event '"+e.event+"' not implemented.")}},closeWindow:function(e){this.busConnection.send(this._constructWindowManagementMessage({event:"closeWindow",hwnd:e}))},moveWindow:function(e,t,i){this.busConnection.send(this._constructWindowManagementMessage({event:"moveWindow",hwnd:e,left:t,top:i}))},minimizeWindow:function(e){this.busConnection.send(this._constructWindowManagementMessage({event:"minimizeWindow",hwnd:e}))},maximizeWindow:function(e){this.busConnection.send(this._constructWindowManagementMessage({event:"maximizeWindow",hwnd:e}))},restoreWindow:function(e){this.busConnection.send(this._constructWindowManagementMessage({event:"restoreWindow",hwnd:e}))},focusWindow:function(e){this.busConnection.send(this._constructWindowManagementMessage({event:"focusWindow",hwnd:e}))},resizeWindow:function(e,t,i){this.busConnection.send(this._constructWindowManagementMessage({event:"resizeWindow",hwnd:e,width:t,height:i}))},requestWindowList:function(){this.busConnection.send(this._constructWindowManagementMessage({event:"getWindowList"}))},executeCommand:function(e){this.busConnection.send({type:wdi.BUS_TYPES.launchApplication,application:e})},_constructWindowManagementMessage:function(e){if(void 0===e.event)throw new Error("You should pass an 'event' attribute in the object");var t={type:wdi.BUS_TYPES.windowManagement,event:e.event,value:{}};for(var i in e)"event"!=i&&e.hasOwnProperty(i)&&(t.value[i]=e[i]);return t},reMountNetworkDrive:function(e,t,i){this.busConnection.send({type:wdi.BUS_TYPES.networkDriveManagement,event:"reMountNetworkDrive",host:e,username:t,password:i})},parseLaunchApplicationMessage:function(e){switch(e.event){case"applicationLauncherWrongAppPathError":this.fire("wrongPathError",e);break;case"applicationLaunchedSuccessfully":this.fire("applicationLaunchedSuccessfully",e);break;default:wdi.Debug.info("Event '"+e.event+"' not implemented.")}}}),wdi.DisplayProcess=$.spcExtend(wdi.EventObject.prototype,{runQ:null,packetFilter:null,init:function(e){this.runQ=e.runQ||wdi.ExecutionControl.runQ,this.packetFilter=e.packetFilter||wdi.PacketFilter,this.clientGui=e.clientGui,this.displayRouter=e.displayRouter||new wdi.DisplayRouter({clientGui:this.clientGui}),this.started=!1,this.waitingMessages=[],this.packetWorkerIdentifier=e.packetWorkerIdentifier||new wdi.PacketWorkerIdentifier},process:function(e){var t=this;this.waitingMessages.push(e),this.started||(this.timer=setInterval(function(){t.flush()},50),this.started=!0)},flush:function(){if(0!==this.waitingMessages.length){var e,t=0;this.removeRedundantDraws();for(var i=this.waitingMessages.length;t<i;)e=this.waitingMessages[t],this._process(e),t++;this.waitingMessages=[]}},removeRedundantDraws:function(){if(!(this.waitingMessages.length<2)){for(var e,t,i,n,s,o,a,r,c,d,l=this.waitingMessages.length,u={},h=[],p=!1;l--;)if(s=(t=(e=this.waitingMessages[l]).args).base,n=t.rop_descriptor,p=!1,s){if(s.surface_id,a=s.box,o=s.surface_id,i=this.packetWorkerIdentifier.getImageProperties(e),u[o]||(u[o]=[]),(!i||i&&!(i.descriptor.flags&wdi.SpiceImageFlags.SPICE_IMAGE_FLAGS_CACHE_ME))&&0===o)for(c=0;c<u[o].length;c++)if((r=u[o][c]).bottom>=a.bottom&&r.top<=a.top&&r.left<=a.left&&r.right>=a.right){p=!0,h.push(l);break}if(!p&&e.messageType===wdi.SpiceVars.SPICE_MSG_DISPLAY_COPY_BITS)break;!p&&t.getMessageProperty("overWriteScreenArea",!1)&&0==s.clip.type&&n==wdi.SpiceRopd.SPICE_ROPD_OP_PUT&&u[o].push(s.box)}for(d=0;d<h.length;d++)this.waitingMessages.splice(h[d],1)}},_process:function(e){wdi.logOperations&&wdi.DataLogger.log(e,0,null,!0,"","_decode"),this.runQ.add(function(t){this.packetFilter.filter(e,function(e){wdi.ExecutionControl.currentProxy=t,this.displayRouter.processPacket(e),this.postProcess()},this,this.clientGui),wdi.ExecutionControl.sync&&t.end()},this,function(){this.processEnd(e,this.clientGui)}),this.runQ.process()},processEnd:function(e,t){this.packetFilter.notifyEnd(e,t)},postProcess:function(){}}),wdi.DisplayPreProcess=$.spcExtend(wdi.EventObject.prototype,{displayProcess:null,queued:[],inProcess:[],idleConsumers:[],consumers:[],init:function(e){this.superInit(),this.displayProcess=e.displayProcess||new wdi.DisplayProcess({clientGui:e.clientGui}),this.clientGui=e.clientGui,null!=e.numConsumers&&null!=e.numConsumers||(e.numConsumers=4);for(var t=e.numConsumers,i=0;i<t;i++){var n=new wdi.AsyncConsumer;this.consumers.push(n),this.idleConsumers.push(n),n.addListener("done",this.onConsumerDone,this)}},onConsumerDone:function(e){for(var t=this.inProcess[0],i=null;t&&1===t.state;){i=this.inProcess.shift();try{this.displayProcess.process(i.message)}catch(e){wdi.Debug.error("DisplayPreProcess error: ",e)}t=this.inProcess[0],0}this.idleConsumers.push(e),0<this.queued.length&&this.executeConsumer()},process:function(e){this.addTask(e),this.executeConsumer()},addTask:function(e){this.queued.push({message:e,clientGui:this.clientGui})},getNextTask:function(){for(var e=this.queued.shift();void 0===e&&0!=this.queued.length;)e=this.queued.shift();return void 0!==e&&(e.state=0,this.inProcess.push(e),e)},executeConsumer:function(){if(0<this.idleConsumers.length){wdi.Debug.log("DisplayPreProcess: available workers: "+this.idleConsumers.length),wdi.Debug.log("DisplaypreProcess: pending tasks: "+this.queued.length);var e=this.idleConsumers.shift(),t=this.getNextTask();t&&e.consume(t)}},dispose:function(){this.consumers.forEach(function(e){e.dispose()})}}),wdi.InputProcess=$.spcExtend(wdi.EventObject.prototype,{clientGui:null,spiceConnection:null,pendingCtrlKey:!1,pendingAltKey:!1,altGrCombo:!1,init:function(e){this.superInit(),this.clientGui=e.clientGui,this.spiceConnection=e.spiceConnection},process:function(e){switch(e.messageType){case wdi.SpiceVars.SPICE_MSG_INPUTS_MOUSE_MOTION_ACK:this.clientGui.motion_ack()}},send:function(e,t){var i,n,s;if(setInactivityTimer(),"mousemove"==t)if(e[1][3]==wdi.SpiceMouseModeTypes.SPICE_MOUSE_MODE_CLIENT)i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_POSITION,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMousePosition({x:e[1][0]+wdi.VirtualMouse.hotspot.x,y:e[1][1]+wdi.VirtualMouse.hotspot.y,buttons_state:e[1][2],display_id:0})}),this.spiceConnection.send(i);else{var o=e[1][0],a=e[1][1];0==o&&0==a||(i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_MOTION,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMouseMotion({x:o,y:a,buttons_state:e[1][2]})}),this.spiceConnection.send(i)),wdi.VirtualMouse.lastMousePosition.x+=o,wdi.VirtualMouse.lastMousePosition.y+=a}else if("mousedown"==t)i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_PRESS,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMousePress({button_id:e[1]+1,buttons_state:1<<e[1]})}),this.spiceConnection.send(i);else if("mouseup"==t)i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_RELEASE,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMousePress({button_id:e[1]+1,buttons_state:0})}),this.spiceConnection.send(i);else if("keydown"==t){if(1==(n=wdi.Keymap.getScanCodes(e[1][0],this.altGrCombo,t)).length&&!e[1][0].generated){if(56==n[0][0])return void(this.pendingCtrlKey?(this.pendingCtrlKey=!1,this.altGrCombo=!0):this.pendingAltKey=!0);if(224==n[0][0]&&29==n[0][1])return void(this.pendingAltKey?(this.pendingAltKey=!1,this.altGrCombo=!0):this.pendingCtrlKey=!0);n[0][0]}for(s=0;s<n.length;s++)this.pendingAltKey=!1,this.pendingCtrlKey=!1,i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_KEY_DOWN,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.SpiceScanCode(n[s])}),this.spiceConnection.send(i)}else if("keyup"==t){if(1==(n=wdi.Keymap.getScanCodes(e[1][0],this.altGrCombo,t)).length&&184==n[0][0])if(this.pendingAltKey)i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_KEY_DOWN,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.SpiceScanCode([56,0,0])}),this.spiceConnection.send(i);else if(this.altGrCombo)return void(this.altGrCombo=!1);if(1==n.length&&224==n[0][0]&&157==n[0][1])if(this.pendingCtrlKey)i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_KEY_DOWN,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.SpiceScanCode([224,29,0])}),this.spiceConnection.send(i);else if(this.altGrCombo)return void(this.altGrCombo=!1);for(s=0;s<n.length;s++)this.pendingAltKey=!1,this.pendingCtrlKey=!1,i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_KEY_UP,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.SpiceScanCode(n[s])}),this.spiceConnection.send(i)}else"joystick"==t&&(i=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_MOTION,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMouseMotion({x:e[1][0],y:e[1][1],buttons_state:0})}),this.spiceConnection.send(i))}}),wdi.CursorProcess=$.spcExtend(wdi.EventObject.prototype,{imageData:null,process:function(e){switch(e.messageType){case wdi.SpiceVars.SPICE_MSG_CURSOR_INIT:case wdi.SpiceVars.SPICE_MSG_CURSOR_SET:var t=this.extractCursor(e);t&&(wdi.VirtualMouse.setHotspot(0,0),wdi.VirtualMouse.setMouse(t.data,t.header.hot_spot_x,t.header.hot_spot_y))}},_toUrl:function(e){var t=$("<canvas/>").attr({width:e.width,height:e.height})[0];return t.getContext("2d").putImageData(e,0,0),t.toDataURL("image/png")},extractCursor:function(e){var t=e.args.cursor.flags,i=e.args.position,n=e.args.visible;if(1&t)return null;var s=null;if(t&wdi.SpiceCursorFlags.SPICE_CURSOR_FLAGS_FROM_CACHE)s=wdi.ImageCache.getCursorFrom(e.args.cursor);else switch(e.args.cursor.header.type){case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_ALPHA:s=this._toUrl(wdi.graphics.argbToImageData(e.args.cursor.data,e.args.cursor.header.width,e.args.cursor.header.height));break;case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_MONO:s=this._toUrl(wdi.graphics.monoToImageData(e.args.cursor.data,e.args.cursor.header.width,e.args.cursor.header.height));break;case 8:s=wdi.SpiceObject.bytesToString(e.args.cursor.data);break;case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR4:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR8:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR16:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR24:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR32:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_ENUM_END:}return s?(t&wdi.SpiceCursorFlags.SPICE_CURSOR_FLAGS_CACHE_ME&&wdi.ImageCache.addCursor(e.args.cursor,s),{data:s,position:i,visible:n,header:e.args.cursor.header}):null}}),wdi.PlaybackProcess=$.spcExtend(wdi.EventObject.prototype,{_lastApp:null,started:!1,minBuffSize:32768,frequency:null,channels:null,audioContext:null,startTime:null,hasAudioSupport:!0,typedBuffer:null,position:null,init:function(e){this.app=e.app,this.audioContext=this.getAudioContext(),this.audioContext?this.hasAudioSupport=!0:(this.hasAudioSupport=!1,wdi.Debug.warn("The client browser does not support Web Audio API")),this.startTime=0,this.typedBuffer=new ArrayBuffer(2*this.minBuffSize),this.position=0},getAudioContext:function(){try{return new AudioContext}catch(e){}try{return new webkitAudioContext}catch(e){}return!1},process:function(e){if(this.hasAudioSupport)switch(e.messageType){case wdi.SpiceVars.SPICE_MSG_PLAYBACK_MODE:break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_START:var t=e.args;this.channels=t.channels,this.frequency=t.frequency;break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_STOP:this.startTime=0;t=e.args;this.flush();break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_DATA:t=e.args;var i=e.args.multimedia_time;new Uint8Array(this.typedBuffer).set(t.data,this.position),this.position+=t.data.length,this._lastApp=this.app,this.position>=this.minBuffSize&&this.flush(i)}},flush:function(e){0<this.position&&(this.started&&this.playSound(this.typedBuffer.slice(0,this.position),e),this.position=0)},playSound:function(e,t){if(2==this.channels)return this.playSoundStereo(e,t);for(var i=new Int16Array(e),n=new Array(this.channels),s=0;s<this.channels;s++)n[s]=new Float32Array(i.length/2);var o=0;for(s=0;s<i.length;){for(var a=0;a<this.channels;a++)n[a][o]=i[s++]/32768;o++}var r=this.audioContext.createBufferSource(),c=this.audioContext.createBuffer(this.channels,o,this.frequency);for(s=0;s<this.channels;s++)c.getChannelData(s).set(n[s]);this._play(r,c,t)},playSoundStereo:function(e,t){for(var i=new Int16Array(e),n=new Float32Array(i.length/2),s=new Float32Array(i.length/2),o=0,a=this.audioContext,r=i.length,c=0;c<r;)n[o]=i[c++]/32768,s[o]=i[c++]/32768,o++;var d=a.createBufferSource(),l=a.createBuffer(2,o,this.frequency);l.getChannelData(0).set(n),l.getChannelData(1).set(s),this._play(d,l,t)},_play:function(e,t,i){var n=0;i&&((n=i-(Date.now()-this.app.lastMultimediaTime+this.app.multimediaTime))<0&&(n=0));e.buffer=t,e.connect(this.audioContext.destination),e.start(this.startTime+n),this.startTime+=t.duration},startAudio:function(){this.started=!0,this.flush()}}),wdi.MainProcess=$.spcExtend(wdi.EventObject.prototype,{init:function(e){this.superInit(),this.app=e.app,this.spiceConnection=e.app.spiceConnection,this.agent=e.app.agent},process:function(e){var t=this.spiceConnection.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN];switch(e.messageType){case wdi.SpiceVars.SPICE_MSG_MAIN_INIT:t.connectionId=e.args.session_id,t.fire("connectionId",t.connectionId),1==e.args.agent_connected&&t.fire("initAgent",e.args.agent_tokens),t.fire("mouseMode",e.args.current_mouse_mode),this.changeMouseMode();break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_DATA:var i=e.args;this.agent.onAgentData(i);break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_CONNECTED:t.fire("initAgent",e.args.agent_tokens),this.changeMouseMode();break;case wdi.SpiceVars.SPICE_MSG_MAIN_MULTI_MEDIA_TIME:this.app.multimediaTime=e.args.multimedia_time;break;case wdi.SpiceVars.SPICE_MSG_MAIN_CHANNELS_LIST:t.fire("channelListAvailable",e.args.channels);break;case wdi.SpiceVars.SPICE_MSG_MAIN_MOUSE_MODE:t.fire("mouseMode",e.args.current_mode)}},changeMouseMode:function(){var e=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_MOUSE_MODE_REQUEST,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.SpiceMouseModeRequest({request_mode:2})});this.spiceConnection.send(e)}}),wdi.KeymapES=function(){var e={"º":[[41,0,0,0],[169,0,0,0]],"ª":[[42,0,0,0],[41,0,0,0],[169,0,0,0],[170,0,0,0]],"\\":[[224,56,0,0],[41,0,0,0],[169,0,0,0],[224,184,0,0]],1:[[2,0,0,0],[130,0,0,0]],"!":[[42,0,0,0],[2,0,0,0],[130,0,0,0],[170,0,0,0]],"|":[[224,56,0,0],[2,0,0,0],[130,0,0,0],[224,184,0,0]],2:[[3,0,0,0],[131,0,0,0]],'"':[[42,0,0,0],[3,0,0,0],[131,0,0,0],[170,0,0,0]],"@":[[224,56,0,0],[3,0,0,0],[131,0,0,0],[224,184,0,0]],3:[[4,0,0,0],[132,0,0,0]],"·":[[42,0,0,0],[4,0,0,0],[132,0,0,0],[170,0,0,0]],"#":[[224,56,0,0],[4,0,0,0],[132,0,0,0],[224,184,0,0]],4:[[5,0,0,0],[133,0,0,0]],$:[[42,0,0,0],[5,0,0,0],[133,0,0,0],[170,0,0,0]],"~":[[224,56,0,0],[5,0,0,0],[133,0,0,0],[224,184,0,0]],5:[[6,0,0,0],[134,0,0,0]],"%":[[42,0,0,0],[6,0,0,0],[134,0,0,0],[170,0,0,0]],6:[[7,0,0,0],[135,0,0,0]],"&":[[42,0,0,0],[7,0,0,0],[135,0,0,0],[170,0,0,0]],"¬":[[224,56,0,0],[7,0,0,0],[135,0,0,0],[224,184,0,0]],7:[[8,0,0,0],[136,0,0,0]],"/":[[42,0,0,0],[8,0,0,0],[136,0,0,0],[170,0,0,0]],8:[[9,0,0,0],[137,0,0,0]],"(":[[42,0,0,0],[9,0,0,0],[137,0,0,0],[170,0,0,0]],9:[[10,0,0,0],[138,0,0,0]],")":[[42,0,0,0],[10,0,0,0],[138,0,0,0],[170,0,0,0]],0:[[11,0,0,0],[139,0,0,0]],"=":[[42,0,0,0],[11,0,0,0],[139,0,0,0],[170,0,0,0]],"'":[[12,0,0,0],[140,0,0,0]],"?":[[42,0,0,0],[12,0,0,0],[140,0,0,0],[170,0,0,0]],"¡":[[13,0,0,0],[141,0,0,0]],"¿":[[42,0,0,0],[13,0,0,0],[141,0,0,0],[170,0,0,0]],q:[[16,0,0,0],[144,0,0,0]],Q:[[42,0,0,0],[16,0,0,0],[144,0,0,0],[170,0,0,0]],w:[[17,0,0,0],[145,0,0,0]],W:[[42,0,0,0],[17,0,0,0],[145,0,0,0],[170,0,0,0]],e:[[18,0,0,0],[146,0,0,0]],E:[[42,0,0,0],[18,0,0,0],[146,0,0,0],[170,0,0,0]],"€":[[224,56,0,0],[18,0,0,0],[146,0,0,0],[224,184,0,0]],r:[[19,0,0,0],[147,0,0,0]],R:[[42,0,0,0],[19,0,0,0],[147,0,0,0],[170,0,0,0]],t:[[20,0,0,0],[148,0,0,0]],T:[[42,0,0,0],[20,0,0,0],[148,0,0,0],[170,0,0,0]],y:[[21,0,0,0],[149,0,0,0]],Y:[[42,0,0,0],[21,0,0,0],[149,0,0,0],[170,0,0,0]],u:[[22,0,0,0],[150,0,0,0]],U:[[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]],i:[[23,0,0,0],[151,0,0,0]],I:[[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]],o:[[24,0,0,0],[152,0,0,0]],O:[[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]],p:[[25,0,0,0],[153,0,0,0]],P:[[42,0,0,0],[25,0,0,0],[153,0,0,0],[170,0,0,0]],"`":[[26,0,0,0],[154,0,0,0],[57,0,0,0],[185,0,0,0]],"à":[[26,0,0,0],[154,0,0,0],[30,0,0,0],[158,0,0,0]],"À":[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[30,0,0,0],[158,0,0,0]],"è":[[26,0,0,0],[154,0,0,0],[18,0,0,0],[146,0,0,0]],"È":[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[18,0,0,0],[146,0,0,0]],"ì":[[26,0,0,0],[154,0,0,0],[23,0,0,0],[151,0,0,0]],"Ì":[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[23,0,0,0],[151,0,0,0]],"ò":[[26,0,0,0],[154,0,0,0],[24,0,0,0],[152,0,0,0]],"Ò":[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[24,0,0,0],[152,0,0,0]],"ù":[[26,0,0,0],[154,0,0,0],[22,0,0,0],[150,0,0,0]],"Ù":[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[22,0,0,0],[150,0,0,0]],"â":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[30,0,0,0],[158,0,0,0]],"Â":[[26,0,0,0],[154,0,0,0],[30,0,0,0],[158,0,0,0]],"ê":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[18,0,0,0],[146,0,0,0]],"Ê":[[26,0,0,0],[154,0,0,0],[18,0,0,0],[146,0,0,0]],"î":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[23,0,0,0],[151,0,0,0]],"Î":[[26,0,0,0],[154,0,0,0],[23,0,0,0],[151,0,0,0]],"ô":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[24,0,0,0],[152,0,0,0]],"Ô":[[26,0,0,0],[154,0,0,0],[24,0,0,0],[152,0,0,0]],"û":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[22,0,0,0],[150,0,0,0]],"Û":[[26,0,0,0],[154,0,0,0],[22,0,0,0],[150,0,0,0]],"^":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[57,0,0,0],[185,0,0,0]],"[":[[224,56,0,0],[26,0,0,0],[154,0,0,0],[224,184,0,0]],"+":[[27,0,0,0],[155,0,0,0]],"*":[[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0]],"]":[[224,56,0,0],[27,0,0,0],[155,0,0,0],[224,184,0,0]],a:[[30,0,0,0],[158,0,0,0]],A:[[42,0,0,0],[30,0,0,0],[158,0,0,0],[170,0,0,0]],s:[[31,0,0,0],[159,0,0,0]],S:[[42,0,0,0],[31,0,0,0],[159,0,0,0],[170,0,0,0]],d:[[32,0,0,0],[160,0,0,0]],D:[[42,0,0,0],[32,0,0,0],[160,0,0,0],[170,0,0,0]],f:[[33,0,0,0],[161,0,0,0]],F:[[42,0,0,0],[33,0,0,0],[161,0,0,0],[170,0,0,0]],g:[[34,0,0,0],[162,0,0,0]],G:[[42,0,0,0],[34,0,0,0],[162,0,0,0],[170,0,0,0]],h:[[35,0,0,0],[163,0,0,0]],H:[[42,0,0,0],[35,0,0,0],[163,0,0,0],[170,0,0,0]],j:[[36,0,0,0],[164,0,0,0]],J:[[42,0,0,0],[36,0,0,0],[164,0,0,0],[170,0,0,0]],k:[[37,0,0,0],[165,0,0,0]],K:[[42,0,0,0],[37,0,0,0],[165,0,0,0],[170,0,0,0]],l:[[38,0,0,0],[166,0,0,0]],L:[[42,0,0,0],[38,0,0,0],[166,0,0,0],[170,0,0,0]],"ñ":[[39,0,0,0],[167,0,0,0]],"Ñ":[[42,0,0,0],[39,0,0,0],[167,0,0,0],[170,0,0,0]],"á":[[40,0,0,0],[168,0,0,0],[30,0,0,0],[158,0,0,0]],"Á":[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[30,0,0,0],[158,0,0,0]],"é":[[40,0,0,0],[168,0,0,0],[18,0,0,0],[146,0,0,0]],"É":[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[18,0,0,0],[146,0,0,0]],"í":[[40,0,0,0],[168,0,0,0],[23,0,0,0],[151,0,0,0]],"Í":[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[23,0,0,0],[151,0,0,0]],"ó":[[40,0,0,0],[168,0,0,0],[24,0,0,0],[152,0,0,0]],"Ó":[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[24,0,0,0],[152,0,0,0]],"ú":[[40,0,0,0],[168,0,0,0],[22,0,0,0],[150,0,0,0]],"Ú":[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[22,0,0,0],[150,0,0,0]],"ä":[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[30,0,0,0],[158,0,0,0]],"Ä":[[40,0,0,0],[168,0,0,0],[30,0,0,0],[158,0,0,0]],"ë":[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[18,0,0,0],[146,0,0,0]],"Ë":[[40,0,0,0],[168,0,0,0],[18,0,0,0],[146,0,0,0]],"ï":[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[23,0,0,0],[151,0,0,0]],"Ï":[[40,0,0,0],[168,0,0,0],[23,0,0,0],[151,0,0,0]],"ö":[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[24,0,0,0],[152,0,0,0]],"Ö":[[40,0,0,0],[168,0,0,0],[24,0,0,0],[152,0,0,0]],"ü":[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[22,0,0,0],[150,0,0,0]],"Ü":[[40,0,0,0],[168,0,0,0],[22,0,0,0],[150,0,0,0]],"{":[[224,56,0,0],[40,0,0,0],[168,0,0,0],[224,184,0,0]],"ç":[[43,0,0,0],[171,0,0,0]],"Ç":[[42,0,0,0],[43,0,0,0],[171,0,0,0],[170,0,0,0]],"}":[[224,56,0,0],[43,0,0,0],[171,0,0,0],[224,184,0,0]],"<":[[86,0,0,0],[214,0,0,0]],">":[[42,0,0,0],[86,0,0,0],[214,0,0,0],[170,0,0,0]],z:[[44,0,0,0],[172,0,0,0]],Z:[[42,0,0,0],[44,0,0,0],[172,0,0,0],[170,0,0,0]],x:[[45,0,0,0],[173,0,0,0]],X:[[42,0,0,0],[45,0,0,0],[173,0,0,0],[170,0,0,0]],c:[[46,0,0,0],[174,0,0,0]],C:[[42,0,0,0],[46,0,0,0],[174,0,0,0],[170,0,0,0]],v:[[47,0,0,0],[175,0,0,0]],V:[[42,0,0,0],[47,0,0,0],[175,0,0,0],[170,0,0,0]],b:[[48,0,0,0],[176,0,0,0]],B:[[42,0,0,0],[48,0,0,0],[176,0,0,0],[170,0,0,0]],n:[[49,0,0,0],[177,0,0,0]],N:[[42,0,0,0],[49,0,0,0],[177,0,0,0],[170,0,0,0]],m:[[50,0,0,0],[178,0,0,0]],M:[[42,0,0,0],[50,0,0,0],[178,0,0,0],[170,0,0,0]],",":[[51,0,0,0],[179,0,0,0]],";":[[42,0,0,0],[51,0,0,0],[179,0,0,0],[170,0,0,0]],".":[[52,0,0,0],[180,0,0,0]],":":[[42,0,0,0],[52,0,0,0],[180,0,0,0],[170,0,0,0]],"-":[[53,0,0,0],[181,0,0,0]],_:[[42,0,0,0],[53,0,0,0],[181,0,0,0],[170,0,0,0]]," ":[[57,0,0,0],[185,0,0,0]]},t=[];t[27]=1,t[9]=15,t[16]=42,t[91]=347,t[17]=29,t[8]=14,t[13]=28,t[18]=56,t[38]=72,t[37]=75,t[40]=80,t[39]=77,t[45]=82,t[46]=83,t[36]=71,t[35]=79,t[33]=73,t[34]=81,t[144]=69,t[145]=70,t[112]=59,t[113]=60,t[114]=61,t[115]=62,t[116]=63,t[117]=64,t[118]=65,t[119]=66,t[120]=67,t[121]=68,t[122]=87,t[123]=88;var i=[];i[65]=30,i[81]=16,i[87]=17,i[69]=18,i[82]=19,i[84]=20,i[89]=21,i[85]=22,i[73]=23,i[79]=24,i[80]=25,i[65]=30,i[83]=31,i[68]=32,i[70]=33,i[71]=34,i[72]=35,i[74]=36,i[75]=37,i[76]=38,i[90]=44,i[88]=45,i[67]=46,i[66]=48,i[78]=49,i[77]=50;var n=[];return n[86]=47,{getKeymap:function(){return t},getCtrlKeymap:function(){return i},getReservedCtrlKeymap:function(){return n},getCharmap:function(){return e},setCtrlKey:function(e,t){i[e]=t}}}(),wdi.KeymapIT=function(){var e={"\\":[[41,0,0,0],[169,0,0,0]],"|":[[42,0,0,0],[41,0,0,0],[169,0,0,0],[170,0,0,0]],1:[[2,0,0,0],[130,0,0,0]],"!":[[42,0,0,0],[2,0,0,0],[130,0,0,0],[170,0,0,0]],2:[[3,0,0,0],[131,0,0,0]],'"':[[42,0,0,0],[3,0,0,0],[131,0,0,0],[170,0,0,0]],3:[[4,0,0,0],[132,0,0,0]],"£":[[42,0,0,0],[4,0,0,0],[132,0,0,0],[170,0,0,0]],4:[[5,0,0,0],[133,0,0,0]],$:[[42,0,0,0],[5,0,0,0],[133,0,0,0],[170,0,0,0]],5:[[6,0,0,0],[134,0,0,0]],"%":[[42,0,0,0],[6,0,0,0],[134,0,0,0],[170,0,0,0]],6:[[7,0,0,0],[135,0,0,0]],"&":[[42,0,0,0],[7,0,0,0],[135,0,0,0],[170,0,0,0]],7:[[8,0,0,0],[136,0,0,0]],"/":[[42,0,0,0],[8,0,0,0],[136,0,0,0],[170,0,0,0]],8:[[9,0,0,0],[137,0,0,0]],"(":[[42,0,0,0],[9,0,0,0],[137,0,0,0],[170,0,0,0]],9:[[10,0,0,0],[138,0,0,0]],")":[[42,0,0,0],[10,0,0,0],[138,0,0,0],[170,0,0,0]],0:[[11,0,0,0],[139,0,0,0]],"=":[[42,0,0,0],[11,0,0,0],[139,0,0,0],[170,0,0,0]],"'":[[12,0,0,0],[140,0,0,0]],"?":[[42,0,0,0],[12,0,0,0],[140,0,0,0],[170,0,0,0]],"`":[[224,56,0,0],[12,0,0,0],[140,0,0,0],[224,184,0,0]],"ì":[[13,0,0,0],[141,0,0,0]],"^":[[42,0,0,0],[13,0,0,0],[141,0,0,0],[170,0,0,0]],"~":[[224,56,0,0],[13,0,0,0],[141,0,0,0],[224,184,0,0]],q:[[16,0,0,0],[144,0,0,0]],Q:[[42,0,0,0],[16,0,0,0],[144,0,0,0],[170,0,0,0]],w:[[17,0,0,0],[145,0,0,0]],W:[[42,0,0,0],[17,0,0,0],[145,0,0,0],[170,0,0,0]],e:[[18,0,0,0],[146,0,0,0]],E:[[42,0,0,0],[18,0,0,0],[146,0,0,0],[170,0,0,0]],"€":[[224,56,0,0],[18,0,0,0],[146,0,0,0],[224,184,0,0]],r:[[19,0,0,0],[147,0,0,0]],R:[[42,0,0,0],[19,0,0,0],[147,0,0,0],[170,0,0,0]],t:[[20,0,0,0],[148,0,0,0]],T:[[42,0,0,0],[20,0,0,0],[148,0,0,0],[170,0,0,0]],y:[[21,0,0,0],[149,0,0,0]],Y:[[42,0,0,0],[21,0,0,0],[149,0,0,0],[170,0,0,0]],u:[[22,0,0,0],[150,0,0,0]],U:[[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]],i:[[23,0,0,0],[151,0,0,0]],I:[[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]],o:[[24,0,0,0],[152,0,0,0]],O:[[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]],p:[[25,0,0,0],[153,0,0,0]],P:[[42,0,0,0],[25,0,0,0],[153,0,0,0],[170,0,0,0]],"è":[[26,0,0,0],[154,0,0,0]],"é":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0]],"[":[[224,56,0,0],[26,0,0,0],[154,0,0,0],[224,184,0,0]],"{":[[224,56,0,0],[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[224,184,0,0]],"+":[[27,0,0,0],[155,0,0,0]],"*":[[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0]],"]":[[224,56,0,0],[27,0,0,0],[155,0,0,0],[224,184,0,0]],"}":[[224,56,0,0],[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0],[224,184,0,0]],a:[[30,0,0,0],[158,0,0,0]],A:[[42,0,0,0],[30,0,0,0],[158,0,0,0],[170,0,0,0]],s:[[31,0,0,0],[159,0,0,0]],S:[[42,0,0,0],[31,0,0,0],[159,0,0,0],[170,0,0,0]],d:[[32,0,0,0],[160,0,0,0]],D:[[42,0,0,0],[32,0,0,0],[160,0,0,0],[170,0,0,0]],f:[[33,0,0,0],[161,0,0,0]],F:[[42,0,0,0],[33,0,0,0],[161,0,0,0],[170,0,0,0]],g:[[34,0,0,0],[162,0,0,0]],G:[[42,0,0,0],[34,0,0,0],[162,0,0,0],[170,0,0,0]],h:[[35,0,0,0],[163,0,0,0]],H:[[42,0,0,0],[35,0,0,0],[163,0,0,0],[170,0,0,0]],j:[[36,0,0,0],[164,0,0,0]],J:[[42,0,0,0],[36,0,0,0],[164,0,0,0],[170,0,0,0]],k:[[37,0,0,0],[165,0,0,0]],K:[[42,0,0,0],[37,0,0,0],[165,0,0,0],[170,0,0,0]],l:[[38,0,0,0],[166,0,0,0]],L:[[42,0,0,0],[38,0,0,0],[166,0,0,0],[170,0,0,0]],"ò":[[39,0,0,0],[167,0,0,0]],"ç":[[42,0,0,0],[39,0,0,0],[167,0,0,0],[170,0,0,0]],"@":[[224,56,0,0],[39,0,0,0],[167,0,0,0],[224,184,0,0]],"à":[[40,0,0,0],[168,0,0,0]],"°":[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0]],"#":[[224,56,0,0],[40,0,0,0],[168,0,0,0],[224,184,0,0]],"ù":[[43,0,0,0],[171,0,0,0]],"§":[[42,0,0,0],[43,0,0,0],[171,0,0,0],[170,0,0,0]],"<":[[86,0,0,0],[214,0,0,0]],">":[[42,0,0,0],[86,0,0,0],[214,0,0,0],[170,0,0,0]],z:[[44,0,0,0],[172,0,0,0]],Z:[[42,0,0,0],[44,0,0,0],[172,0,0,0],[170,0,0,0]],x:[[45,0,0,0],[173,0,0,0]],X:[[42,0,0,0],[45,0,0,0],[173,0,0,0],[170,0,0,0]],c:[[46,0,0,0],[174,0,0,0]],C:[[42,0,0,0],[46,0,0,0],[174,0,0,0],[170,0,0,0]],v:[[47,0,0,0],[175,0,0,0]],V:[[42,0,0,0],[47,0,0,0],[175,0,0,0],[170,0,0,0]],b:[[48,0,0,0],[176,0,0,0]],B:[[42,0,0,0],[48,0,0,0],[176,0,0,0],[170,0,0,0]],n:[[49,0,0,0],[177,0,0,0]],N:[[42,0,0,0],[49,0,0,0],[177,0,0,0],[170,0,0,0]],m:[[50,0,0,0],[178,0,0,0]],M:[[42,0,0,0],[50,0,0,0],[178,0,0,0],[170,0,0,0]],",":[[51,0,0,0],[179,0,0,0]],";":[[42,0,0,0],[51,0,0,0],[179,0,0,0],[170,0,0,0]],".":[[52,0,0,0],[180,0,0,0]],":":[[42,0,0,0],[52,0,0,0],[180,0,0,0],[170,0,0,0]],"-":[[53,0,0,0],[181,0,0,0]],_:[[42,0,0,0],[53,0,0,0],[181,0,0,0],[170,0,0,0]]," ":[[57,0,0,0],[185,0,0,0]]},t=[];t[27]=1,t[9]=15,t[16]=42,t[91]=29,t[17]=29,t[8]=14,t[12]=76,t[13]=28,t[18]=56,t[93]=93,t[38]=72,t[37]=75,t[40]=80,t[39]=77,t[45]=82,t[46]=83,t[36]=71,t[35]=79,t[33]=73,t[34]=81,t[144]=69,t[145]=70,t[112]=59,t[113]=60,t[114]=61,t[115]=62,t[116]=63,t[117]=64,t[118]=65,t[119]=66,t[120]=67,t[121]=68,t[122]=87,t[123]=88;var i=[];i[65]=30,i[81]=16,i[87]=17,i[69]=18,i[82]=19,i[84]=20,i[89]=21,i[85]=22,i[73]=23,i[79]=24,i[80]=25,i[65]=30,i[83]=31,i[68]=32,i[70]=33,i[71]=34,i[72]=35,i[74]=36,i[75]=37,i[76]=38,i[90]=44,i[88]=45,i[67]=46,i[66]=48,i[78]=49,i[77]=50;var n=[];return n[86]=47,{getKeymap:function(){return t},getCtrlKeymap:function(){return i},getReservedCtrlKeymap:function(){return n},getCharmap:function(){return e},setCtrlKey:function(e,t){i[e]=t}}}(),wdi.KeymapUS=function(){var e=[];e["`"]=[[41,0,0,0],[169,0,0,0]],e["~"]=[[42,0,0,0],[41,0,0,0],[169,0,0,0],[170,0,0,0]],e[1]=[[2,0,0,0],[130,0,0,0]],e["!"]=[[42,0,0,0],[2,0,0,0],[130,0,0,0],[170,0,0,0]],e[2]=[[3,0,0,0],[131,0,0,0]],e["@"]=[[42,0,0,0],[3,0,0,0],[131,0,0,0],[170,0,0,0]],e[3]=[[4,0,0,0],[132,0,0,0]],e["#"]=[[42,0,0,0],[4,0,0,0],[132,0,0,0],[170,0,0,0]],e[4]=[[5,0,0,0],[133,0,0,0]],e.$=[[42,0,0,0],[5,0,0,0],[133,0,0,0],[170,0,0,0]],e[5]=[[6,0,0,0],[134,0,0,0]],e["%"]=[[42,0,0,0],[6,0,0,0],[134,0,0,0],[170,0,0,0]],e[6]=[[7,0,0,0],[135,0,0,0]],e["^"]=[[42,0,0,0],[7,0,0,0],[135,0,0,0],[170,0,0,0]],e[7]=[[8,0,0,0],[136,0,0,0]],e["&"]=[[42,0,0,0],[8,0,0,0],[136,0,0,0],[170,0,0,0]],e[8]=[[9,0,0,0],[137,0,0,0]],e["*"]=[[42,0,0,0],[9,0,0,0],[137,0,0,0],[170,0,0,0]],e[9]=[[10,0,0,0],[138,0,0,0]],e["("]=[[42,0,0,0],[10,0,0,0],[138,0,0,0],[170,0,0,0]],e[0]=[[11,0,0,0],[139,0,0,0]],e[")"]=[[42,0,0,0],[11,0,0,0],[139,0,0,0],[170,0,0,0]],e["-"]=[[12,0,0,0],[140,0,0,0]],e._=[[42,0,0,0],[12,0,0,0],[140,0,0,0],[170,0,0,0]],e["="]=[[13,0,0,0],[141,0,0,0]],e["+"]=[[42,0,0,0],[13,0,0,0],[141,0,0,0],[170,0,0,0]],e.q=[[16,0,0,0],[144,0,0,0]],e.Q=[[42,0,0,0],[16,0,0,0],[144,0,0,0],[170,0,0,0]],e.w=[[17,0,0,0],[145,0,0,0]],e.W=[[42,0,0,0],[17,0,0,0],[145,0,0,0],[170,0,0,0]],e.e=[[18,0,0,0],[146,0,0,0]],e.E=[[42,0,0,0],[18,0,0,0],[146,0,0,0],[170,0,0,0]],e.r=[[19,0,0,0],[147,0,0,0]],e.R=[[42,0,0,0],[19,0,0,0],[147,0,0,0],[170,0,0,0]],e.t=[[20,0,0,0],[148,0,0,0]],e.T=[[42,0,0,0],[20,0,0,0],[148,0,0,0],[170,0,0,0]],e.y=[[21,0,0,0],[149,0,0,0]],e.Y=[[42,0,0,0],[21,0,0,0],[149,0,0,0],[170,0,0,0]],e.u=[[22,0,0,0],[150,0,0,0]],e.U=[[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]],e.i=[[23,0,0,0],[151,0,0,0]],e.I=[[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]],e.o=[[24,0,0,0],[152,0,0,0]],e.O=[[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]],e.p=[[25,0,0,0],[153,0,0,0]],e.P=[[42,0,0,0],[25,0,0,0],[153,0,0,0],[170,0,0,0]],e["["]=[[26,0,0,0],[154,0,0,0]],e["{"]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0]],e["]"]=[[27,0,0,0],[155,0,0,0]],e["}"]=[[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0]],e["\\"]=[[43,0,0,0],[171,0,0,0]],e["|"]=[[42,0,0,0],[43,0,0,0],[171,0,0,0],[170,0,0,0]],e.a=[[30,0,0,0],[158,0,0,0]],e.A=[[42,0,0,0],[30,0,0,0],[158,0,0,0],[170,0,0,0]],e.s=[[31,0,0,0],[159,0,0,0]],e.S=[[42,0,0,0],[31,0,0,0],[159,0,0,0],[170,0,0,0]],e.d=[[32,0,0,0],[160,0,0,0]],e.D=[[42,0,0,0],[32,0,0,0],[160,0,0,0],[170,0,0,0]],e.f=[[33,0,0,0],[161,0,0,0]],e.F=[[42,0,0,0],[33,0,0,0],[161,0,0,0],[170,0,0,0]],e.g=[[34,0,0,0],[162,0,0,0]],e.G=[[42,0,0,0],[34,0,0,0],[162,0,0,0],[170,0,0,0]],e.h=[[35,0,0,0],[163,0,0,0]],e.H=[[42,0,0,0],[35,0,0,0],[163,0,0,0],[170,0,0,0]],e.j=[[36,0,0,0],[164,0,0,0]],e.J=[[42,0,0,0],[36,0,0,0],[164,0,0,0],[170,0,0,0]],e.k=[[37,0,0,0],[165,0,0,0]],e.K=[[42,0,0,0],[37,0,0,0],[165,0,0,0],[170,0,0,0]],e.l=[[38,0,0,0],[166,0,0,0]],e.L=[[42,0,0,0],[38,0,0,0],[166,0,0,0],[170,0,0,0]],e[";"]=[[39,0,0,0],[167,0,0,0]],e[":"]=[[42,0,0,0],[39,0,0,0],[167,0,0,0],[170,0,0,0]],e["'"]=[[40,0,0,0],[168,0,0,0]],e['"']=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0]],e.z=[[44,0,0,0],[172,0,0,0]],e.Z=[[42,0,0,0],[44,0,0,0],[172,0,0,0],[170,0,0,0]],e.x=[[45,0,0,0],[173,0,0,0]],e.X=[[42,0,0,0],[45,0,0,0],[173,0,0,0],[170,0,0,0]],e.c=[[46,0,0,0],[174,0,0,0]],e.C=[[42,0,0,0],[46,0,0,0],[174,0,0,0],[170,0,0,0]],e.v=[[47,0,0,0],[175,0,0,0]],e.V=[[42,0,0,0],[47,0,0,0],[175,0,0,0],[170,0,0,0]],e.b=[[48,0,0,0],[176,0,0,0]],e.B=[[42,0,0,0],[48,0,0,0],[176,0,0,0],[170,0,0,0]],e.n=[[49,0,0,0],[177,0,0,0]],e.N=[[42,0,0,0],[49,0,0,0],[177,0,0,0],[170,0,0,0]],e.m=[[50,0,0,0],[178,0,0,0]],e.M=[[42,0,0,0],[50,0,0,0],[178,0,0,0],[170,0,0,0]],e[","]=[[51,0,0,0],[179,0,0,0]],e["<"]=[[42,0,0,0],[51,0,0,0],[179,0,0,0],[170,0,0,0]],e["."]=[[52,0,0,0],[180,0,0,0]],e[">"]=[[42,0,0,0],[52,0,0,0],[180,0,0,0],[170,0,0,0]],e["/"]=[[53,0,0,0],[181,0,0,0]],e["?"]=[[42,0,0,0],[53,0,0,0],[181,0,0,0],[170,0,0,0]],e[" "]=[[57,0,0,0],[185,0,0,0]];var t=[];t[27]=1,t[9]=15,t[16]=42,t[91]=29,t[17]=29,t[32]=57,t[8]=14,t[13]=28,t[38]=72,t[37]=75,t[40]=80,t[39]=77,t[45]=82,t[46]=83,t[36]=71,t[35]=79,t[33]=73,t[34]=81,t[144]=69,t[145]=70,t[112]=59,t[113]=60,t[114]=61,t[115]=62,t[116]=63,t[117]=64,t[118]=65,t[119]=66,t[120]=67,t[121]=68,t[122]=87,t[123]=88;var i=[];i[65]=30,i[81]=16,i[87]=17,i[69]=18,i[82]=19,i[84]=20,i[89]=21,i[85]=22,i[73]=23,i[79]=24,i[80]=25,i[65]=30,i[83]=31,i[68]=32,i[70]=33,i[71]=34,i[72]=35,i[74]=36,i[75]=37,i[76]=38,i[90]=44,i[88]=45,i[67]=46,i[66]=48,i[78]=49,i[77]=50;var n=[];return n[86]=47,{getKeymap:function(){return t},getCtrlKeymap:function(){return i},getReservedCtrlKeymap:function(){return n},getCharmap:function(){return e},setCtrlKey:function(e,t){i[e]=t}}}(),wdi.KeymapFR=function(){var e={"²":[[41,0,0,0],[169,0,0,0]],"&":[[2,0,0,0],[130,0,0,0]],1:[[42,0,0,0],[2,0,0,0],[130,0,0,0],[170,0,0,0]],"é":[[3,0,0,0],[131,0,0,0]],2:[[42,0,0,0],[3,0,0,0],[131,0,0,0],[170,0,0,0]],"~":[[224,56,0,0],[3,0,0,0],[131,0,0,0],[224,184,0,0]],'"':[[4,0,0,0],[132,0,0,0]],3:[[42,0,0,0],[4,0,0,0],[132,0,0,0],[170,0,0,0]],"#":[[224,56,0,0],[4,0,0,0],[132,0,0,0],[224,184,0,0]],"'":[[5,0,0,0],[133,0,0,0]],4:[[42,0,0,0],[5,0,0,0],[133,0,0,0],[170,0,0,0]],"{":[[224,56,0,0],[5,0,0,0],[133,0,0,0],[224,184,0,0]],"(":[[6,0,0,0],[134,0,0,0]],5:[[42,0,0,0],[6,0,0,0],[134,0,0,0],[170,0,0,0]],"[":[[224,56,0,0],[6,0,0,0],[134,0,0,0],[224,184,0,0]],"-":[[7,0,0,0],[135,0,0,0]],6:[[42,0,0,0],[7,0,0,0],[135,0,0,0],[170,0,0,0]],"|":[[224,56,0,0],[7,0,0,0],[135,0,0,0],[224,184,0,0]],"è":[[8,0,0,0],[136,0,0,0]],7:[[42,0,0,0],[8,0,0,0],[136,0,0,0],[170,0,0,0]],"`":[[224,56,0,0],[8,0,0,0],[136,0,0,0],[224,184,0,0]],_:[[9,0,0,0],[137,0,0,0]],8:[[42,0,0,0],[9,0,0,0],[137,0,0,0],[170,0,0,0]],"\\":[[224,56,0,0],[9,0,0,0],[137,0,0,0],[224,184,0,0]],"ç":[[10,0,0,0],[138,0,0,0]],9:[[42,0,0,0],[10,0,0,0],[138,0,0,0],[170,0,0,0]],"^":[[224,56,0,0],[10,0,0,0],[138,0,0,0],[224,184,0,0]],"à":[[11,0,0,0],[139,0,0,0]],0:[[42,0,0,0],[11,0,0,0],[139,0,0,0],[170,0,0,0]],"@":[[224,56,0,0],[11,0,0,0],[139,0,0,0],[224,184,0,0]],")":[[12,0,0,0],[140,0,0,0]],"°":[[42,0,0,0],[12,0,0,0],[140,0,0,0],[170,0,0,0]],"]":[[224,56,0,0],[12,0,0,0],[140,0,0,0],[224,184,0,0]],"=":[[13,0,0,0],[141,0,0,0]],"+":[[42,0,0,0],[13,0,0,0],[141,0,0,0],[170,0,0,0]],"}":[[224,56,0,0],[13,0,0,0],[141,0,0,0],[224,184,0,0]],a:[[16,0,0,0],[144,0,0,0]],A:[[42,0,0,0],[16,0,0,0],[144,0,0,0],[170,0,0,0]],z:[[17,0,0,0],[145,0,0,0]],Z:[[42,0,0,0],[17,0,0,0],[145,0,0,0],[170,0,0,0]],e:[[18,0,0,0],[146,0,0,0]],E:[[42,0,0,0],[18,0,0,0],[146,0,0,0],[170,0,0,0]],"€":[[224,56,0,0],[18,0,0,0],[146,0,0,0],[224,184,0,0]],r:[[19,0,0,0],[147,0,0,0]],R:[[42,0,0,0],[19,0,0,0],[147,0,0,0],[170,0,0,0]],t:[[20,0,0,0],[148,0,0,0]],T:[[42,0,0,0],[20,0,0,0],[148,0,0,0],[170,0,0,0]],y:[[21,0,0,0],[149,0,0,0]],Y:[[42,0,0,0],[21,0,0,0],[149,0,0,0],[170,0,0,0]],u:[[22,0,0,0],[150,0,0,0]],U:[[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]],i:[[23,0,0,0],[151,0,0,0]],I:[[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]],o:[[24,0,0,0],[152,0,0,0]],O:[[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]],p:[[25,0,0,0],[153,0,0,0]],P:[[42,0,0,0],[25,0,0,0],[153,0,0,0],[170,0,0,0]],"^":[[26,0,0,0],[154,0,0,0],[57,0,0,0],[185,0,0,0]],"â":[[26,0,0,0],[154,0,0,0],[16,0,0,0],[144,0,0,0]],"ä":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[16,0,0,0],[144,0,0,0]],"Â":[[26,0,0,0],[154,0,0,0],[42,0,0,0],[16,0,0,0],[144,0,0,0]],"Ä":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[16,0,0,0],[144,0,0,0]],"ê":[[26,0,0,0],[154,0,0,0],[18,0,0,0],[146,0,0,0]],"ë":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[18,0,0,0],[146,0,0,0]],"Ê":[[26,0,0,0],[154,0,0,0],[42,0,0,0],[18,0,0,0],[146,0,0,0]],"Ë":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[18,0,0,0],[146,0,0,0]],"î":[[26,0,0,0],[154,0,0,0],[23,0,0,0],[151,0,0,0]],"ï":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[23,0,0,0],[151,0,0,0]],"Î":[[26,0,0,0],[154,0,0,0],[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]],"Ï":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]],"ô":[[26,0,0,0],[154,0,0,0],[24,0,0,0],[152,0,0,0]],"ö":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[24,0,0,0],[152,0,0,0]],"Ô":[[26,0,0,0],[154,0,0,0],[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]],"Ö":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]],"û":[[26,0,0,0],[154,0,0,0],[22,0,0,0],[150,0,0,0]],"ü":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[22,0,0,0],[150,0,0,0]],"Û":[[26,0,0,0],[154,0,0,0],[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]],"Ü":[[42,0,0,0],[26,0,0,0],[154,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]],$:[[27,0,0,0],[155,0,0,0]],"£":[[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0]],"¤":[[224,56,0,0],[27,0,0,0],[155,0,0,0],[224,184,0,0]],q:[[30,0,0,0],[158,0,0,0]],Q:[[42,0,0,0],[30,0,0,0],[158,0,0,0],[170,0,0,0]],s:[[31,0,0,0],[159,0,0,0]],S:[[42,0,0,0],[31,0,0,0],[159,0,0,0],[170,0,0,0]],d:[[32,0,0,0],[160,0,0,0]],D:[[42,0,0,0],[32,0,0,0],[160,0,0,0],[170,0,0,0]],f:[[33,0,0,0],[161,0,0,0]],F:[[42,0,0,0],[33,0,0,0],[161,0,0,0],[170,0,0,0]],g:[[34,0,0,0],[162,0,0,0]],G:[[42,0,0,0],[34,0,0,0],[162,0,0,0],[170,0,0,0]],h:[[35,0,0,0],[163,0,0,0]],H:[[42,0,0,0],[35,0,0,0],[163,0,0,0],[170,0,0,0]],j:[[36,0,0,0],[164,0,0,0]],J:[[42,0,0,0],[36,0,0,0],[164,0,0,0],[170,0,0,0]],k:[[37,0,0,0],[165,0,0,0]],K:[[42,0,0,0],[37,0,0,0],[165,0,0,0],[170,0,0,0]],l:[[38,0,0,0],[166,0,0,0]],L:[[42,0,0,0],[38,0,0,0],[166,0,0,0],[170,0,0,0]],m:[[39,0,0,0],[167,0,0,0]],M:[[42,0,0,0],[39,0,0,0],[167,0,0,0],[170,0,0,0]],"ù":[[40,0,0,0],[168,0,0,0]],"%":[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0]],"*":[[43,0,0,0],[171,0,0,0]],"µ":[[42,0,0,0],[43,0,0,0],[171,0,0,0],[170,0,0,0]],"<":[[86,0,0,0],[214,0,0,0]],">":[[42,0,0,0],[86,0,0,0],[214,0,0,0],[170,0,0,0]],w:[[44,0,0,0],[172,0,0,0]],W:[[42,0,0,0],[44,0,0,0],[172,0,0,0],[170,0,0,0]],x:[[45,0,0,0],[173,0,0,0]],X:[[42,0,0,0],[45,0,0,0],[173,0,0,0],[170,0,0,0]],c:[[46,0,0,0],[174,0,0,0]],C:[[42,0,0,0],[46,0,0,0],[174,0,0,0],[170,0,0,0]],v:[[47,0,0,0],[175,0,0,0]],V:[[42,0,0,0],[47,0,0,0],[175,0,0,0],[170,0,0,0]],b:[[48,0,0,0],[176,0,0,0]],B:[[42,0,0,0],[48,0,0,0],[176,0,0,0],[170,0,0,0]],n:[[49,0,0,0],[177,0,0,0]],N:[[42,0,0,0],[49,0,0,0],[177,0,0,0],[170,0,0,0]],",":[[50,0,0,0],[178,0,0,0]],"?":[[42,0,0,0],[50,0,0,0],[178,0,0,0],[170,0,0,0]],";":[[51,0,0,0],[179,0,0,0]],".":[[42,0,0,0],[51,0,0,0],[179,0,0,0],[170,0,0,0]],":":[[52,0,0,0],[180,0,0,0]],"/":[[42,0,0,0],[52,0,0,0],[180,0,0,0],[170,0,0,0]],"!":[[53,0,0,0],[181,0,0,0]],"§":[[42,0,0,0],[53,0,0,0],[181,0,0,0],[170,0,0,0]]," ":[[57,0,0,0],[185,0,0,0]]},t=[];t[27]=1,t[9]=15,t[16]=42,t[91]=347,t[17]=29,t[8]=14,t[13]=28,t[18]=56,t[38]=72,t[37]=75,t[40]=80,t[39]=77,t[45]=82,t[46]=83,t[36]=71,t[35]=79,t[33]=73,t[34]=81,t[144]=69,t[145]=70,t[112]=59,t[113]=60,t[114]=61,t[115]=62,t[116]=63,t[117]=64,t[118]=65,t[119]=66,t[120]=67,t[121]=68,t[122]=87,t[123]=88;var i=[];i[81]=16,i[87]=17,i[69]=18,i[82]=19,i[84]=20,i[89]=21,i[85]=22,i[73]=23,i[79]=24,i[80]=25,i[65]=30,i[83]=31,i[68]=32,i[70]=33,i[71]=34,i[72]=35,i[74]=36,i[75]=37,i[76]=38,i[77]=39,i[90]=44,i[88]=45,i[67]=46,i[66]=48,i[78]=49;var n=[];return n[86]=47,{getKeymap:function(){return t},getCtrlKeymap:function(){return i},getReservedCtrlKeymap:function(){return n},getCharmap:function(){return e},setCtrlKey:function(e,t){i[e]=t}}}(),wdi.KeymapRU=function(){var e=[];e["ё"]=[[41,0,0,0],[169,0,0,0]],e["Ё"]=[[42,0,0,0],[41,0,0,0],[169,0,0,0],[170,0,0,0]],e[1]=[[2,0,0,0],[130,0,0,0]],e["!"]=[[42,0,0,0],[2,0,0,0],[130,0,0,0],[170,0,0,0]],e[2]=[[3,0,0,0],[131,0,0,0]],e['"']=[[42,0,0,0],[3,0,0,0],[131,0,0,0],[170,0,0,0]],e[3]=[[4,0,0,0],[132,0,0,0]],e["№"]=[[42,0,0,0],[4,0,0,0],[132,0,0,0],[170,0,0,0]],e[4]=[[5,0,0,0],[133,0,0,0]],e[";"]=[[42,0,0,0],[5,0,0,0],[133,0,0,0],[170,0,0,0]],e[5]=[[6,0,0,0],[134,0,0,0]],e["%"]=[[42,0,0,0],[6,0,0,0],[134,0,0,0],[170,0,0,0]],e[6]=[[7,0,0,0],[135,0,0,0]],e[":"]=[[42,0,0,0],[7,0,0,0],[135,0,0,0],[170,0,0,0]],e[7]=[[8,0,0,0],[136,0,0,0]],e["?"]=[[42,0,0,0],[8,0,0,0],[136,0,0,0],[170,0,0,0]],e[8]=[[9,0,0,0],[137,0,0,0]],e["*"]=[[42,0,0,0],[9,0,0,0],[137,0,0,0],[170,0,0,0]],e[9]=[[10,0,0,0],[138,0,0,0]],e["("]=[[42,0,0,0],[10,0,0,0],[138,0,0,0],[170,0,0,0]],e[0]=[[11,0,0,0],[139,0,0,0]],e[")"]=[[42,0,0,0],[11,0,0,0],[139,0,0,0],[170,0,0,0]],e["-"]=[[12,0,0,0],[140,0,0,0]],e._=[[42,0,0,0],[12,0,0,0],[140,0,0,0],[170,0,0,0]],e["="]=[[13,0,0,0],[141,0,0,0]],e["+"]=[[42,0,0,0],[13,0,0,0],[141,0,0,0],[170,0,0,0]],e["й"]=[[16,0,0,0],[144,0,0,0]],e["Й"]=[[42,0,0,0],[16,0,0,0],[144,0,0,0],[170,0,0,0]],e["ц"]=[[17,0,0,0],[145,0,0,0]],e["Ц"]=[[42,0,0,0],[17,0,0,0],[145,0,0,0],[170,0,0,0]],e["у"]=[[18,0,0,0],[146,0,0,0]],e["У"]=[[42,0,0,0],[18,0,0,0],[146,0,0,0],[170,0,0,0]],e["к"]=[[19,0,0,0],[147,0,0,0]],e["К"]=[[42,0,0,0],[19,0,0,0],[147,0,0,0],[170,0,0,0]],e["е"]=[[20,0,0,0],[148,0,0,0]],e["Е"]=[[42,0,0,0],[20,0,0,0],[148,0,0,0],[170,0,0,0]],e["н"]=[[21,0,0,0],[149,0,0,0]],e["Н"]=[[42,0,0,0],[21,0,0,0],[149,0,0,0],[170,0,0,0]],e["г"]=[[22,0,0,0],[150,0,0,0]],e["Г"]=[[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]],e["ш"]=[[23,0,0,0],[151,0,0,0]],e["Ш"]=[[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]],e["щ"]=[[24,0,0,0],[152,0,0,0]],e["Щ"]=[[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]],e["з"]=[[25,0,0,0],[153,0,0,0]],e["З"]=[[42,0,0,0],[25,0,0,0],[153,0,0,0],[170,0,0,0]],e["х"]=[[26,0,0,0],[154,0,0,0]],e["Х"]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0]],e["ъ"]=[[27,0,0,0],[155,0,0,0]],e["Ъ"]=[[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0]],e["\\"]=[[43,0,0,0],[171,0,0,0]],e["/"]=[[42,0,0,0],[43,0,0,0],[171,0,0,0],[170,0,0,0]],e["ф"]=[[30,0,0,0],[158,0,0,0]],e["Ф"]=[[42,0,0,0],[30,0,0,0],[158,0,0,0],[170,0,0,0]],e["ы"]=[[31,0,0,0],[159,0,0,0]],e["Ы"]=[[42,0,0,0],[31,0,0,0],[159,0,0,0],[170,0,0,0]],e["в"]=[[32,0,0,0],[160,0,0,0]],e["В"]=[[42,0,0,0],[32,0,0,0],[160,0,0,0],[170,0,0,0]],e["а"]=[[33,0,0,0],[161,0,0,0]],e["А"]=[[42,0,0,0],[33,0,0,0],[161,0,0,0],[170,0,0,0]],e["п"]=[[34,0,0,0],[162,0,0,0]],e["П"]=[[42,0,0,0],[34,0,0,0],[162,0,0,0],[170,0,0,0]],e["р"]=[[35,0,0,0],[163,0,0,0]],e["Р"]=[[42,0,0,0],[35,0,0,0],[163,0,0,0],[170,0,0,0]],e["о"]=[[36,0,0,0],[164,0,0,0]],e["О"]=[[42,0,0,0],[36,0,0,0],[164,0,0,0],[170,0,0,0]],e["л"]=[[37,0,0,0],[165,0,0,0]],e["Л"]=[[42,0,0,0],[37,0,0,0],[165,0,0,0],[170,0,0,0]],e["д"]=[[38,0,0,0],[166,0,0,0]],e["Д"]=[[42,0,0,0],[38,0,0,0],[166,0,0,0],[170,0,0,0]],e["ж"]=[[39,0,0,0],[167,0,0,0]],e["Ж"]=[[42,0,0,0],[39,0,0,0],[167,0,0,0],[170,0,0,0]],e["э"]=[[40,0,0,0],[168,0,0,0]],e["Э"]=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0]],e["я"]=[[44,0,0,0],[172,0,0,0]],e["Я"]=[[42,0,0,0],[44,0,0,0],[172,0,0,0],[170,0,0,0]],e["ч"]=[[45,0,0,0],[173,0,0,0]],e["Ч"]=[[42,0,0,0],[45,0,0,0],[173,0,0,0],[170,0,0,0]],e["с"]=[[46,0,0,0],[174,0,0,0]],e["С"]=[[42,0,0,0],[46,0,0,0],[174,0,0,0],[170,0,0,0]],e["м"]=[[47,0,0,0],[175,0,0,0]],e["М"]=[[42,0,0,0],[47,0,0,0],[175,0,0,0],[170,0,0,0]],e["и"]=[[48,0,0,0],[176,0,0,0]],e["И"]=[[42,0,0,0],[48,0,0,0],[176,0,0,0],[170,0,0,0]],e["т"]=[[49,0,0,0],[177,0,0,0]],e["Т"]=[[42,0,0,0],[49,0,0,0],[177,0,0,0],[170,0,0,0]],e["ь"]=[[50,0,0,0],[178,0,0,0]],e["Ь"]=[[42,0,0,0],[50,0,0,0],[178,0,0,0],[170,0,0,0]],e["б"]=[[51,0,0,0],[179,0,0,0]],e["Б"]=[[42,0,0,0],[51,0,0,0],[179,0,0,0],[170,0,0,0]],e["ю"]=[[52,0,0,0],[180,0,0,0]],e["Ю"]=[[42,0,0,0],[52,0,0,0],[180,0,0,0],[170,0,0,0]],e["."]=[[53,0,0,0],[181,0,0,0]],e[","]=[[42,0,0,0],[53,0,0,0],[181,0,0,0],[170,0,0,0]],e[" "]=[[57,0,0,0],[185,0,0,0]];var t=[];t[27]=1,t[9]=15,t[16]=42,t[91]=29,t[17]=29,t[32]=57,t[8]=14,t[13]=28,t[38]=72,t[37]=75,t[40]=80,t[39]=77,t[45]=82,t[46]=83,t[36]=71,t[35]=79,t[33]=73,t[34]=81,t[144]=69,t[145]=70,t[112]=59,t[113]=60,t[114]=61,t[115]=62,t[116]=63,t[117]=64,t[118]=65,t[119]=66,t[120]=67,t[121]=68,t[122]=87,t[123]=88;var i=[],n=[];return n[86]=47,{getKeymap:function(){return t},getCtrlKeymap:function(){return i},getReservedCtrlKeymap:function(){return n},getCharmap:function(){return e},setCtrlKey:function(e,t){i[e]=t}}}(),wdi.keyShortcutsHandled={CTRLV:0},wdi.Keymap={defaultCodes:{Backquote:[41,0,0,0],Backslash:[43,0,0,0],Backspace:[14,0,0,0],BracketLeft:[26,0,0,0],BracketRight:[27,0,0,0],Comma:[51,0,0,0],Digit0:[11,0,0,0],Digit1:[2,0,0,0],Digit2:[3,0,0,0],Digit3:[4,0,0,0],Digit4:[5,0,0,0],Digit5:[6,0,0,0],Digit6:[7,0,0,0],Digit7:[8,0,0,0],Digit8:[9,0,0,0],Digit9:[10,0,0,0],Equal:[13,0,0,0],IntlBackslash:[86,0,0,0],KeyA:[30,0,0,0],KeyB:[48,0,0,0],KeyC:[46,0,0,0],KeyD:[32,0,0,0],KeyE:[18,0,0,0],KeyF:[33,0,0,0],KeyG:[34,0,0,0],KeyH:[35,0,0,0],KeyI:[23,0,0,0],KeyJ:[36,0,0,0],KeyK:[37,0,0,0],KeyL:[38,0,0,0],KeyM:[50,0,0,0],KeyN:[49,0,0,0],KeyO:[24,0,0,0],KeyP:[25,0,0,0],KeyQ:[16,0,0,0],KeyR:[19,0,0,0],KeyS:[31,0,0,0],KeyT:[20,0,0,0],KeyU:[22,0,0,0],KeyV:[47,0,0,0],KeyW:[17,0,0,0],KeyX:[45,0,0,0],KeyY:[21,0,0,0],KeyZ:[44,0,0,0],Minus:[12,0,0,0],Period:[52,0,0,0],Quote:[40,0,0,0],Semicolon:[39,0,0,0],Slash:[53,0,0,0],AltLeft:[56,0,0,0],AltRight:[224,56,0,0],CapsLock:[58,0,0,0],ContextMenu:[224,93,0,0],ControlLeft:[29,0,0,0],ControlRight:[224,29,0,0],Enter:[28,0,0,0],MetaLeft:[224,91,0,0],MetaRight:[224,92,0,0],OSLeft:[224,91,0,0],OSRight:[224,92,0,0],ShiftLeft:[42,0,0,0],ShiftRight:[54,0,0,0],Space:[57,0,0,0],Tab:[15,0,0,0],Delete:[224,83,0,0],End:[224,79,0,0],Home:[224,71,0,0],Insert:[224,82,0,0],PageDown:[224,81,0,0],PageUp:[224,73,0,0],ArrowDown:[224,80,0,0],ArrowLeft:[224,75,0,0],ArrowRight:[224,77,0,0],ArrowUp:[224,72,0,0],NumLock:[69,0,0,0],Numpad0:[82,0,0,0],Numpad1:[79,0,0,0],Numpad2:[80,0,0,0],Numpad3:[81,0,0,0],Numpad4:[75,0,0,0],Numpad5:[76,0,0,0],Numpad6:[77,0,0,0],Numpad7:[71,0,0,0],Numpad8:[72,0,0,0],Numpad9:[73,0,0,0],NumpadAdd:[78,0,0,0],NumpadDecimal:[83,0,0,0],NumpadDivide:[224,53,0,0],NumpadEnter:[224,28,0,0],NumpadMultiply:[55,0,0,0],NumpadSubtract:[74,0,0,0],Escape:[1,0,0,0],F1:[59,0,0,0],F2:[60,0,0,0],F3:[61,0,0,0],F4:[62,0,0,0],F5:[63,0,0,0],F6:[64,0,0,0],F7:[65,0,0,0],F8:[66,0,0,0],F9:[67,0,0,0],F10:[68,0,0,0],F11:[87,0,0,0],F12:[88,0,0,0],PrintScreen:[224,42,224,55],ScrollLock:[70,0,0,0]},keymap:{},ctrlKeymap:{},charmap:{},pressedKeyMap:[],ctrlPressed:!1,twoBytesScanCodes:[91,219,92,220,29,157,93,221,82,210,83,211,75,203,71,201,79,207,72,200,80,208,73,201,81,209,77,205,28,156],loadKeyMap:function(e){try{layout={es:"ES",en:"US",fr:"FR",ru:"RU"}[e],this.keymap=wdi["Keymap"+layout].getKeymap(),this.ctrlKeymap=wdi["Keymap"+layout].getCtrlKeymap(),this.reservedCtrlKeymap=wdi["Keymap"+layout].getReservedCtrlKeymap(),this.charmap=wdi["Keymap"+layout].getCharmap()}catch(e){this.keymap=wdi.KeymapES.getKeymap(),this.ctrlKeymap=wdi.KeymapES.getCtrlKeymap(),this.reservedCtrlKeymap=wdi.KeymapES.getReservedCtrlKeymap(),this.charmap=wdi.KeymapES.getCharmap()}},isInKeymap:function(e){return void 0!==this.keymap[e]},getScanCodes:function(e,t,i){return"originalEvent"in e&&"code"in e.originalEvent&&(code=e.originalEvent.code,""!=code&&"Unidentified"!=code)?(result=[],scanCodes=this.defaultCodes[code].slice(),"keydown"!=i&&"keypress"!=i&&(224==scanCodes[0]?scanCodes[1]=128|scanCodes[1]:scanCodes[0]=128|scanCodes[0]),result.push(scanCodes.slice()),result):e.hasScanCode?e.scanCode:!t&&this.handledByCtrlKeyCode(i,e.keyCode,e.generated)?(scanCodes=this.getScanCodeFromKeyCode(e.keyCode,i,this.ctrlKeymap,this.reservedCtrlKeymap),this.pressedKeyMap[e.keyCode]=scanCodes,0<scanCodes.length?"keydown"==i||"keypress"==i?[[224,29,0],scanCodes[0]]:[[224,157,0],scanCodes[0]]:scanCodes):!t&&this.handledByPreviousCtrlKeyCode(i,e.keyCode,e.generated)?(scanCodes=this.pressedKeyMap[e.keyCode],scanCodes[0][0]=128|scanCodes[0][0],delete this.pressedKeyMap[e.keyCode],scanCodes):this.handledByCharmap(e.type)?this.getScanCodesFromCharCode(e.charCode):this.handledByNormalKeyCode(i,e.keyCode,e.generated)?(additionalKeymap={76:38},this.getScanCodeFromKeyCode(e.keyCode,i,this.keymap,additionalKeymap)):[]},getScanCodeFromKeyCode:function(e,t,i,n){this.controlPressed(e,t);var s=null;if(void 0===(s=e in i?i[e]:n[e]))return[];if(s<256)return"keydown"==t?[this.makeKeymap(s)]:"keyup"==t?[this.makeKeymap(128|s)]:s;var o=0;return"keydown"==t?o=224|s-256<<8:"keyup"==t&&(o=32992|s-256<<8),[[255&o,(65280&o)>>8,0,0]]},controlPressed:function(e,t){17===e&&("keydown"===t?this.ctrlPressed=!0:"keyup"===t&&(this.ctrlPressed=!1))},handledByCtrlKeyCode:function(e,t,i){if(("keydown"===e||"keyup"===e||"keypress"===e)&&this.ctrlPressed){if("keypress"===e)return!0;if(this.ctrlKeymap[t])return!0;if(i&&this.reservedCtrlKeymap[t])return!0}return!1},handledByPreviousCtrlKeyCode:function(e,t,i){return"keyup"===e&&!this.ctrlPressed&&null!=this.pressedKeyMap[t]},handledByNormalKeyCode:function(e,t,i){if("keydown"===e||"keyup"===e){if(this.keymap[t])return!0;if(i&&76==t)return!0}return!1},handledByCharmap:function(e){return"inputmanager"===e},getScanCodesFromCharCode:function(e){var t=this.charmap[String.fromCharCode(e)];return void 0===t&&(t=[]),t},makeKeymap:function(e){return-1!=$.inArray(e,this.twoBytesScanCodes)?[224,e,0,0]:[e,0,0]}},window=this,window.wdi||(window.wdi={}),window.wdi.WorkerOperations={quic:0,lz_rgb:1,bytesToUriJpeg:2,bytesToUriPng:3},window.workerDispatch=dispatch,self.addEventListener("message",function(e){return dispatch(e.data,!0)},!1),wdi.QuicImageType={QUIC_IMAGE_TYPE_INVALID:0,QUIC_IMAGE_TYPE_GRAY:1,QUIC_IMAGE_TYPE_RGB16:2,QUIC_IMAGE_TYPE_RGB24:3,QUIC_IMAGE_TYPE_RGB32:4,QUIC_IMAGE_TYPE_RGBA:5},wdi.quic={},wdi.JSQuic={QUIC_MAGIC:1364543811,MAXNUMCODES:8,DEFevol:3,MINevol:0,MAXevol:5,DEFwmistart:0,MINwmistart:0,DEFmaxclen:26,DEFwmimax:6,DEFwminext:2048,MINwminext:1,MAXwminext:1e8,MAX_CHANNELS:4,wmimax:6,wminext:2048,evol:3,family_8bpc:new wdi_quic_QuicFamily,family_5bpc:new wdi_quic_QuicFamily,bppmask:new Int32Array([0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647,4294967295]),bitat:new Int32Array([1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648]),TABRAND_TABSIZE:256,TABRAND_SEEDMASK:255,tabrand_chaos:new Int32Array([46495042,893548311,794435923,2453991765,2077388039,894197842,1462934312,697534094,1826128012,343623392,2581292719,3811265708,459739748,2638427270,1654964626,101227083,2654850628,3668700691,572794346,2758751005,3445133904,2344099199,3367450297,898927923,3618406352,1606297603,754696453,20823118,2050458127,972590750,3990194068,3305596553,4239238564,1690498157,3015324227,2306127097,1510321853,548392192,971157512,2292288069,1611390505,4086766286,4084927083,1883326811,1891043243,113180603,1107690783,3778825955,3248980775,2443839100,2190866218,1932072870,495393613,1078522166,4051963518,1784694977,1768732442,2146763203,264646923,1474361405,2361552500,296035746,2489922759,2094565616,2409465348,1334241083,72483606,3740181004,4057920662,1734898312,4114662834,574624900,880305546,3258472262,26713132,1571648456,52557195,4043234286,2458021343,676064371,1528437109,64953873,546717185,2709319979,1947039598,2812723004,28691684,286829174,4235176970,3465707163,12526951,2154766700,3165032534,2036061161,3386656087,2301212354,2023576300,1061142336,3105452904,2743866805,3283373992,3397596080,3085489552,3196092395,3210707808,3651022684,925444321,2088074316,230011220,3223248386,533229176,523863486,3028311159,13140218,2538347282,900399636,3000796173,1526771255,3541282854,2992674461,2135722105,389334227,1225164337,3119947809,1803959919,3471171263,704170491,1407019136,1924534819,526887421,168782227,333811993,298623278,4268451686,381087740,2542899140,3266880867,2498950977,200969370,3511909096,3252303004,2268881098,2499828613,2606499854,3163208665,3790254546,1840025712,1319758833,3771674836,519421307,3512796222,1563402978,4284300462,2263719815,715250337,3178437172,2660191010,2982332026,3256309961,2709659997,3434092872,2367065591,69438718,915160508,183164069,3134331940,175242981,2680543346,1421955782,4231173251,1736652874,3990568476,1710820912,2286604440,3464587098,1261907837,1757387321,1128554270,1090050251,2429922486,1288729218,882830086,211637042,1376462063,2147615815,1737974929,798170275,4271572277,4241687072,1638524620,2760366295,1065115089,2097227717,1224023317,1625204849,3383303351,1488272307,2640186157,1649047732,819719707,2615091943,502645401,760628135,4108137983,63606742,1404337880,1865161130,4272996852,1239761976,790984678,3213322601,1917062825,4195069880,1962259360,2111002573,2311983960,1861406170,511141875,2797510619,1331661048,3130608186,147483493,3767089176,2650841450,4096523407,2574446300,1956416337,851468126,3607527519,1811658703,3642821136,832691095,2453312857,933732854,94341217,3393797730,1695907457,2405722077,2877685663,2469507058,2249636341,3988608661,4001245617,825934927,3103985967,1127151177,3691656896,1640967098,2168932645,2830550957,3998822878,3002602893,1509651465,775813869,2599574079,3791574229]),besttrigtab:[[550,900,800,700,500,350,300,200,180,180,160],[110,550,900,800,550,400,350,250,140,160,140],[100,120,550,900,700,500,400,300,220,250,160]],lzeroes:new Int32Array([8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),J:new Int32Array([0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,5,5,6,6,7,7,8,9,10,11,12,13,14,15]),zeroLUT:null,BPC_MASK:{4:255,5:255,24:255,16:31},stabrand:function(){return this.TABRAND_SEEDMASK},tabrand:function(e){return e.tabrand_seed++,this.tabrand_chaos[e.tabrand_seed&this.TABRAND_SEEDMASK]},set_wm_trigger:function(e){var t=e.wmidx;10<t&&(t=10),e.wm_trigger=wdi.JSQuic.besttrigtab[Math.floor(wdi.JSQuic.evol>>1)][t]},ceil_log_2:function(e){var t;if(1===e)return 0;for(e-=t=1;e>>>=1;)t++;return t},decorelate_init:function(e,t){var i,n=this.bppmask[t],s=n>>>1;for(i=0;i<=n;i++)e.xlatU2L[i]=i<=s?i<<1>>>0:1+(n-i<<1>>>0)},corelate_init:function(e,t){var i,n=this.bppmask[t];for(i=0;i<=n;i++)e.xlatL2U[i]=1&i?n-(i>>>1):i>>>1},family_init:function(e,t,i){var n;for(n=0;n<t;n++){var s,o;(s=i-t)>parseInt(this.bppmask[t-n])&&(s=this.bppmask[t-n]),o=this.bppmask[t]+1-(s<<n>>>0),e.nGRcodewords[n]=s<<n>>>0,e.notGRcwlen[n]=s+this.ceil_log_2(o),e.notGRprefixmask[n]=this.bppmask[32-s],e.notGRsuffixlen[n]=this.ceil_log_2(o)}this.corelate_init(e,t)},init_zeroLUT:function(){var e,t,i,n;for(this.zeroLUT=new Int32Array(256),t=i=1,n=8,e=0;e<256;++e)this.zeroLUT[e]=n,0===--i&&(i=t,--n,t*=2)},quic_init:function(){this.family_init(this.family_8bpc,8,this.DEFmaxclen),this.init_zeroLUT(),wdi.xlatL2U=new Int32Array(this.family_8bpc.xlatL2U.length),wdi.xlatL2U.set(this.family_8bpc.xlatL2U),wdi.notGRprefixmask=new Int32Array(this.family_8bpc.notGRprefixmask.length),wdi.notGRprefixmask.set(this.family_8bpc.notGRprefixmask),wdi.nGRcodewords=new Int32Array(this.family_8bpc.nGRcodewords.length),wdi.nGRcodewords.set(this.family_8bpc.nGRcodewords),wdi.notGRcwlen=new Int32Array(this.family_8bpc.notGRcwlen.length),wdi.notGRcwlen.set(this.family_8bpc.notGRcwlen),wdi.notGRsuffixlen=new Int32Array(this.family_8bpc.notGRsuffixlen.length),wdi.notGRsuffixlen.set(this.family_8bpc.notGRsuffixlen);for(var e=wdi.JSQuic.lzeroes,t=new Int32Array(e),i=e.length,n=0;n<i;n++)t[n]=e[n]+8;wdi.JSQuic.lzeroes8=t;var s=new Int32Array(e);for(n=0;n<i;n++)s[n]=e[n]+16;wdi.JSQuic.lzeroes16=s;var o=new Int32Array(e);for(n=0;n<i;n++)o[n]=e[n]+24;wdi.JSQuic.lzeroes24=o},quic_image_params:function(e,t){var i,n;switch(t){case wdi.QuicImageType.QUIC_IMAGE_TYPE_GRAY:i=1,n=8;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB16:i=3,n=5;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB24:case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB32:i=3,n=8;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGBA:i=4,n=8;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_INVALID:default:n=i=0}return[i,n]},find_model_params:function(e,t){var i=0,n=0,s=0,o=0,a={ncounters:8};switch(a.levels=1<<t,a.n_buckets_ptrs=0,this.evol){case 1:a.repfirst=3,a.firstsize=1,a.repnext=2,a.mulsize=2;break;case 3:a.repfirst=1,a.firstsize=1,a.repnext=1,a.mulsize=2;break;case 5:a.repfirst=1,a.firstsize=1,a.repnext=1,a.mulsize=4;break;case 0:case 2:case 4:default:return wdi.Debug.error("fund model params: invalid evol"),!1}for(a.nbuckets=0,o=a.repfirst+1,i=a.firstsize;n=a.nbuckets?s+1:0,--o||(o=a.repnext,i*=a.mulsize),(s=n+i-1)+i>=a.levels&&(s=a.levels-1),a.n_buckets_ptrs||(a.n_buckets_ptrs=a.levels),a.nbuckets++,s<a.levels-1;);return a},init_model_structures:function(e,t,i){t.buckets_buf=[];for(var n=0;n<i.nbuckets;n++)t.buckets_buf[n]=new wdi_quic_s_bucket;t.buckets_ptrs=[],t.counters=[],this.fill_model_structures(e,t,i)},fill_model_structures:function(e,t,i){var n,s,o,a,r=0;a=0,o=i.repfirst+1,n=i.firstsize;do{s=a?r+1:0,--o||(o=i.repnext,n*=i.mulsize),(r=s+n-1)+n>=i.levels&&(r=i.levels-1),t.buckets_buf[a].pcounters=new Int32Array(i.ncounters);for(var c=0;c<i.ncounters;c++)t.buckets_buf[a].pcounters[c]=0;for(var d=s;d<=r;d++)t.buckets_ptrs[d]=t.buckets_buf[a];a++}while(r<i.levels-1)},initChannel:function(e,t){t.encoder=e,t.state.encoder=e,t.correlate_row_width=0,t.correlate_row=null;var i=this.find_model_params(e,8);e.n_buckets_8bpc=i.nbuckets,this.init_model_structures(e,t.family_stat_8bpc,i),i=this.find_model_params(e,5),e.n_buckets_5bpc=i.nbuckets,this.init_model_structures(e,t.family_stat_5bpc,i)},encoder_reste_channels:function(e,t,i,n){e.num_channels=t;for(var s=0;s<t;s++){var o,a;if(e.channels[s].correlate_row_width<i&&(e.channels[s].correlate_row=new Array(i),e.channels[s].correlate_row_width=i),e.channels[s].num_channel=s,8===n){o=e.channels[s].family_stat_8bpc.buckets_buf,a=e.n_buckets_8bpc;for(var r=0;r<a;r++)o[r].bestcode=7;e.channels[s]._buckets_ptrs=e.channels[s].family_stat_8bpc.buckets_ptrs}else{if(5!==n)return FALSE;o=e.channels[s].family_stat_5bpc.buckets_buf,a=e.n_buckets_5bpc;for(r=0;r<a;r++)o[r].bestcode=4;e.channels[s]._buckets_ptrs=e.channels[s].family_stat_5bpc.buckets_ptrs}e.channels[s].state.waitcnt=0,e.channels[s].state.tabrand_seed=wdi.JSQuic.stabrand(),e.channels[s].state.wmidx=wdi.JSQuic.DEFwmistart,e.channels[s].state.wmileft=wdi.JSQuic.wminext}return!0},decode_channel_run:function(e,t){for(var i=0;;){var n,s;for(n=wdi.JSQuic.zeroLUT[(~(e.io_word>>>24)>>>0)%256],s=1;s<=n;s++)i+=t.state.melcorder,t.state.melcstate<32&&(t.state.melclen=wdi.JSQuic.J[++t.state.melcstate],t.state.melcorder=1<<t.state.melclen>>>0);if(8!==n){e.eatbits(n+1,e);break}e.eatbits(8,e)}return t.state.melclen&&(i+=e.io_word>>>32-t.state.melclen,e.eatbits(t.state.melclen,e)),t.state.melcstate&&(t.state.melclen=wdi.JSQuic.J[--t.state.melcstate],t.state.melcorder=1<<t.state.melclen>>>0),i},decode_run:function(e){for(var t,i,n,s=0,o=wdi.JSQuic.zeroLUT,a=e.rgb_state,r=wdi.JSQuic.J,c=e.eatbits;;){for(n=(t=o[(~(e.io_word>>>24)>>>0)%256])+1,i=1;i<n;i++)s+=e.rgb_state.melcorder,a.melcstate<32&&(a.melclen=r[++a.melcstate],a.melcorder=1<<a.melclen>>>0);if(8!==t){c(n,e);break}e.eatbits(8,e)}return a.melclen&&(s+=e.io_word>>>32-a.melclen,c(a.melclen,e)),a.melcstate&&(a.melclen=r[--a.melcstate],a.melcorder=1<<a.melclen>>>0),s},quic_decode:function(e){var t=new wdi_quic_Encoder(new Uint32Array(e)),i=65280&t.io_word;t.io_word;t.eat32bits(),t.eat32bits();t.io_word;t.eat32bits();t.io_word;t.eat32bits();var n=t.io_word;t.eat32bits(),t.type=n;var s=t.io_word;t.width=s,t.eat32bits();var o=t.io_word;t.height=o,t.eat32bits();var a=wdi.JSQuic.quic_image_params(t,n),r=a[0],c=a[1];this.encoder_reste_channels(t,r,s,c);var d=new ArrayBuffer(s*o*4),l=new Uint8Array(d);e=new Uint32Array(d);switch(t.result=l,t.resultData=e,t.setComputedWidth(s),n){case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB32:case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB24:QUIC_UNCOMPRESS_RGB(t,r,c,n);break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB16:break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGBA:if(QUIC_UNCOMPRESS_RGBA(t,r,c,n),i)for(var u=l.length-1;0<u;)l[u]=255,u-=4}return d}},wdi.JSQuic.quic_init(),wdi_quic_Encoder.prototype.append=function(e){this.result[this.cnt++]=e},wdi_quic_Encoder.prototype.appendPixel=function(e,t,i){this.resultData[this.pxCnt++]=255<<24|i<<16|t<<8|e,this.cnt+=4},wdi_quic_Encoder.prototype.eatbits=function(e,t){var i=t.io_available_bits,n=t.io_word,s=i-e;if(n<<=e,0<=s)return n=(n|t.io_next_word>>>s)>>>0,t.io_available_bits=s,void(t.io_word=n);var o=t.io_next_word;n=((n|=o<<(s=-s)>>>0)|(o=t.usr[t.io_now++])>>>(i=32-s))>>>0,t.io_available_bits=i,t.io_word=n,t.io_next_word=o},wdi_quic_Encoder.prototype.eat32bits=function(){this.eatbits(16,this),this.eatbits(16,this)},wdi_quic_Encoder.prototype.read_io_word=function(){this.io_next_word=this.usr[this.io_now++]},wdi_quic_Encoder.prototype.row_completed=function(){this.rows_completed++},wdi_quic_Encoder.prototype.setComputedWidth=function(e){this.computedWidth=4*e},wdi_quic_Encoder.prototype.appendAlpha=function(e){this.result[this.alphaPos]=e,this.alphaPos+=4};var lzDecompress={LZ_IMAGE_TYPE_INVALID:0,LZ_IMAGE_TYPE_PLT1_LE:1,LZ_IMAGE_TYPE_PLT1_BE:2,LZ_IMAGE_TYPE_PLT4_LE:3,LZ_IMAGE_TYPE_PLT4_BE:4,LZ_IMAGE_TYPE_PLT8:5,LZ_IMAGE_TYPE_RGB16:6,LZ_IMAGE_TYPE_RGB24:7,LZ_IMAGE_TYPE_RGB32:8,LZ_IMAGE_TYPE_RGBA:9,LZ_IMAGE_TYPE_XXXA:10,LZPALETTE_FLAG_PAL_CACHE_ME:1,LZPALETTE_FLAG_PAL_FROM_CACHE:2,LZPALETTE_FLAG_TOP_DOWN:4,PLT_PIXELS_PER_BYTE:[0,8,8,2,2,1],PLT1_MASK:[1,2,4,8,16,32,64,128],lz_rgb32_decompress_rgb_opaque_reverse:function(e){for(var t,i,n,s,o,a,r,c=new Uint8Array(e),d=(c[2],256*c[5]+c[4]),l=65536*(256*c[7]+c[6])+d,u=new ArrayBuffer(l),h=new Uint32Array(u),p=new DataView(e),w=p.getUint32(8),_=p.getUint32(12),m=l/4-1,f=c[16],g=16;0<=m;)if(0!=(f=c[g++])&&0!=(l=f>>5)){if(i=m,n=(31&f)<<8,7==l)for(;l+=t=c[g++],255==t;);if(0==(n+=c[g++])){for(s=h[i+1];9<l;)h[m]=s,h[m-1]=s,h[m-2]=s,h[m-3]=s,h[m-4]=s,h[m-5]=s,h[m-6]=s,h[m-7]=s,h[m-8]=s,h[m-9]=s,m-=10,l-=10;for(;0!=l--;)h[m--]=s}else{for(8191==n&&(n+=(c[g]<<8)+c[g+1],g+=2),i+=n+1;9<l;)h[m]=h[i],h[m-1]=h[i-1],h[m-2]=h[i-2],h[m-3]=h[i-3],h[m-4]=h[i-4],h[m-5]=h[i-5],h[m-6]=h[i-6],h[m-7]=h[i-7],h[m-8]=h[i-8],h[m-9]=h[i-9],m-=10,l-=10,i-=10;for(;0!=l--;)h[m--]=h[i--]}}else{for(;9<f;)h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],h[m-2]=4278190080|c[g+6]<<16|c[g+7]<<8|c[g+8],h[m-3]=4278190080|c[g+9]<<16|c[g+10]<<8|c[g+11],h[m-4]=4278190080|c[g+12]<<16|c[g+13]<<8|c[g+14],h[m-5]=4278190080|c[g+15]<<16|c[g+16]<<8|c[g+17],h[m-6]=4278190080|c[g+18]<<16|c[g+19]<<8|c[g+20],h[m-7]=4278190080|c[g+21]<<16|c[g+22]<<8|c[g+23],h[m-8]=4278190080|c[g+24]<<16|c[g+25]<<8|c[g+26],h[m-9]=4278190080|c[g+27]<<16|c[g+28]<<8|c[g+29],g+=30,m-=10,f-=10;0!=f&&(9==f?(h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],h[m-2]=4278190080|c[g+6]<<16|c[g+7]<<8|c[g+8],h[m-3]=4278190080|c[g+9]<<16|c[g+10]<<8|c[g+11],h[m-4]=4278190080|c[g+12]<<16|c[g+13]<<8|c[g+14],h[m-5]=4278190080|c[g+15]<<16|c[g+16]<<8|c[g+17],h[m-6]=4278190080|c[g+18]<<16|c[g+19]<<8|c[g+20],h[m-7]=4278190080|c[g+21]<<16|c[g+22]<<8|c[g+23],h[m-8]=4278190080|c[g+24]<<16|c[g+25]<<8|c[g+26],g+=27,m-=9):8==f?(h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],h[m-2]=4278190080|c[g+6]<<16|c[g+7]<<8|c[g+8],h[m-3]=4278190080|c[g+9]<<16|c[g+10]<<8|c[g+11],h[m-4]=4278190080|c[g+12]<<16|c[g+13]<<8|c[g+14],h[m-5]=4278190080|c[g+15]<<16|c[g+16]<<8|c[g+17],h[m-6]=4278190080|c[g+18]<<16|c[g+19]<<8|c[g+20],h[m-7]=4278190080|c[g+21]<<16|c[g+22]<<8|c[g+23],g+=24,m-=8):7==f?(h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],h[m-2]=4278190080|c[g+6]<<16|c[g+7]<<8|c[g+8],h[m-3]=4278190080|c[g+9]<<16|c[g+10]<<8|c[g+11],h[m-4]=4278190080|c[g+12]<<16|c[g+13]<<8|c[g+14],h[m-5]=4278190080|c[g+15]<<16|c[g+16]<<8|c[g+17],h[m-6]=4278190080|c[g+18]<<16|c[g+19]<<8|c[g+20],g+=21,m-=7):6==f?(h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],h[m-2]=4278190080|c[g+6]<<16|c[g+7]<<8|c[g+8],h[m-3]=4278190080|c[g+9]<<16|c[g+10]<<8|c[g+11],h[m-4]=4278190080|c[g+12]<<16|c[g+13]<<8|c[g+14],h[m-5]=4278190080|c[g+15]<<16|c[g+16]<<8|c[g+17],g+=18,m-=6):5==f?(h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],h[m-2]=4278190080|c[g+6]<<16|c[g+7]<<8|c[g+8],h[m-3]=4278190080|c[g+9]<<16|c[g+10]<<8|c[g+11],h[m-4]=4278190080|c[g+12]<<16|c[g+13]<<8|c[g+14],g+=15,m-=5):4==f?(h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],h[m-2]=4278190080|c[g+6]<<16|c[g+7]<<8|c[g+8],h[m-3]=4278190080|c[g+9]<<16|c[g+10]<<8|c[g+11],g+=12,m-=4):3==f?(h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],h[m-2]=4278190080|c[g+6]<<16|c[g+7]<<8|c[g+8],g+=9,m-=3):2==f?(h[m]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],h[m-1]=4278190080|c[g+3]<<16|c[g+4]<<8|c[g+5],g+=6,m-=2):1==f&&(h[m--]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],g+=3)),h[m--]=4278190080|c[g]<<16|c[g+1]<<8|c[g+2],g+=3}for(var S=w-1;_--;)for(r=new Uint32Array(u,_*w*4,w),o=0,a=S;o<a;){var b=r[o];r[o++]=r[a],r[a--]=b}return u},lz_rgb32_decompress_rgb:function(e){var t=0,i=new Uint8Array(e),n=i[1],s=i[2],o=i[3];if(n&&!o)return lzDecompress.lz_rgb32_decompress_rgb_opaque_reverse(e);for(var a,r,c,d,l,u,h,p=256*i[5]+i[4],w=65536*(256*i[7]+i[6])+p,_=new ArrayBuffer(w),m=new Uint32Array(_),f=w/4,g=i[16],S=16;t!=f;)if(0!=(g=i[S++])&&0!=(w=g>>5)){if(r=t,c=(31&g)<<8,7==w)for(;w+=a=i[S++],255==a;);if(0==(c+=i[S++])){for(u=m[--r];9<w;)m[t]=u,m[t+1]=u,m[t+2]=u,m[t+3]=u,m[t+4]=u,m[t+5]=u,m[t+6]=u,m[t+7]=u,m[t+8]=u,m[t+9]=u,t+=10,w-=10;for(;0!=w--;)m[t++]=u}else if(8191==c&&(c+=(i[S]<<8)+i[S+1],S+=2),r-=c+1,100<w&&r+w<t)h=new Uint32Array(_,4*r,w),m.set(h,t),t+=w,r+=w;else{for(;9<w;)m[t]=m[r],m[t+1]=m[r+1],m[t+2]=m[r+2],m[t+3]=m[r+3],m[t+4]=m[r+4],m[t+5]=m[r+5],m[t+6]=m[r+6],m[t+7]=m[r+7],m[t+8]=m[r+8],m[t+9]=m[r+9],t+=10,w-=10,r+=10;for(;0!=w--;)m[t++]=m[r++]}}else{for(;9<g;)m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],m[t+2]=4278190080|i[S+6]<<16|i[S+7]<<8|i[S+8],m[t+3]=4278190080|i[S+9]<<16|i[S+10]<<8|i[S+11],m[t+4]=4278190080|i[S+12]<<16|i[S+13]<<8|i[S+14],m[t+5]=4278190080|i[S+15]<<16|i[S+16]<<8|i[S+17],m[t+6]=4278190080|i[S+18]<<16|i[S+19]<<8|i[S+20],m[t+7]=4278190080|i[S+21]<<16|i[S+22]<<8|i[S+23],m[t+8]=4278190080|i[S+24]<<16|i[S+25]<<8|i[S+26],m[t+9]=4278190080|i[S+27]<<16|i[S+28]<<8|i[S+29],S+=30,t+=10,g-=10;0!=g&&(9==g?(m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],m[t+2]=4278190080|i[S+6]<<16|i[S+7]<<8|i[S+8],m[t+3]=4278190080|i[S+9]<<16|i[S+10]<<8|i[S+11],m[t+4]=4278190080|i[S+12]<<16|i[S+13]<<8|i[S+14],m[t+5]=4278190080|i[S+15]<<16|i[S+16]<<8|i[S+17],m[t+6]=4278190080|i[S+18]<<16|i[S+19]<<8|i[S+20],m[t+7]=4278190080|i[S+21]<<16|i[S+22]<<8|i[S+23],m[t+8]=4278190080|i[S+24]<<16|i[S+25]<<8|i[S+26],S+=27,t+=9):8==g?(m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],m[t+2]=4278190080|i[S+6]<<16|i[S+7]<<8|i[S+8],m[t+3]=4278190080|i[S+9]<<16|i[S+10]<<8|i[S+11],m[t+4]=4278190080|i[S+12]<<16|i[S+13]<<8|i[S+14],m[t+5]=4278190080|i[S+15]<<16|i[S+16]<<8|i[S+17],m[t+6]=4278190080|i[S+18]<<16|i[S+19]<<8|i[S+20],m[t+7]=4278190080|i[S+21]<<16|i[S+22]<<8|i[S+23],S+=24,t+=8):7==g?(m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],m[t+2]=4278190080|i[S+6]<<16|i[S+7]<<8|i[S+8],m[t+3]=4278190080|i[S+9]<<16|i[S+10]<<8|i[S+11],m[t+4]=4278190080|i[S+12]<<16|i[S+13]<<8|i[S+14],m[t+5]=4278190080|i[S+15]<<16|i[S+16]<<8|i[S+17],m[t+6]=4278190080|i[S+18]<<16|i[S+19]<<8|i[S+20],S+=21,t+=7):6==g?(m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],m[t+2]=4278190080|i[S+6]<<16|i[S+7]<<8|i[S+8],m[t+3]=4278190080|i[S+9]<<16|i[S+10]<<8|i[S+11],m[t+4]=4278190080|i[S+12]<<16|i[S+13]<<8|i[S+14],m[t+5]=4278190080|i[S+15]<<16|i[S+16]<<8|i[S+17],S+=18,t+=6):5==g?(m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],m[t+2]=4278190080|i[S+6]<<16|i[S+7]<<8|i[S+8],m[t+3]=4278190080|i[S+9]<<16|i[S+10]<<8|i[S+11],m[t+4]=4278190080|i[S+12]<<16|i[S+13]<<8|i[S+14],S+=15,t+=5):4==g?(m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],m[t+2]=4278190080|i[S+6]<<16|i[S+7]<<8|i[S+8],m[t+3]=4278190080|i[S+9]<<16|i[S+10]<<8|i[S+11],S+=12,t+=4):3==g?(m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],m[t+2]=4278190080|i[S+6]<<16|i[S+7]<<8|i[S+8],S+=9,t+=3):2==g?(m[t]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],m[t+1]=4278190080|i[S+3]<<16|i[S+4]<<8|i[S+5],S+=6,t+=2):1==g&&(m[t++]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],S+=3)),m[t++]=4278190080|i[S]<<16|i[S+1]<<8|i[S+2],S+=3}if(s===this.LZ_IMAGE_TYPE_RGBA&&!n){var b=new Uint8Array(_);for(t=0,g=null,g=i[S++];t<f;g=i[S++])if(w=g>>5,c=(31&g)<<8,l=4*(r=t),32<=g){if(6===--w)for(;w+=a=i[S++],255===a;);if(c+=a=i[S++],255===a&&c-a==7936&&(c=i[S++]<<8,c+=i[S++],c+=8191),w+=3,(r-=c+=1)===t-1)for(d=r;w;--w)b[(l=4*t)+3]=b[4*d+3],t++;else for(;w;--w)b[(l=4*t)+3]=b[4*r+3],t++,r++}else for(g++,b[l+3]=i[S++],t++,--g;g;g--)b[(l=4*t)+3]=i[S++],t++}return _}};wdi.LZSS?wdi.LZSS.lz_rgb32_decompress_rgb=lzDecompress.lz_rgb32_decompress_rgb:wdi.LZSS=lzDecompress;var inactivityTimeout=0,inactivityGrace=30;function read_cookie(e){for(var t=escape(e)+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var s=i[n];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return unescape(s.substring(t.length,s.length))}return null}function toggleMenuBar(){var e=$(window).width(),t=$(window).height();if(""==document.getElementById("login").className){document.getElementById("login").className="hidden",document.getElementById("menubarbutton").firstChild.data=tr.menubarbutton_alt;var i=document.getElementById("canvas_0"),n=document.getElementById("eventLayer");null!=i&&null!=n&&(i.style.top="0px",n.style.top="0px",app.clientGui.setCanvasMargin({x:0,y:0}),app.sendCommand("setResolution",{width:e,height:t}))}else{i=document.getElementById("canvas_0"),n=document.getElementById("eventLayer");null!=i&&null!=n&&(i.style.top="40px",n.style.top="40px",app.clientGui.setCanvasMargin({x:0,y:40}),app.sendCommand("setResolution",{width:e,height:t-40})),document.getElementById("login").className="",document.getElementById("menubarbutton").firstChild.data=tr.menubarbutton}}function showMenuBar(){"hidden"==document.getElementById("login").className&&(document.getElementById("login").className="hidden-peek")}function hideMenuBar(){"hidden-peek"==document.getElementById("login").className&&(document.getElementById("login").className="hidden")}function closeSession(e){inactivityClosed=!0,clearTimeout(inactivityTimer),clearTimeout(inactivityCountdownTimer),app.sendKeystroke("Win+L"),app.disconnect(),document.getElementById("fullscreen").firstChild.data==tr.fullscreen_alt&&toggleFullScreen(document.body),document.getElementById("overlay").style.visibility="visible",document.getElementById("overlay").style.opacity="1",e?document.getElementById("inactivity-end").style.visibility="visible":document.getElementById("dialog-end").style.visibility="visible",app.clientGui.releasePointer()}function showClientID(){read_cookie("hwaddress")}var progFS=!1,isFS=!1,wasFS=!1;function toggleFullScreen(e){void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.msFullscreenElement&&null===document.msFullscreenElement||void 0!==document.mozFullScreen&&!document.mozFullScreen||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen?e.mozRequestFullScreen&&e.mozRequestFullScreen():document.mozCancelFullScreen&&(progFS=!0,document.mozCancelFullScreen())}function showCloseDialog(){document.getElementById("overlay").style.visibility="visible",document.getElementById("dialog-close").style.visibility="visible"}function closeAction(e){document.getElementById("overlay").style.visibility="hidden",document.getElementById("dialog-close").style.visibility="hidden",e?closeSession(!1):wasFS&&(wasFS=!1,toggleFullScreen(document.body))}function overlayAction(e){document.getElementById("overlay").style.visibility="hidden",document.getElementById("dialog-fs").style.visibility="hidden",e&&(toggleMenuBar(),toggleFullScreen(document.body))}function showExtWin(){document.getElementById("overlay").style.visibility="visible",document.getElementById("extwin").style.visibility="visible"}function hideExtWin(){document.getElementById("overlay").style.visibility="hidden",document.getElementById("extwin").style.visibility="hidden"}function isFullScreen(){isFS=!0,document.getElementById("fullscreen").firstChild.data=tr.fullscreen_alt,document.getElementById("menubarbutton").style.visibility="hidden"}function notFullScreen(){isFS=!1,document.getElementById("fullscreen").firstChild.data=tr.fullscreen,document.getElementById("menubarbutton").style.visibility="visible",progFS?progFS=!1:(wasFS=!0,showCloseDialog())}function sendKeystroke(e){app.sendKeystroke($(e).text()),document.getElementById("inputmanager").focus()}function showKeystrokesMenu(){$("#keystrokes-menu").toggleClass("show")}function setInactivityTimer(){0==inactivityTimeout||inactivityClosed||(inactivityCountdown&&stopInactivityCountdown(),null!=inactivityTimer&&clearTimeout(inactivityTimer),inactivityTimer=setTimeout(inactivityHandler,1e3*inactivityTimeout))}function inactivityHandler(){startInactivityCountdown()}function startInactivityCountdown(){document.getElementById("inactivity_close_text").innerHTML=tr.inactivity_close_text.replace("_",inactivityGrace),document.getElementById("overlay").style.visibility="visible",document.getElementById("inactivity-close").style.visibility="visible",null!=inactivityCountdownTimer&&clearTimeout(inactivityCountdownTimer),inactivityCountdownSecs=inactivityGrace,inactivityCountdownTimer=setTimeout(inactivityCountdownHandler,1e3),inactivityCountdown=!0}function stopInactivityCountdown(){document.getElementById("overlay").style.visibility="hidden",document.getElementById("inactivity-close").style.visibility="hidden",null!=inactivityCountdownTimer&&clearTimeout(inactivityCountdownTimer),inactivityCountdown=!1,setInactivityTimer(),document.getElementById("inputmanager").focus()}function inactivityCountdownHandler(){if(inactivityCountdownSecs-=1,inactivityCountdownSecs<1)return document.getElementById("inactivity-close").style.visibility="hidden",void closeSession(inactivityClosed=!0);document.getElementById("inactivity_close_text").innerHTML=tr.inactivity_close_text.replace("_",inactivityCountdownSecs),null!=inactivityCountdownTimer&&clearTimeout(inactivityCountdownTimer),inactivityCountdownTimer=setTimeout(inactivityCountdownHandler,1e3)}window.addEventListener("click",function(e){e.target.matches(".dropbtn")||$(".dropdown-content").removeClass("show")},!1),document.addEventListener("mozfullscreenchange",function(){document.mozFullScreen?isFullScreen():notFullScreen()},!1),inactivityTimer=null,inactivityCountdownTimer=null,inactivityCountdown=!1,inactivityCountdownSecs=0,inactivityClosed=!1;var exturl="",extwidth="600px",extheight="600px",extmargin="100px auto",translations={es:{uploadfile:"Subir Fichero",menubarbutton:"Ocultar Menu",menubarbutton_alt:"Fijar Menu",fullscreen:"Pantalla Completa",fullscreen_alt:"Ventana Normal",keystroke:"Combinación de teclas",showclientid:"Mostrar Id",dialog_fs_text:"La aplicación solicita permiso para acceder a su Escritorio VDI en modo Pantalla Completa.",cancel:"Cancelar",accept:"Aceptar",dialog_close_text:"Su sesión de VDI se cerrará. Por favor, asegúrese de que ha guardado sus cambios.",dialog_end_text:"Su sesión de VDI ha finalizado. Por favor, cierre esta ventana.",inactivity_close_text:"Su sesión de VDI se cerrará por inactividad en _ segundos",inactivity_end_text:"Su sesión de VDI ha sido cerrada por inactividad. Por favor, cierre esta ventana.",error_text:"Error de conexión. Por favor, cierre esta ventana.",show_id:"El identificador de este navegador es: _",no_auto_fs:"Este navegador no soporta el cambio automatico a pantalla completa. Por favor, pulse F11 para cambiar de forma manual.",msg_click_to_capture:"Haga click dentro del escritorio virtual para capturar el ratón. Podrá liberar el ratón pulsando la tecla ESC."},en:{uploadfile:"Upload File",menubarbutton:"Hide Menu",menubarbutton_alt:"Show Menu",fullscreen:"Fullscreen",fullscreen_alt:"Normal Window",keystroke:"Send keystroke",showclientid:"Show Id",dialog_fs_text:"The application requests to access your virtual desktop in fullscreen mode.",cancel:"Cancel",accept:"Accept",dialog_close_text:"Your VDI session will close. Please, confirm that you saved your changes.",dialog_end_text:"Your VDI session has ended. Please, close this window.",inactivity_close_text:"Your VDI session will close due to inactivity in _ seconds",inactivity_end_text:"Your VDI session was closed due to inactivity. Please, close this window.",error_text:"Connection error. Please, close this window.",show_id:"This browser's ID is: _",no_auto_fs:"This browser does not support automatic fullscreen switch. Please, press F11 to switch manually.",msg_click_to_capture:"Click inside the virtual desktop to capture the mouse. Then press ESC to release pointer."},ru:{uploadfile:"Загрузить файл",menubarbutton:"Скрыть меню",menubarbutton_alt:"Показать меню",fullscreen:"Во весь экран",fullscreen_alt:"Нормальное окно",keystroke:"комбинация клавиш",showclientid:"Показать Id",dialog_fs_text:"Приложение запрашивает доступ к вашему виртуальному рабочему столу в полноэкранном режиме.",cancel:"Отмена",accept:"Принять",dialog_close_text:"Ваш сеанс VDI будет закрыт. Пожалуйста, подтвердите, что вы сохранили изменения.",dialog_end_text:"Ваш сеанс VDI закончился. Пожалуйста, закройте это окно.",inactivity_close_text:"Ваш сеанс VDI будет закрыт из-за неактивности  _ секунд",inactivity_end_text:"Ваш сеанс VDI был закрыт из-за неактивности. Закройте это окно.",error_text:"Ошибка подключения. Закройте это окно.",show_id:"ID этого браузера: _",no_auto_fs:"Этот браузер не поддерживает автоматическое переключение в полноэкранный режим. Нажмите F11 для переключения вручную.",msg_click_to_capture:"Нажмите на виртуальный рабочий стол, чтобы захватить мышь. Затем нажмите ESC, чтобы освободить указатель."}},tr=translations.en;function getURLParameter(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function createCookie(e,t,i){var n;if(i){var s=new Date;s.setTime(s.getTime()+24*i*60*60*1e3),n="; expires="+s.toGMTString()}else n="";document.cookie=escape(e)+"="+escape(t)+n+"; path=/"}function translate(){var e=navigator.languages||[navigator.language||navigator.userLanguage];for(var t in e){var i=e[t];if(void 0!==translations[i]||(i=i.substr(0,2),void 0!==translations[i])){tr=translations[i];break}}for(var n in tr)$("#"+n).html(tr[n]),$(".tr-"+n).html(tr[n])}function start(){var m=!1;translate(),$("#getStats").click(function(){m?(wdi.DataLogger.stopTestSession(),m=!1):(m=!0,wdi.DataLogger.startTestSession())}),wdi.graphicDebug=new wdi.GraphicDebug({debugMode:!1}),app=new Application,window.vdiLoadTest=getURLParameter("vdiLoadTest")||!1;var f=getURLParameter("performanceTest")||!1;$(window).resize(function(){width=$(window).width(),height=$(window).height(),login=document.getElementById("login"),null!=login&&""==login.className&&(height-=40),app.sendCommand("setResolution",{width:width,height:height})});var e=!0;f&&(e=!1,jQuery.getScript("performanceTests/lib/iopacketfactory.js"),jQuery.getScript("performanceTests/lib/testlauncher.js"),jQuery.getScript("performanceTests/tests/wordscroll.js")),createCookie("token",getURLParameter("token")||"token",1),null==read_cookie("hwaddress")&&(document.getElementById("showclientid").style.display="none"),$("title").text("CDeX VM Console powered by flexVDI and eyeOS"),app.run({callback:function(e,t){if("windowClosed"==e)$(t.canvas).remove(),$(t.eventLayer).remove();else if("windowMoved"==e)$(t.canvas).css({top:t.info.top+"px",left:t.info.left+"px"}),$(t.eventLayer).css({top:t.info.top+"px",left:t.info.left+"px"});else if("init"==e||"windowCreated"==e){var i=null,n=null,s=null,o=$("body");for(var a in t){var r=2*(i=t[a]).position;n=$(i.canvas).css({zIndex:1e4-r-1,position:"absolute",top:i.info.top+"px",left:i.info.left+"px"}),s=$(i.eventLayer).css({top:i.info.top+"px",left:i.info.left+"px",zIndex:1e4-r}),o.append(n),o.append(s)}}else if("ready"==e){var c=$(window).width(),d=$(window).height();f&&(c=800,d=600,window.setTimeout(function(){m||(m=!0,window.performanceTest.runner.startPerformanceTest())},3e3)),login=document.getElementById("login"),null!=login&&""==login.className&&(d-=40),app.sendCommand("setResolution",{width:c,height:d}),wdi.IntegrationBenchmarkEnabled&&($("#integrationBenchmark").css({display:"inline"}),$("#launchWordButton").prop("disabled",!1))}else if("resolution"==e);else if("windowMinimized"==e)$(t.canvas).css({display:"none"}),$(t.eventLayer).css({display:"none"});else if("windowMaximized"==e)$(t.canvas).css({top:t.info.top+"px",left:t.info.left+"px"}),$(t.eventLayer).css({top:t.info.top+"px",left:t.info.left+"px"});else if("windowRestored"==e)$(t.canvas).css({display:"block"}),$(t.eventLayer).css({display:"block"}),$(t.canvas).css({top:t.info.top+"px",left:t.info.left+"px"}),$(t.eventLayer).css({top:t.info.top+"px",left:t.info.left+"px"});else if("windowFocused"==e);else if("timeLapseDetected"==e)wdi.Debug.log("Detected time lapse of ",t,"seconds");else if("error"==e)closeSession();else{for(var l=$("#canvas_0")[0],u=l.getContext("2d"),h=u.getImageData(0,0,l.width,l.height),p=new Uint32Array(h.data.buffer),w=new Uint32Array(firstImageData),_=w.length;w[_]!==p[_]&&(p[_]=-16776961),_--;);u.putImageData(h,0,0)}},context:this,host:window.location.hostname,port:window.location.port,protocol:getURLParameter("protocol")||"ws",token:getURLParameter("token")||"token",vmHost:getURLParameter("vmhost")||!1,vmPort:getURLParameter("vmport")||!1,useBus:!1,busHost:"10.11.12.200",busPort:61613,busSubscriptions:["/topic/00000000-0000-0000-0000-000000000000"],busUser:"00000000-0000-0000-0000-000000000000",busPass:"potato",connectionControl:!1,heartbeatToken:"heartbeat",heartbeatTimeout:4e3,busFileServerBaseUrl:"https://10.11.12.200/fileserver/",layout:"us",useWorkers:e,seamlessDesktopIntegration:!1,externalClipboardHandling:!1,disableClipboard:!1,layer:document.getElementById("screen"),vmInfoToken:getURLParameter("vmInfoToken"),canvasMargin:{x:0,y:40}})}function startBenchmark(){$("#launchWordButton").text("Benchmarking...").prop("disabled",!0),wdi.IntegrationBenchmark.launchApp(app.busConnection,function(e){$("#launchWordButton").remove(),$("#integrationBenchmark").append('<div class="result">Total: '+e+" ms</div>")})}function closeIntegrationBenchmark(){$("#integrationBenchmark").hide()}wdi.Debug.debug=!1,wdi.exceptionHandling=!1,wdi.IntegrationBenchmarkEnabled=!1,$(document).ready(start);